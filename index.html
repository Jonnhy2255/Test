<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chat App iOS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <style>
        /* Variables de couleurs */
        :root {
            --primary-color: #F7DC6F; /* Jaune comme couleur principale de l'interface */
            --text-color: #000000;
            --bg-color: #ffffff;
            --border-color: #dddfe2;
            --secondary-color: #f0f2f5;
            --chat-sent-bg: #5D5CDE; /* Violet pour les bulles de messages envoyés */
            --chat-sent-text: #ffffff;
            --chat-received-bg: #f0f2f5;
            --selection-color: rgba(247, 220, 111, 0.2);
            --action-menu-bg: rgba(0, 0, 0, 0.9);
            --action-menu-text: #ffffff;
        }
        
        /* Mode sombre par défaut */
        .dark {
            --bg-color: #181818;
            --text-color: #ffffff;
            --border-color: #3e4042;
            --secondary-color: #2c2c2c;
            --chat-received-bg: #2c2c2c;
            --chat-sent-bg: #F7DC6F; /* Jaune plus visible en mode sombre */
            --chat-sent-text: #000000; /* Texte noir pour contraste avec fond jaune */
            --selection-color: rgba(247, 220, 111, 0.3);
            --action-menu-bg: rgba(60, 60, 60, 0.95);
        }
        
        /* Reset de base */
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
            user-select: none; /* Rendre aucune écriture sélectionnable */
            -webkit-user-select: none; /* Pour Safari */
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            position: fixed;
            overflow: hidden;
        }
        
        /* En-tête fixe */
        .header {
            background-color: var(--bg-color);
            border-bottom: 1px solid var(--border-color);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            z-index: 10;
        }
        
        .header-title {
            font-weight: bold;
            font-size: 18px;
            color: var(--primary-color);
        }
        
        .back-button {
            color: var(--primary-color);
            padding: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        /* Contenu principal */
        .content {
            position: fixed;
            top: 50px; /* Hauteur de l'en-tête */
            bottom: 60px; /* Hauteur de la barre d'onglets */
            left: 0;
            right: 0;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            background-color: var(--bg-color);
        }
        
        /* Barre d'onglets fixe */
        .tabbar {
            background-color: var(--bg-color);
            border-top: 1px solid var(--border-color);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            z-index: 10;
        }
        
        .tab {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #8e8e93;
            font-size: 10px;
            text-decoration: none;
            padding: 8px 0;
        }
        
        .tab.active {
            color: var(--primary-color);
        }
        
        .tab-icon {
            font-size: 22px;
            margin-bottom: 4px;
        }
        
        /* Sections de contenu */
        .section {
            padding: 10px 0;
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        /* Profil et éléments utilisateur */
        .profile-pic {
            width: 50px;
            height: 50px;
            background-color: var(--secondary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }
        
        .chat-item, .user-item {
            display: flex;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            align-items: center;
            cursor: pointer;
        }
        
        .item-content {
            flex: 1;
        }
        
        .item-title {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .item-subtitle {
            color: #6b7280;
            font-size: 14px;
        }
        
        .item-time {
            color: #6b7280;
            font-size: 12px;
        }
        
        /* Formulaires et entrées */
        .search-container {
            padding: 10px 16px;
        }
        
        .search-input {
            width: 100%;
            padding: 8px 16px;
            border-radius: 18px;
            border: none;
            background-color: var(--secondary-color);
            font-size: 16px;
        }
        
        /* Écran de chargement */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Paramètres */
        .settings-container {
            padding: 15px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
        }
        
        .setting-icon {
            width: 36px;
            height: 36px;
            background-color: var(--secondary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .setting-label {
            font-weight: 500;
        }
        
        .button {
            background-color: var(--primary-color);
            color: black;
            border: none;
            border-radius: 10px;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            margin-top: 20px;
            cursor: pointer;
        }
        
        /* Switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        /* Notification dot */
        .badge {
            position: relative;
            display: inline-block;
        }
        
        .dot {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 8px;
            height: 8px;
            background-color: #f03d25;
            border-radius: 50%;
        }
        
        /* Interface de chat */
        .chat-section {
            display: none;
            position: fixed;
            top: 50px;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--bg-color);
            z-index: 5;
        }
        
        .chat-messages-container {
            position: absolute;
            top: 0;
            bottom: 60px;
            left: 0;
            right: 0;
            overflow-y: auto;
            background-color: var(--secondary-color);
            -webkit-overflow-scrolling: touch;
            padding: 15px;
        }
        
        .chat-messages {
            width: 100%;
            display: flex;
            flex-direction: column;
            min-height: 100%;
            justify-content: flex-end;
        }
        
        .chat-input-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            padding: 10px;
            background-color: var(--bg-color);
            border-top: 1px solid var(--border-color);
            height: 60px;
        }
        
        .message {
            max-width: 75%;
            padding: 8px 12px;
            margin-bottom: 10px;
            border-radius: 15px;
            position: relative;
            word-wrap: break-word;
            clear: both;
            transition: background-color 0.2s ease;
        }
        
        .message-received {
            background-color: var(--chat-received-bg);
            float: left;
            border-top-left-radius: 0;
        }
        
        .message-sent {
            background-color: var(--chat-sent-bg);
            color: var(--chat-sent-text);
            float: right;
            border-top-right-radius: 0;
        }
        
        .message.selected {
            background-color: var(--selection-color);
            border: 2px solid var(--primary-color);
        }
        
        .message-time {
            font-size: 10px;
            margin-top: 4px;
            text-align: right;
            clear: both;
            opacity: 0.7;
        }
        
        .chat-input {
            flex: 1;
            padding: 8px 12px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            font-size: 16px;
            background-color: var(--secondary-color);
            margin-right: 10px;
        }
        
        .send-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: black;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
        }
        
        /* Settings pages */
        .settings-page {
            display: none;
            padding: 15px;
        }
        
        .settings-page.active {
            display: block;
        }
        
        .settings-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .settings-title {
            font-size: 18px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .setting-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .option-label {
            font-weight: 500;
        }
        
        .option-description {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
        }
        
        /* Message action menu */
        .message-actions {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--action-menu-bg);
            color: var(--action-menu-text);
            z-index: 20;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }
        
        .message-actions.active {
            transform: translateY(0);
        }
        
        .message-actions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .selected-count {
            font-weight: bold;
        }
        
        .close-actions {
            color: var(--primary-color);
            padding: 8px;
            cursor: pointer;
        }
        
        .action-buttons {
            display: flex;
            padding: 20px;
            justify-content: space-around;
        }
        
        .action-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }
        
        .action-icon {
            font-size: 24px;
            margin-bottom: 8px;
            color: var(--primary-color);
        }
        
        .action-label {
            font-size: 12px;
        }
        
        /* Selection mode indicator */
        .selection-mode-indicator {
            position: fixed;
            top: 50px;
            left: 0;
            right: 0;
            background-color: var(--primary-color);
            color: black;
            padding: 8px 15px;
            font-weight: bold;
            display: none;
            z-index: 15;
            animation: slideDown 0.3s ease;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }
        
        /* AI Chat Styles */
        .ai-chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 0;
        }
        
        .ai-chat-header {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .ai-chat-avatar {
            width: 40px;
            height: 40px;
            background-color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }
        
        .ai-chat-info {
            flex: 1;
        }
        
        .ai-chat-name {
            font-weight: bold;
            font-size: 16px;
        }
        
        .ai-chat-status {
            font-size: 12px;
            color: #6b7280;
        }
        
        .ai-model-selector {
            padding: 10px 15px;
            margin-bottom: 10px;
            background-color: var(--bg-color);
            border-bottom: 1px solid var(--border-color);
        }
        
        .ai-model-dropdown {
            width: 100%;
            padding: 8px 15px;
            border-radius: 15px;
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            font-size: 16px;
        }
        
        .ai-messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            -webkit-overflow-scrolling: touch;
            background-color: var(--secondary-color);
        }
        
        .ai-empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            height: 100%;
            padding: 30px;
        }
        
        .ai-empty-icon {
            font-size: 60px;
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        .ai-empty-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .ai-empty-text {
            color: #6b7280;
            line-height: 1.5;
            max-width: 280px;
            margin: 0 auto;
        }
        
        .ai-message-wrapper {
            display: flex;
            flex-direction: column;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .ai-message {
            max-width: 75%;
            padding: 10px 15px;
            border-radius: 15px;
            line-height: 1.4;
            position: relative;
            word-break: break-word;
        }
        
        .ai-message-user {
            background-color: var(--chat-sent-bg);
            color: var(--chat-sent-text);
            align-self: flex-end;
            border-bottom-right-radius: 5px;
            float: right;
            clear: both;
        }
        
        .ai-message-bot {
            background-color: var(--chat-received-bg);
            color: var(--text-color);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            float: left;
            clear: both;
        }
        
        .ai-message-time {
            font-size: 10px;
            color: #6b7280;
            margin-top: 4px;
            text-align: right;
            clear: both;
        }
        
        .ai-input-container {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background-color: var(--bg-color);
            border-top: 1px solid var(--border-color);
        }
        
        .ai-input {
            flex: 1;
            padding: 10px 15px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            font-size: 16px;
            background-color: var(--secondary-color);
            margin-right: 10px;
        }
        
        .ai-send-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: black;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
        }
        
        .ai-suggestions {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
            gap: 10px;
        }
        
        .ai-suggestion {
            background-color: var(--secondary-color);
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
            text-align: center;
        }
        
        .ai-suggestion:hover, .ai-suggestion:active {
            background-color: var(--border-color);
        }
        
        .message-status {
            padding: 8px 10px;
            background-color: rgba(0, 0, 0, 0.1);
            color: #6b7280;
            font-size: 12px;
            border-radius: 10px;
            text-align: center;
            margin: 5px 0;
            clear: both;
        }
    </style>
</head>
<body>
    <!-- Écran de chargement -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <div style="font-weight: bold; font-size: 24px; color: var(--primary-color);">iChat</div>
        <div style="margin-top: 10px; color: #6b7280;">Chargement...</div>
    </div>

    <!-- En-tête -->
    <div class="header">
        <div id="header-left"></div>
        <div id="header-title" class="header-title">Messages</div>
        <div id="header-action"><i class="fas fa-edit"></i></div>
    </div>

    <!-- Indicateur mode sélection -->
    <div id="selection-indicator" class="selection-mode-indicator">
        Sélection en cours (0)
    </div>

    <!-- Contenu -->
    <div class="content">
        <!-- Section Messages -->
        <div id="messages-section" class="section active">
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Rechercher">
            </div>
            
            <div class="chat-item" onclick="openChat('Marie Dupont')">
                <div class="profile-pic">
                    <i class="fas fa-user" style="color: var(--primary-color);"></i>
                </div>
                <div class="item-content">
                    <div style="display: flex; justify-content: space-between;">
                        <div class="item-title">Marie Dupont</div>
                        <div class="item-time">14:23</div>
                    </div>
                    <div class="item-subtitle">Bonjour, comment vas-tu aujourd'hui?</div>
                </div>
            </div>
            
            <div class="chat-item" onclick="openChat('Pierre Martin')">
                <div class="profile-pic">
                    <i class="fas fa-user" style="color: var(--primary-color);"></i>
                </div>
                <div class="item-content">
                    <div style="display: flex; justify-content: space-between;">
                        <div class="item-title">Pierre Martin</div>
                        <div class="item-time">Hier</div>
                    </div>
                    <div class="item-subtitle">On se voit demain pour le déjeuner?</div>
                </div>
            </div>
            
            <div class="chat-item" onclick="openChat('Sophie Leroy')">
                <div class="profile-pic">
                    <i class="fas fa-user" style="color: var(--primary-color);"></i>
                </div>
                <div class="item-content">
                    <div style="display: flex; justify-content: space-between;">
                        <div class="item-title">Sophie Leroy</div>
                        <div class="item-time">Lun</div>
                    </div>
                    <div class="item-subtitle">Merci pour ton aide!</div>
                </div>
            </div>
            
            <div class="chat-item" onclick="openChat('Thomas Bernard')">
                <div class="profile-pic">
                    <i class="fas fa-user" style="color: var(--primary-color);"></i>
                </div>
                <div class="item-content">
                    <div style="display: flex; justify-content: space-between;">
                        <div class="item-title">Thomas Bernard</div>
                        <div class="item-time">Dim</div>
                    </div>
                    <div class="item-subtitle">J'ai envoyé les documents par email.</div>
                </div>
            </div>
        </div>

        <!-- Section Contacts -->
        <div id="contacts-section" class="section">
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Rechercher un contact">
            </div>
            
            <div style="padding: 0 16px; margin: 15px 0; font-weight: bold; font-size: 18px;">Contacts</div>
            
            <div class="user-item" onclick="openChat('Marie Dupont')">
                <div class="profile-pic">
                    <i class="fas fa-user" style="color: var(--primary-color);"></i>
                </div>
                <div class="item-content">
                    <div class="item-title">Marie Dupont</div>
                    <div class="item-subtitle">En ligne</div>
                </div>
            </div>
            
            <div class="user-item" onclick="openChat('Pierre Martin')">
                <div class="profile-pic">
                    <i class="fas fa-user" style="color: var(--primary-color);"></i>
                </div>
                <div class="item-content">
                    <div class="item-title">Pierre Martin</div>
                    <div class="item-subtitle">Dernière connexion à 13:42</div>
                </div>
            </div>
            
            <div class="user-item" onclick="openChat('Sophie Leroy')">
                <div class="profile-pic">
                    <i class="fas fa-user" style="color: var(--primary-color);"></i>
                </div>
                <div class="item-content">
                    <div class="item-title">Sophie Leroy</div>
                    <div class="item-subtitle">En ligne</div>
                </div>
            </div>
            
            <div class="user-item" onclick="openChat('Thomas Bernard')">
                <div class="profile-pic">
                    <i class="fas fa-user" style="color: var(--primary-color);"></i>
                </div>
                <div class="item-content">
                    <div class="item-title">Thomas Bernard</div>
                    <div class="item-subtitle">Hors ligne</div>
                </div>
            </div>
        </div>

        <!-- Section IA -->
        <div id="ai-section" class="section">
            <div class="ai-chat-container">
                <div class="ai-chat-header">
                    <div class="ai-chat-avatar">
                        <i class="fas fa-robot" style="color: black;"></i>
                    </div>
                    <div class="ai-chat-info">
                        <div class="ai-chat-name">Assistant IA</div>
                        <div class="ai-chat-status">Prêt à échanger</div>
                    </div>
                </div>
                
                <div class="ai-model-selector">
                    <select id="ai-model-select" class="ai-model-dropdown">
                        <option value="mistralai/mistral-7b-instruct" selected>Mistral 7B (Gratuit)</option>
                        <option value="anthropic/claude-3-haiku">Claude 3 Haiku (Gratuit)</option>
                        <option value="google/gemma-7b-it">Gemma 7B (Gratuit)</option>
                    </select>
                </div>
                
                <div id="ai-messages-container" class="ai-messages-container">
                    <div id="ai-empty-state" class="ai-empty-state">
                        <i class="fas fa-robot ai-empty-icon"></i>
                        <div class="ai-empty-title">Assistant IA</div>
                        <p class="ai-empty-text">
                            Posez une question ou essayez une suggestion ci-dessous pour commencer une conversation.
                        </p>
                        <div class="ai-suggestions">
                            <div class="ai-suggestion" onclick="useAiSuggestion(this)">Raconte une histoire courte</div>
                            <div class="ai-suggestion" onclick="useAiSuggestion(this)">Donne-moi une recette</div>
                            <div class="ai-suggestion" onclick="useAiSuggestion(this)">Explique-moi l'IA</div>
                            <div class="ai-suggestion" onclick="useAiSuggestion(this)">Un conseil pour aujourd'hui</div>
                        </div>
                    </div>
                    <div id="ai-messages"></div>
                </div>
                
                <div class="ai-input-container">
                    <input type="text" id="ai-input" class="ai-input" placeholder="Écris un message..." autocomplete="off">
                    <button id="ai-send-button" class="ai-send-button">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Section Profil -->
        <div id="profile-section" class="section">
            <div style="display: flex; align-items: center; justify-content: center; padding: 20px; border-bottom: 1px solid var(--border-color);">
                <div class="profile-pic" style="width: 80px; height: 80px;">
                    <i class="fas fa-user" style="font-size: 30px; color: var(--primary-color);"></i>
                </div>
                <div style="margin-left: 15px;">
                    <div style="font-weight: bold; font-size: 20px;">Jean Dubois</div>
                    <div style="color: #6b7280;">En ligne</div>
                </div>
            </div>
            
            <div style="padding: 0 16px; margin: 15px 0; font-weight: bold; font-size: 18px;">Paramètres</div>
            
            <div class="settings-container">
                <div class="setting-item">
                    <div class="setting-row">
                        <div class="setting-icon">
                            <i class="fas fa-palette" style="color: var(--primary-color);"></i>
                        </div>
                        <div class="setting-label">Couleur de l'interface</div>
                    </div>
                    <input type="color" id="color-picker" value="#F7DC6F" style="width: 30px; height: 30px; border: none;">
                </div>
                
                <div class="setting-item">
                    <div class="setting-row">
                        <div class="setting-icon">
                            <i class="fas fa-moon" style="color: var(--primary-color);"></i>
                        </div>
                        <div class="setting-label">Mode sombre</div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="dark-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="setting-item" onclick="openSettingsPage('notifications-page')">
                    <div class="setting-row">
                        <div class="setting-icon">
                            <i class="fas fa-bell" style="color: var(--primary-color);"></i>
                        </div>
                        <div class="setting-label">Notifications</div>
                    </div>
                    <i class="fas fa-chevron-right" style="color: #6b7280;"></i>
                </div>
                
                <div class="setting-item" onclick="openSettingsPage('privacy-page')">
                    <div class="setting-row">
                        <div class="setting-icon">
                            <i class="fas fa-lock" style="color: var(--primary-color);"></i>
                        </div>
                        <div class="setting-label">Confidentialité</div>
                    </div>
                    <i class="fas fa-chevron-right" style="color: #6b7280;"></i>
                </div>
                
                <button id="logout-btn" class="button">Se déconnecter</button>
            </div>
        </div>
        
        <!-- Page Notifications -->
        <div id="notifications-page" class="settings-page">
            <div class="settings-header">
                <div class="back-button" onclick="closeSettingsPage()">
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="settings-title">Notifications</div>
            </div>
            
            <div class="setting-option">
                <div>
                    <div class="option-label">Notifications de messages</div>
                    <div class="option-description">Recevoir des notifications pour les nouveaux messages</div>
                </div>
                <label class="switch">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-option">
                <div>
                    <div class="option-label">Sons</div>
                    <div class="option-description">Jouer un son lors de la réception d'un message</div>
                </div>
                <label class="switch">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-option">
                <div>
                    <div class="option-label">Notifications d'activité</div>
                    <div class="option-description">Être notifié quand quelqu'un est en ligne</div>
                </div>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-option">
                <div>
                    <div class="option-label">Ne pas déranger</div>
                    <div class="option-description">Désactiver toutes les notifications</div>
                </div>
                <label class="switch">
                    <input type="checkbox">
                    <span class="slider"></span>
                </label>
            </div>
        </div>
        
        <!-- Page Confidentialité -->
        <div id="privacy-page" class="settings-page">
            <div class="settings-header">
                <div class="back-button" onclick="closeSettingsPage()">
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="settings-title">Confidentialité</div>
            </div>
            
            <div class="setting-option">
                <div>
                    <div class="option-label">Statut actif</div>
                    <div class="option-description">Montrer quand vous êtes actif</div>
                </div>
                <label class="switch">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-option">
                <div>
                    <div class="option-label">Lecture des messages</div>
                    <div class="option-description">Montrer que vous avez lu les messages</div>
                </div>
                <label class="switch">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                </label>
            </div>
            
            <div class="setting-option">
                <div>
                    <div class="option-label">Blocage des contacts</div>
                    <div class="option-description">Gérer la liste des contacts bloqués</div>
                </div>
                <i class="fas fa-chevron-right" style="color: #6b7280;"></i>
            </div>
            
            <div class="setting-option">
                <div>
                    <div class="option-label">Chiffrement de bout en bout</div>
                    <div class="option-description">Messages chiffrés pendant le transit</div>
                </div>
                <label class="switch">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>
    </div>

    <!-- Interface de Chat - En dehors du content pour un positionnement fixe -->
    <div id="chat-interface" class="chat-section">
        <div class="chat-messages-container">
            <div class="chat-messages" id="chat-messages">
                <!-- Les messages seront ajoutés dynamiquement ici -->
            </div>
        </div>
        <div class="chat-input-container">
            <input type="text" class="chat-input" id="chat-input" placeholder="Écrire un message..." autocomplete="off">
            <button class="send-button" id="send-button">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Menu d'actions pour les messages sélectionnés -->
    <div id="message-actions" class="message-actions">
        <div class="message-actions-header">
            <div class="selected-count" id="selected-count">1 sélectionné</div>
            <div class="close-actions" onclick="exitSelectionMode()">Annuler</div>
        </div>
        <div class="action-buttons">
            <div class="action-button" onclick="deleteSelectedMessages()">
                <div class="action-icon"><i class="fas fa-trash-alt"></i></div>
                <div class="action-label">Supprimer</div>
            </div>
            <div class="action-button">
                <div class="action-icon"><i class="fas fa-share"></i></div>
                <div class="action-label">Transférer</div>
            </div>
            <div class="action-button">
                <div class="action-icon"><i class="fas fa-copy"></i></div>
                <div class="action-label">Copier</div>
            </div>
            <div class="action-button">
                <div class="action-icon"><i class="fas fa-reply"></i></div>
                <div class="action-label">Répondre</div>
            </div>
        </div>
    </div>

    <!-- Barre d'onglets -->
    <div class="tabbar" id="tabbar">
        <a href="javascript:void(0);" class="tab active" onclick="changeTab('messages')">
            <div class="badge">
                <i class="tab-icon fas fa-comments"></i>
                <span class="dot"></span>
            </div>
            <span>Messages</span>
        </a>
        <a href="javascript:void(0);" class="tab" onclick="changeTab('contacts')">
            <i class="tab-icon fas fa-users"></i>
            <span>Contacts</span>
        </a>
        <a href="javascript:void(0);" class="tab" onclick="changeTab('ai')">
            <i class="tab-icon fas fa-robot"></i>
            <span>IA</span>
        </a>
        <a href="javascript:void(0);" class="tab" onclick="changeTab('profile')">
            <i class="tab-icon fas fa-user"></i>
            <span>Profil</span>
        </a>
    </div>

    <script>
        // Fonction pour masquer l'écran de chargement
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        // Simuler un temps de chargement
        setTimeout(hideLoading, 1500);
        
        // Messages pré-définis pour les conversations
        const chatMessages = {
            'Marie Dupont': [
                { id: 'md1', text: 'Bonjour, comment vas-tu aujourd\'hui?', from: 'them', time: '14:00' },
                { id: 'md2', text: 'Je vais bien, merci ! Et toi ?', from: 'me', time: '14:05' },
                { id: 'md3', text: 'Très bien ! Tu fais quoi ce weekend ?', from: 'them', time: '14:10' },
                { id: 'md4', text: 'Rien de spécial, pourquoi ?', from: 'me', time: '14:15' },
                { id: 'md5', text: 'On pourrait aller au cinéma ?', from: 'them', time: '14:23' }
            ],
            'Pierre Martin': [
                { id: 'pm1', text: 'Salut, tu as reçu mon email ?', from: 'them', time: '13:30' },
                { id: 'pm2', text: 'Oui, je l\'ai lu ce matin', from: 'me', time: '13:45' },
                { id: 'pm3', text: 'Super ! Alors on se voit demain pour le déjeuner?', from: 'them', time: '14:00' }
            ],
            'Sophie Leroy': [
                { id: 'sl1', text: 'J\'ai besoin de ton aide pour un projet', from: 'them', time: 'Lun 10:15' },
                { id: 'sl2', text: 'Bien sûr, comment je peux t\'aider ?', from: 'me', time: 'Lun 10:30' },
                { id: 'sl3', text: 'Je t\'envoie les détails par email', from: 'them', time: 'Lun 11:00' },
                { id: 'sl4', text: 'Pas de problème, je vais regarder ça', from: 'me', time: 'Lun 11:15' },
                { id: 'sl5', text: 'Merci pour ton aide!', from: 'them', time: 'Lun 15:45' }
            ],
            'Thomas Bernard': [
                { id: 'tb1', text: 'As-tu reçu les documents que je t\'ai envoyés ?', from: 'them', time: 'Dim 09:20' },
                { id: 'tb2', text: 'Non, pas encore. Tu les as envoyés quand ?', from: 'me', time: 'Dim 10:45' },
                { id: 'tb3', text: 'Ce matin. Je te les renvoie', from: 'them', time: 'Dim 11:30' },
                { id: 'tb4', text: 'D\'accord, merci', from: 'me', time: 'Dim 11:45' },
                { id: 'tb5', text: 'J\'ai envoyé les documents par email.', from: 'them', time: 'Dim 14:00' }
            ]
        };
        
        // Variable pour stocker le contact actuel
        var currentContact = '';
        
        // Variables pour la sélection des messages
        var isSelectionMode = false;
        var selectedMessages = new Set();
        var longPressTimer;
        var longPressDuration = 500; // Durée en ms pour activer le maintien long
        
        // Gestion des interactions tactiles
        var touchStartX = 0;
        var touchStartY = 0;
        var isTouchMoved = false;
        
        // Fonction pour changer d'onglet
        function changeTab(tabName) {
            // Si on est dans l'interface de chat, retourner à la liste des messages
            if (document.getElementById('chat-interface').style.display === 'block') {
                closeChat();
                if (tabName === 'messages') return;
            }
            
            // Si on est dans une page de paramètres, fermer cette page
            var settingsPages = document.querySelectorAll('.settings-page');
            for (var i = 0; i < settingsPages.length; i++) {
                if (settingsPages[i].classList.contains('active')) {
                    closeSettingsPage();
                    if (tabName === 'profile') return;
                }
            }
            
            // Si on est en mode sélection, quitter ce mode
            if (isSelectionMode) {
                exitSelectionMode();
            }
            
            // Mettre à jour les onglets actifs
            var tabs = document.getElementsByClassName('tab');
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // Trouver le nouvel onglet actif
            if (tabName === 'messages') {
                tabs[0].classList.add('active');
                document.getElementById('header-title').innerText = 'Messages';
                document.getElementById('header-action').innerHTML = '<i class="fas fa-edit"></i>';
                document.getElementById('header-left').innerHTML = '';
            } else if (tabName === 'contacts') {
                tabs[1].classList.add('active');
                document.getElementById('header-title').innerText = 'Contacts';
                document.getElementById('header-action').innerHTML = '<i class="fas fa-user-plus"></i>';
                document.getElementById('header-left').innerHTML = '';
            } else if (tabName === 'ai') {
                tabs[2].classList.add('active');
                document.getElementById('header-title').innerText = 'Assistants IA';
                document.getElementById('header-action').innerHTML = '';
                document.getElementById('header-left').innerHTML = '';
            } else if (tabName === 'profile') {
                tabs[3].classList.add('active');
                document.getElementById('header-title').innerText = 'Profil';
                document.getElementById('header-action').innerHTML = '<i class="fas fa-cog"></i>';
                document.getElementById('header-left').innerHTML = '';
            }
            
            // Masquer toutes les sections
            var sections = document.getElementsByClassName('section');
            for (var i = 0; i < sections.length; i++) {
                sections[i].classList.remove('active');
            }
            
            // Afficher la section active
            document.getElementById(tabName + '-section').classList.add('active');
        }
        
        // Fonction pour ouvrir une conversation
        function openChat(contact) {
            currentContact = contact;
            
            // Cacher la barre d'onglets
            document.getElementById('tabbar').style.display = 'none';
            
            // Cacher les sections normales
            var sections = document.getElementsByClassName('section');
            for (var i = 0; i < sections.length; i++) {
                sections[i].classList.remove('active');
            }
            
            // Mettre à jour l'en-tête
            document.getElementById('header-title').innerText = contact;
            document.getElementById('header-action').innerHTML = '<i class="fas fa-info-circle"></i>';
            document.getElementById('header-left').innerHTML = '<div class="back-button" onclick="closeChat()"><i class="fas fa-chevron-left"></i></div>';
            
            // Afficher l'interface de chat
            document.getElementById('chat-interface').style.display = 'block';
            
            // Charger les messages
            loadChatMessages(contact);
        }
        
        // Fonction pour fermer une conversation
        function closeChat() {
            // Si on est en mode sélection, le quitter d'abord
            if (isSelectionMode) {
                exitSelectionMode();
            }
            
            // Afficher la barre d'onglets
            document.getElementById('tabbar').style.display = 'flex';
            
            // Cacher l'interface de chat
            document.getElementById('chat-interface').style.display = 'none';
            
            // Réinitialiser l'en-tête
            document.getElementById('header-title').innerText = 'Messages';
            document.getElementById('header-action').innerHTML = '<i class="fas fa-edit"></i>';
            document.getElementById('header-left').innerHTML = '';
            
            // Afficher la section messages
            document.getElementById('messages-section').classList.add('active');
            
            // Réinitialiser le contact actuel
            currentContact = '';
        }
        
        // Fonction pour charger les messages d'une conversation
        function loadChatMessages(contact) {
            var messagesContainer = document.getElementById('chat-messages');
            messagesContainer.innerHTML = '';
            
            if (chatMessages[contact]) {
                // Créer un fragment pour améliorer les performances
                var fragment = document.createDocumentFragment();
                
                // Ajouter les messages dans l'ordre chronologique
                for (var i = 0; i < chatMessages[contact].length; i++) {
                    var msg = chatMessages[contact][i];
                    var messageDiv = document.createElement('div');
                    messageDiv.className = 'message ' + (msg.from === 'me' ? 'message-sent' : 'message-received');
                    messageDiv.setAttribute('data-id', msg.id);
                    messageDiv.setAttribute('data-from', msg.from);
                    
                    var messageText = document.createElement('div');
                    messageText.textContent = msg.text;
                    
                    var messageTime = document.createElement('div');
                    messageTime.className = 'message-time';
                    messageTime.textContent = msg.time;
                    
                    messageDiv.appendChild(messageText);
                    messageDiv.appendChild(messageTime);
                    
                    // Ajouter les gestionnaires d'événements pour la sélection
                    addMessageEventListeners(messageDiv);
                    
                    fragment.appendChild(messageDiv);
                }
                
                // Après l'ajout de tous les messages, créer un élément div pour le clearfix
                var clearfix = document.createElement('div');
                clearfix.style.clear = 'both';
                fragment.appendChild(clearfix);
                
                messagesContainer.appendChild(fragment);
            }
            
            // Faire défiler vers le bas pour voir les messages les plus récents
            var chatMessagesContainer = document.querySelector('.chat-messages-container');
            chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
        }
        
        // Fonction pour ajouter des gestionnaires d'événements aux messages
        function addMessageEventListeners(messageElement) {
            // Gestion des événements tactiles (pour les mobiles)
            messageElement.addEventListener('touchstart', function(e) {
                var touch = e.touches[0];
                touchStartX = touch.clientX;
                touchStartY = touch.clientY;
                isTouchMoved = false;
                
                // Démarrer le timer pour le maintien long
                longPressTimer = setTimeout(function() {
                    if (!isTouchMoved) {
                        handleLongPress(messageElement);
                    }
                }, longPressDuration);
            });
            
            messageElement.addEventListener('touchmove', function(e) {
                if (!e.touches[0]) return;
                
                var touch = e.touches[0];
                var deltaX = Math.abs(touch.clientX - touchStartX);
                var deltaY = Math.abs(touch.clientY - touchStartY);
                
                // Si déplacement significatif, annuler le maintien
                if (deltaX > 10 || deltaY > 10) {
                    isTouchMoved = true;
                    clearTimeout(longPressTimer);
                }
            });
            
            messageElement.addEventListener('touchend', function() {
                clearTimeout(longPressTimer);
                
                if (!isTouchMoved && isSelectionMode) {
                    toggleMessageSelection(this);
                }
            });
            
            // Gestion des clics (pour les ordinateurs)
            messageElement.addEventListener('click', function(e) {
                if (isSelectionMode) {
                    toggleMessageSelection(this);
                    e.preventDefault();
                }
            });
            
            // Gestion du clic droit (pour les ordinateurs)
            messageElement.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                handleLongPress(this);
            });
        }
        
        // Fonction pour activer le mode de sélection
        function handleLongPress(message) {
            if (!isSelectionMode) {
                enterSelectionMode();
            }
            
            toggleMessageSelection(message);
            
            // Vibration pour retour tactile (si supporté)
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }
        
        // Fonction pour entrer en mode sélection
        function enterSelectionMode() {
            isSelectionMode = true;
            
            // Afficher l'indicateur de sélection
            document.getElementById('selection-indicator').style.display = 'block';
            
            // Mettre à jour l'en-tête
            document.getElementById('header-action').innerHTML = '<div class="select-all-btn" onclick="selectAllMessages()">Tout</div>';
            
            // Activer le menu d'actions
            document.getElementById('message-actions').classList.add('active');
            
            // Désactiver la saisie de message
            document.getElementById('chat-input').disabled = true;
            document.getElementById('send-button').disabled = true;
        }
        
        // Fonction pour quitter le mode sélection
        function exitSelectionMode() {
            isSelectionMode = false;
            selectedMessages.clear();
            
            // Masquer l'indicateur de sélection
            document.getElementById('selection-indicator').style.display = 'none';
            
            // Retirer la classe selected de tous les messages
            var selectedMessageElements = document.querySelectorAll('.message.selected');
            for (var i = 0; i < selectedMessageElements.length; i++) {
                selectedMessageElements[i].classList.remove('selected');
            }
            
            // Restaurer l'en-tête
            document.getElementById('header-action').innerHTML = '<i class="fas fa-info-circle"></i>';
            
            // Désactiver le menu d'actions
            document.getElementById('message-actions').classList.remove('active');
            
            // Réactiver la saisie de message
            document.getElementById('chat-input').disabled = false;
            document.getElementById('send-button').disabled = false;
        }
        
        // Fonction pour sélectionner/désélectionner un message
        function toggleMessageSelection(message) {
            var messageId = message.getAttribute('data-id');
            
            if (selectedMessages.has(messageId)) {
                selectedMessages.delete(messageId);
                message.classList.remove('selected');
            } else {
                selectedMessages.add(messageId);
                message.classList.add('selected');
            }
            
            updateSelectionCount();
        }
        
        // Fonction pour mettre à jour le compteur de sélection
        function updateSelectionCount() {
            var count = selectedMessages.size;
            document.getElementById('selected-count').innerText = count + (count === 1 ? ' sélectionné' : ' sélectionnés');
            document.getElementById('selection-indicator').innerText = 'Sélection en cours (' + count + ')';
            
            // Sortir du mode sélection si aucun message n'est sélectionné
            if (count === 0) {
                exitSelectionMode();
            }
        }
        
        // Fonction pour sélectionner tous les messages
        function selectAllMessages() {
            var messages = document.querySelectorAll('.message');
            
            for (var i = 0; i < messages.length; i++) {
                var messageId = messages[i].getAttribute('data-id');
                selectedMessages.add(messageId);
                messages[i].classList.add('selected');
            }
            
            updateSelectionCount();
        }
        
        // Fonction pour supprimer les messages sélectionnés
        function deleteSelectedMessages() {
            if (selectedMessages.size === 0) return;
            
            // Créer une copie des messages à conserver
            var messagesForContact = [];
            
            for (var i = 0; i < chatMessages[currentContact].length; i++) {
                var msg = chatMessages[currentContact][i];
                if (!selectedMessages.has(msg.id)) {
                    messagesForContact.push(msg);
                }
            }
            
            // Mettre à jour les messages
            chatMessages[currentContact] = messagesForContact;
            
            // Recharger la conversation
            loadChatMessages(currentContact);
            
            // Quitter le mode sélection
            exitSelectionMode();
            
            // Afficher brièvement une notification
            var notification = document.createElement('div');
            notification.textContent = 'Message(s) supprimé(s)';
            notification.style.position = 'fixed';
            notification.style.bottom = '90px';
            notification.style.left = '50%';
            notification.style.transform = 'translateX(-50%)';
            notification.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
            notification.style.color = 'white';
            notification.style.padding = '10px 20px';
            notification.style.borderRadius = '20px';
            notification.style.zIndex = '100';
            
            document.body.appendChild(notification);
            
            setTimeout(function() {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.5s ease';
                
                setTimeout(function() {
                    document.body.removeChild(notification);
                }, 500);
            }, 2000);
        }
        
        // Fonction pour envoyer un message
        function sendMessage() {
            var input = document.getElementById('chat-input');
            var message = input.value.trim();
            
            if (message === '') return;
            
            var now = new Date();
            var time = now.getHours() + ':' + (now.getMinutes() < 10 ? '0' : '') + now.getMinutes();
            var messageId = 'msg_' + Date.now(); // Id unique basé sur le timestamp
            
            // Ajouter le message à la liste des messages
            if (!chatMessages[currentContact]) {
                chatMessages[currentContact] = [];
            }
            
            chatMessages[currentContact].push({
                id: messageId,
                text: message,
                from: 'me',
                time: time
            });
            
            // Recharger les messages
            loadChatMessages(currentContact);
            
            // Vider l'entrée
            input.value = '';
            
            // Simuler une réponse après 1-3 secondes
            setTimeout(function() {
                var responses = [
                    "D'accord, je vois.",
                    "Je comprends !",
                    "Intéressant...",
                    "Merci pour cette information.",
                    "Très bien !",
                    "Je suis d'accord avec toi."
                ];
                
                var randomResponse = responses[Math.floor(Math.random() * responses.length)];
                var responseTime = (parseInt(time.split(':')[0]) + (Math.random() > 0.5 ? 0 : 1)) + ':' + 
                    Math.floor(Math.random() * 60).toString().padStart(2, '0');
                var responseId = 'msg_' + (Date.now() + 1);
                
                chatMessages[currentContact].push({
                    id: responseId,
                    text: randomResponse,
                    from: 'them',
                    time: responseTime
                });
                
                loadChatMessages(currentContact);
            }, 1000 + Math.random() * 2000);
        }
        
        // Initialiser l'événement d'envoi de message
        document.getElementById('send-button').addEventListener('click', sendMessage);
        document.getElementById('chat-input').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Fonctions pour les pages de paramètres
        function openSettingsPage(pageId) {
            // Cacher toutes les sections
            var sections = document.getElementsByClassName('section');
            for (var i = 0; i < sections.length; i++) {
                sections[i].classList.remove('active');
            }
            
            // Fermer toutes les autres pages de paramètres
            var settingsPages = document.getElementsByClassName('settings-page');
            for (var i = 0; i < settingsPages.length; i++) {
                settingsPages[i].classList.remove('active');
            }
            
            // Afficher la page de paramètres demandée
            document.getElementById(pageId).classList.add('active');
            
            // Mettre à jour l'en-tête
            var title = pageId === 'notifications-page' ? 'Notifications' : 'Confidentialité';
            document.getElementById('header-title').innerText = title;
            document.getElementById('header-action').innerHTML = '';
            document.getElementById('header-left').innerHTML = '<div class="back-button" onclick="closeSettingsPage()"><i class="fas fa-chevron-left"></i></div>';
        }
        
        function closeSettingsPage() {
            // Fermer toutes les pages de paramètres
            var settingsPages = document.getElementsByClassName('settings-page');
            for (var i = 0; i < settingsPages.length; i++) {
                settingsPages[i].classList.remove('active');
            }
            
            // Réinitialiser l'en-tête
            document.getElementById('header-title').innerText = 'Profil';
            document.getElementById('header-action').innerHTML = '<i class="fas fa-cog"></i>';
            document.getElementById('header-left').innerHTML = '';
            
            // Afficher la section profil
            document.getElementById('profile-section').classList.add('active');
        }
        
        // Initialiser le sélecteur de couleur
        document.getElementById('color-picker').addEventListener('input', function(e) {
            document.documentElement.style.setProperty('--primary-color', e.target.value);
            
            // En mode sombre, mettre à jour la couleur des messages envoyés
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.style.setProperty('--chat-sent-bg', e.target.value);
            }
        });
        
        // Initialiser le bouton de déconnexion
        document.getElementById('logout-btn').addEventListener('click', function() {
            document.getElementById('loading').style.display = 'flex';
            document.querySelector('.loading div:nth-child(3)').innerText = 'Déconnexion...';
            setTimeout(function() {
                window.location.reload();
            }, 1000);
        });
        
        // Fonction pour le mode sombre
        function enableDarkMode(enabled) {
            if (enabled) {
                document.documentElement.classList.add('dark');
                // En mode sombre, la couleur du message est la même que la couleur primaire
                document.documentElement.style.setProperty('--chat-sent-bg', document.documentElement.style.getPropertyValue('--primary-color') || '#F7DC6F');
            } else {
                document.documentElement.classList.remove('dark');
                // En mode clair, la couleur du message est violette
                document.documentElement.style.setProperty('--chat-sent-bg', '#5D5CDE');
            }
        }
        
        // Événement pour le mode sombre
        document.getElementById('dark-toggle').addEventListener('change', function() {
            enableDarkMode(this.checked);
        });
        
        // Optimisation pour iOS 11 Safari - Éviter les problèmes avec le clavier virtuel
        document.addEventListener('focusin', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                // Ajouter un petit délai pour que le clavier ait le temps d'apparaître
                setTimeout(function() {
                    // Faire défiler pour voir l'input
                    document.documentElement.scrollTop = document.documentElement.scrollHeight;
                }, 300);
            }
        });
        
        // Éviter le zoom sur double-tap pour iOS Safari
        var lastTouchEnd = 0;
        document.addEventListener('touchend', function(e) {
            var now = Date.now();
            var timeDiff = now - lastTouchEnd;
            
            if (timeDiff < 300) {
                e.preventDefault();
            }
            
            lastTouchEnd = now;
        }, false);
        
        // Rendre l'écran de notification adaptatif pour iOS Safari
        window.addEventListener('resize', function() {
            if (document.activeElement && (document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA')) {
                setTimeout(function() {
                    document.documentElement.scrollTop = document.documentElement.scrollHeight;
                }, 100);
            }
        });
        
        /* Fonctionnalités pour le Chat IA - Optimisées pour iOS 11 */
        
        // Variables pour le chat IA
        var aiMessages = [];
        var systemPrompt = "Tu es un assistant utile et amical. Essaie de garder tes réponses claires et concises pour s'adapter au format de chat mobile.";
        var apiKey = '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';
        var aiIsTyping = false;
        
        // Ajouter des gestionnaires d'événements pour l'envoi de messages IA
        document.getElementById('ai-send-button').addEventListener('click', sendAiMessage);
        document.getElementById('ai-input').addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                sendAiMessage();
            }
        });
        
        // Fonction pour utiliser une suggestion
        function useAiSuggestion(element) {
            document.getElementById('ai-input').value = element.textContent;
            sendAiMessage();
        }
        
        // Fonction pour ajouter un message au chat IA
        function addAiMessage(text, sender, isStatusMessage) {
            // Masquer l'état vide si c'est le premier message
            if (document.getElementById('ai-messages').childElementCount === 0) {
                document.getElementById('ai-empty-state').style.display = 'none';
            }
            
            var messagesContainer = document.getElementById('ai-messages');
            
            if (isStatusMessage) {
                var statusDiv = document.createElement('div');
                statusDiv.className = 'message-status';
                statusDiv.id = 'ai-status-message';
                statusDiv.textContent = text;
                messagesContainer.appendChild(statusDiv);
                return statusDiv;
            }
            
            var messageDiv = document.createElement('div');
            messageDiv.className = 'ai-message ' + (sender === 'user' ? 'ai-message-user' : 'ai-message-bot');
            messageDiv.textContent = text;
            
            var now = new Date();
            var time = now.getHours() + ':' + (now.getMinutes() < 10 ? '0' : '') + now.getMinutes();
            
            var timeDiv = document.createElement('div');
            timeDiv.className = 'ai-message-time';
            timeDiv.textContent = time;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.appendChild(timeDiv);
            
            // Clearfix
            var clearfix = document.createElement('div');
            clearfix.style.clear = 'both';
            messagesContainer.appendChild(clearfix);
            
            // Faire défiler vers le bas
            var chatContainer = document.getElementById('ai-messages-container');
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            return messageDiv;
        }
        
        // Fonction pour envoyer un message à l'IA (optimisée pour iOS 11)
        function sendAiMessage() {
            var input = document.getElementById('ai-input');
            var userText = input.value.trim();
            
            if (!userText || aiIsTyping) return;
            
            // Ajouter le message de l'utilisateur à l'interface
            addAiMessage(userText, 'user');
            
            // Vider l'entrée et désactiver
            input.value = "";
            input.disabled = true;
            document.getElementById('ai-send-button').disabled = true;
            
            // Ajouter un message de statut
            var statusMsg = addAiMessage('L\'IA réfléchit...', null, true);
            aiIsTyping = true;
            
            // Sauvegarder les messages pour le contexte
            aiMessages.push({role: "user", content: userText});
            
            // Préparer les messages à envoyer
            var messages = [{role: "system", content: systemPrompt}].concat(aiMessages);
            
            // Préparer les données de la requête
            var modelSelect = document.getElementById('ai-model-select');
            var requestData = {
                model: modelSelect.value,
                messages: messages
            };
            
            // Créer une requête XMLHttpRequest (compatible iOS 11)
            var xhr = new XMLHttpRequest();
            xhr.open('POST', 'https://openrouter.ai/api/v1/chat/completions', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.setRequestHeader('Authorization', 'Bearer ' + apiKey);
            
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (statusMsg) {
                        statusMsg.parentNode.removeChild(statusMsg);
                    }
                    
                    if (xhr.status === 200) {
                        try {
                            var response = JSON.parse(xhr.responseText);
                            var botReply = response.choices[0].message.content;
                            
                            // Ajouter la réponse à l'interface
                            addAiMessage(botReply, 'bot');
                            
                            // Sauvegarder la réponse pour le contexte
                            aiMessages.push({role: "assistant", content: botReply});
                            
                            // Si le contexte devient trop long, le raccourcir
                            if (aiMessages.length > 10) {
                                aiMessages = aiMessages.slice(-10);
                            }
                        } catch (error) {
                            console.error("Erreur de l'API:", error);
                            addAiMessage("Je n'ai pas pu répondre. Veuillez réessayer.", null, true);
                        }
                    } else {
                        console.error("Erreur de l'API:", xhr.status);
                        addAiMessage("Erreur de connexion. Veuillez réessayer plus tard.", null, true);
                    }
                    
                    // Réactiver l'interface
                    input.disabled = false;
                    document.getElementById('ai-send-button').disabled = false;
                    input.focus();
                    aiIsTyping = false;
                }
            };
            
            // Gérer les erreurs de connexion
            xhr.onerror = function() {
                if (statusMsg) {
                    statusMsg.parentNode.removeChild(statusMsg);
                }
                
                addAiMessage("Erreur de connexion au service d'IA. Vérifiez votre connexion internet.", null, true);
                
                // Réactiver l'interface
                input.disabled = false;
                document.getElementById('ai-send-button').disabled = false;
                aiIsTyping = false;
            };
            
            // Envoyer la requête
            xhr.send(JSON.stringify(requestData));
        }
    </script>
</body>
</html>
