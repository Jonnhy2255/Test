<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convertisseur Image → SVG (Optimisé)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/imagetracerjs@1.2.6/imagetracer_v1.2.6.js"></script>
    <style>
        body { transition: background-color 0.3s ease; }
        .loading-spinner {
            border: 3px solid rgba(93, 92, 222, 0.1);
            border-radius: 50%;
            border-top: 3px solid #5D5CDE;
            width: 40px; height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);} }
        .drop-zone {
            border: 3px dashed #5D5CDE;
            transition: all 0.3s ease;
        }
        .drop-zone.dragover {
            background-color: rgba(93, 92, 222, 0.1);
            border-color: #4a49b8;
        }
        .image-container img, .image-container svg {
            max-width: 100%;
            max-height: 500px;
            object-fit: contain;
        }
        .slider-container { position: relative; }
        .slider-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: #5D5CDE;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body class="bg-white dark:bg-[#181818] min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <h1 class="text-4xl font-bold text-center mb-2 text-gray-900 dark:text-white">
            Convertisseur Image → SVG (Optimisé)
        </h1>
        <p class="text-center text-gray-600 dark:text-gray-400 mb-8">
            Transformez vos images en vecteurs SVG de haute précision
        </p>

        <!-- Zone de dépôt -->
        <div id="dropZone" class="drop-zone rounded-lg p-12 text-center mb-8 cursor-pointer bg-gray-50 dark:bg-gray-800">
            <input type="file" id="fileInput" accept="image/*" class="hidden">
            <svg class="mx-auto h-16 w-16 text-gray-400 dark:text-gray-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
            <p class="text-lg text-gray-700 dark:text-gray-300 mb-2">
                Cliquez pour sélectionner une image ou glissez-la ici
            </p>
            <p class="text-sm text-gray-500 dark:text-gray-400">
                PNG, JPG, GIF jusqu’à 10MB
            </p>
        </div>

        <!-- Paramètres -->
        <div id="controlsSection" class="hidden mb-8 bg-gray-50 dark:bg-gray-800 rounded-lg p-6">
            <h2 class="text-xl font-semibold mb-4 text-gray-900 dark:text-white">Paramètres de vectorisation</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Précision des couleurs
                    </label>
                    <div class="slider-container">
                        <span id="colorSamplingValue" class="slider-value">1</span>
                        <input type="range" id="colorSampling" min="1" max="4" value="1" step="0.5" class="w-full">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Lissage des contours
                    </label>
                    <div class="slider-container">
                        <span id="pathOmitValue" class="slider-value">2</span>
                        <input type="range" id="pathOmit" min="0" max="20" value="2" step="1" class="w-full">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Nombre de couleurs
                    </label>
                    <div class="slider-container">
                        <span id="numberOfColorsValue" class="slider-value">32</span>
                        <input type="range" id="numberOfColors" min="2" max="64" value="32" step="1" class="w-full">
                    </div>
                </div>
                <div class="flex flex-col gap-4">
                    <button id="convertBtn"
                            class="w-full bg-[#5D5CDE] hover:bg-[#4a49b8] text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                        Convertir en SVG
                    </button>
                    <button id="highPrecisionBtn"
                            class="w-full bg-[#3a3aad] hover:bg-[#2f2f8c] text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                        Vectorisation haute précision
                    </button>
                </div>
            </div>
        </div>

        <!-- Chargement -->
        <div id="loadingSection" class="hidden text-center py-12">
            <div class="loading-spinner mx-auto mb-4"></div>
            <p class="text-gray-700 dark:text-gray-300">Conversion en cours...</p>
        </div>

        <!-- Résultats -->
        <div id="resultsSection" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div>
                    <h3 class="text-lg font-semibold mb-3 text-gray-900 dark:text-white">Image originale</h3>
                    <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-4 image-container flex items-center justify-center min-h-[300px]">
                        <img id="originalImage" class="rounded">
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-3 text-gray-900 dark:text-white">Vecteur SVG</h3>
                    <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-4 image-container flex items-center justify-center min-h-[300px]" id="svgContainer"></div>
                </div>
            </div>
            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">SVG prêt</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400" id="svgInfo"></p>
                    </div>
                    <div class="flex gap-3">
                        <button id="downloadBtn" class="bg-[#5D5CDE] hover:bg-[#4a49b8] text-white font-semibold py-2 px-6 rounded-lg transition-colors">
                            Télécharger SVG
                        </button>
                        <button id="newImageBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
                            Nouvelle image
                        </button>
                    </div>
                </div>

                <!-- Code SVG brut -->
                <div class="mt-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Code SVG</h3>
                    <textarea id="svgCode"
                        class="w-full bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 p-4 rounded-lg font-mono text-sm h-60"
                        readonly></textarea>
                    <button id="copySvgBtn"
                        class="mt-3 bg-[#5D5CDE] hover:bg-[#4a49b8] text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                        Copier le code
                    </button>
                </div>
            </div>
        </div>
    </div>

<script>
if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)
    document.documentElement.classList.add('dark');
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
    document.documentElement.classList.toggle('dark', e.matches);
});

const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const controlsSection = document.getElementById('controlsSection');
const loadingSection = document.getElementById('loadingSection');
const resultsSection = document.getElementById('resultsSection');
const originalImage = document.getElementById('originalImage');
const svgContainer = document.getElementById('svgContainer');
const convertBtn = document.getElementById('convertBtn');
const highPrecisionBtn = document.getElementById('highPrecisionBtn');
const downloadBtn = document.getElementById('downloadBtn');
const newImageBtn = document.getElementById('newImageBtn');
const svgInfo = document.getElementById('svgInfo');
const svgCode = document.getElementById('svgCode');
const copySvgBtn = document.getElementById('copySvgBtn');

const colorSampling = document.getElementById('colorSampling');
const pathOmit = document.getElementById('pathOmit');
const numberOfColors = document.getElementById('numberOfColors');

let currentImageFile = null;
let currentSvgString = '';

function updateSlider(id, value) { document.getElementById(id).textContent = value; }
colorSampling.addEventListener('input', e => updateSlider('colorSamplingValue', e.target.value));
pathOmit.addEventListener('input', e => updateSlider('pathOmitValue', e.target.value));
numberOfColors.addEventListener('input', e => updateSlider('numberOfColorsValue', e.target.value));

dropZone.addEventListener('click', () => fileInput.click());
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', e => {
    e.preventDefault(); dropZone.classList.remove('dragover');
    if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
});
fileInput.addEventListener('change', e => { if (e.target.files.length > 0) handleFile(e.target.files[0]); });

function handleFile(file) {
    if (!file.type.startsWith('image/')) return showNotification('Erreur', 'Veuillez sélectionner une image valide.');
    if (file.size > 10 * 1024 * 1024) return showNotification('Erreur', 'L’image ne doit pas dépasser 10MB.');
    currentImageFile = file;
    const reader = new FileReader();
    reader.onload = e => {
        originalImage.src = e.target.result;
        controlsSection.classList.remove('hidden');
        resultsSection.classList.add('hidden');
    };
    reader.readAsDataURL(file);
}

function vectorize(highPrecision = false) {
    if (!currentImageFile) return;
    loadingSection.classList.remove('hidden');
    controlsSection.classList.add('hidden');
    resultsSection.classList.add('hidden');

    const reader = new FileReader();
    reader.onload = e => {
        const img = new Image();
        img.onload = () => {
            const opts = highPrecision ? {
                numberofcolors: 48, colorsampling: 1, pathomit: 1, ltres: 0.3, qtres: 0.3,
                blurradius: 0.3, blurdelta: 5, roundcoords: 1, strokewidth: 1, desc: true, viewbox: true,
            } : {
                numberofcolors: parseInt(numberOfColors.value),
                colorsampling: parseFloat(colorSampling.value),
                pathomit: parseFloat(pathOmit.value),
                blurradius: 0.3, blurdelta: 5, ltres: 0.3, qtres: 0.3,
                roundcoords: 1, desc: true, viewbox: true,
            };

            ImageTracer.imageToSVG(img.src, svgString => {
                svgString = svgString.replace(/\s+/g, ' ');
                currentSvgString = svgString;
                svgContainer.innerHTML = svgString;
                svgCode.value = svgString;
                const sizeKB = (new Blob([svgString]).size / 1024).toFixed(2);
                svgInfo.textContent = `Taille: ${sizeKB} KB ${highPrecision ? '(haute précision)' : ''}`;
                loadingSection.classList.add('hidden');
                resultsSection.classList.remove('hidden');
            }, opts);
        };
        img.src = e.target.result;
    };
    reader.readAsDataURL(currentImageFile);
}

convertBtn.addEventListener('click', () => vectorize(false));
highPrecisionBtn.addEventListener('click', () => vectorize(true));

downloadBtn.addEventListener('click', () => {
    const blob = new Blob([currentSvgString], { type: 'image/svg+xml' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = currentImageFile.name.replace(/\.[^/.]+$/, '') + '.svg';
    a.click();
    URL.revokeObjectURL(url);
});

copySvgBtn.addEventListener('click', () => {
    svgCode.select();
    document.execCommand('copy');
    showNotification('Copié', 'Le code SVG a été copié dans le presse-papiers.');
});

newImageBtn.addEventListener('click', () => {
    currentImageFile = null;
    currentSvgString = '';
    fileInput.value = '';
    controlsSection.classList.add('hidden');
    resultsSection.classList.add('hidden');
    originalImage.src = '';
    svgContainer.innerHTML = '';
});

function showNotification(title, message) {
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 px-4';
    modal.innerHTML = `
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">${title}</h3>
            <p class="text-gray-600 dark:text-gray-300 mb-4">${message}</p>
            <button class="w-full bg-[#5D5CDE] hover:bg-[#4a49b8] text-white font-semibold py-2 px-4 rounded-lg transition-colors"
                    onclick="this.closest('.fixed').remove()">OK</button>
        </div>`;
    document.body.appendChild(modal);
}
</script>
</body>
</html>