<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pari Alliance</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            /* Thème par défaut (bleu) */
            --primary-color: #5D5CDE;
            --text-color: #000000;
            --bg-color: #ffffff;
            --border-color: #dddfe2;
            --secondary-color: #f0f2f5;
            --chat-sent-bg: #5D5CDE;
            --chat-sent-text: #ffffff;
            --chat-received-bg: #f0f2f5;
            --selection-color: rgba(93, 92, 222, 0.3);
            --action-menu-bg: rgba(0, 0, 0, 0.9);
            --action-menu-text: #ffffff;
            --highlight-color: #FFEB3B;
            --blocked-color: #ff6b6b;
            --reaction-bg: rgba(255, 255, 255, 0.9);
            --reaction-shadow: rgba(0, 0, 0, 0.1);
            --group-icon-bg: #4CAF50;
            --danger-color: #ff4842;
            --success-color: #4caf50;
            --input-bg: #f0f2f5;
            --input-placeholder: #8e8e93;
            --button-text: #000000;
            --inactive-text: #8e8e93;
            --link-color: #007aff;
            --admin-badge-bg: #5D5CDE;
            --admin-badge-text: white;
            --log-bg: rgba(0, 0, 0, 0.8);
            --log-text: #ffffff;
            --log-info: #2196F3;
            --log-warning: #FFC107;
            --log-error: #FF5252;
            --log-success: #4CAF50;
            --overlay-bg: rgba(0, 0, 0, 0.7);
            --event-bg: #f1f1f1;
            --event-border: #e0e0e0;
            --restricted-badge-bg: #FFC107;
            --restricted-badge-text: #000000;
            --side-menu-bg: #ffffff;
            --side-menu-active: #f0f2f5;
            --side-menu-hover: #f5f5f5;
            --log-panel-bg: #f8f9fa;
            --log-panel-border: #e0e0e0;
            --link-hover: #0056b3;
            --admin-notif-bg: #f8f9fa;
            --admin-notif-border: #e0e0e0;
            --forecast-win-bg: rgba(76, 175, 80, 0.2);
            --forecast-loss-bg: rgba(244, 67, 54, 0.2);
            --forecast-pending-bg: rgba(255, 193, 7, 0.2);
            --comment-bg: #f5f5f5;
            --comment-border: #ebebeb;
            --social-whatsapp: #25D366;
            --social-telegram: #0088cc;
            --social-youtube: #FF0000;
            --partner-google: #4285F4;
            --partner-firebase: #FFCA28;
            --partner-github: #333333;
            --partner-quora: #B92B27;
            --notification-dot: #FF4842;
            --warning-bg: rgba(255, 152, 0, 0.1);
            --warning-text: #FF9800;
            --image-message-bg: rgba(93, 92, 222, 0.1);
            --image-viewer-bg: rgba(0, 0, 0, 0.9);
            --selected-message-border: rgba(93, 92, 222, 0.7);
            --date-separator-bg: rgba(0, 0, 0, 0.05);
            --date-separator-text: var(--inactive-text);
            --reply-preview-bg: rgba(93, 92, 222, 0.1);
            --reply-preview-border: var(--primary-color);
            --reply-preview-text: var(--text-color);
            --deleted-message-bg: rgba(0, 0, 0, 0.05);
            --deleted-message-text: #888888;
            --action-bar-bg: var(--bg-color);
            --action-bar-text: var(--text-color);
            --action-bar-border: var(--border-color);
            --reply-quote-bg: rgba(93, 92, 222, 0.15);
            --reply-quote-border: var(--primary-color);
            --group-info-bg: var(--bg-color);
            --group-info-border: var(--border-color);
            --download-btn-bg: var(--primary-color);
            --download-btn-text: white;
            --new-badge-bg: var(--primary-color);
            --new-badge-text: white;
            --theme-selector-border: #ddd;
            --user-item-bg: var(--bg-color);
            --unread-badge-bg: #FF4842;
            --unread-badge-text: white;
            --sats-color: #F7931A;
            --plan-active-bg: rgba(93, 92, 222, 0.1);
            --plan-active-border: var(--primary-color);
        }
        
        /* Thème vert */
        .theme-green {
            --primary-color: #4CAF50;
            --chat-sent-bg: #4CAF50;
            --selection-color: rgba(76, 175, 80, 0.3);
            --admin-badge-bg: #4CAF50;
            --reply-preview-bg: rgba(76, 175, 80, 0.1);
            --reply-preview-border: #4CAF50;
            --reply-quote-bg: rgba(76, 175, 80, 0.15);
            --reply-quote-border: #4CAF50;
            --download-btn-bg: #4CAF50;
            --new-badge-bg: #4CAF50;
            --image-message-bg: rgba(76, 175, 80, 0.1);
            --selected-message-border: rgba(76, 175, 80, 0.7);
        }
        
        /* Thème rouge */
        .theme-red {
            --primary-color: #F44336;
            --chat-sent-bg: #F44336;
            --selection-color: rgba(244, 67, 54, 0.3);
            --admin-badge-bg: #F44336;
            --reply-preview-bg: rgba(244, 67, 54, 0.1);
            --reply-preview-border: #F44336;
            --reply-quote-bg: rgba(244, 67, 54, 0.15);
            --reply-quote-border: #F44336;
            --download-btn-bg: #F44336;
            --new-badge-bg: #F44336;
            --image-message-bg: rgba(244, 67, 54, 0.1);
            --selected-message-border: rgba(244, 67, 54, 0.7);
        }
        
        /* Thème orange */
        .theme-orange {
            --primary-color: #FF9800;
            --chat-sent-bg: #FF9800;
            --selection-color: rgba(255, 152, 0, 0.3);
            --admin-badge-bg: #FF9800;
            --reply-preview-bg: rgba(255, 152, 0, 0.1);
            --reply-preview-border: #FF9800;
            --reply-quote-bg: rgba(255, 152, 0, 0.15);
            --reply-quote-border: #FF9800;
            --download-btn-bg: #FF9800;
            --new-badge-bg: #FF9800;
            --image-message-bg: rgba(255, 152, 0, 0.1);
            --selected-message-border: rgba(255, 152, 0, 0.7);
        }

        /* Nouveau thème rouge-rose */
        .theme-red-pink {
            --primary-color: #E91E63;
            --chat-sent-bg: linear-gradient(135deg, #F44336, #E91E63);
            --selection-color: rgba(233, 30, 99, 0.3);
            --admin-badge-bg: linear-gradient(135deg, #F44336, #E91E63);
            --reply-preview-bg: rgba(233, 30, 99, 0.1);
            --reply-preview-border: #E91E63;
            --reply-quote-bg: rgba(233, 30, 99, 0.15);
            --reply-quote-border: #E91E63;
            --download-btn-bg: linear-gradient(135deg, #F44336, #E91E63);
            --new-badge-bg: linear-gradient(135deg, #F44336, #E91E63);
            --image-message-bg: rgba(233, 30, 99, 0.1);
            --selected-message-border: rgba(233, 30, 99, 0.7);
        }

        /* Nouveau thème vert-jaune */
        .theme-green-yellow {
            --primary-color: #8BC34A;
            --chat-sent-bg: linear-gradient(135deg, #4CAF50, #CDDC39);
            --selection-color: rgba(139, 195, 74, 0.3);
            --admin-badge-bg: linear-gradient(135deg, #4CAF50, #CDDC39);
            --reply-preview-bg: rgba(139, 195, 74, 0.1);
            --reply-preview-border: #8BC34A;
            --reply-quote-bg: rgba(139, 195, 74, 0.15);
            --reply-quote-border: #8BC34A;
            --download-btn-bg: linear-gradient(135deg, #4CAF50, #CDDC39);
            --new-badge-bg: linear-gradient(135deg, #4CAF50, #CDDC39);
            --image-message-bg: rgba(139, 195, 74, 0.1);
            --selected-message-border: rgba(139, 195, 74, 0.7);
        }

        /* Nouveau thème bleu-violet */
        .theme-blue-purple {
            --primary-color: #673AB7;
            --chat-sent-bg: linear-gradient(135deg, #2196F3, #9C27B0);
            --selection-color: rgba(103, 58, 183, 0.3);
            --admin-badge-bg: linear-gradient(135deg, #2196F3, #9C27B0);
            --reply-preview-bg: rgba(103, 58, 183, 0.1);
            --reply-preview-border: #673AB7;
            --reply-quote-bg: rgba(103, 58, 183, 0.15);
            --reply-quote-border: #673AB7;
            --download-btn-bg: linear-gradient(135deg, #2196F3, #9C27B0);
            --new-badge-bg: linear-gradient(135deg, #2196F3, #9C27B0);
            --image-message-bg: rgba(103, 58, 183, 0.1);
            --selected-message-border: rgba(103, 58, 183, 0.7);
        }

        /* Nouveau thème orange-doré */
        .theme-orange-gold {
            --primary-color: #FF8F00;
            --chat-sent-bg: linear-gradient(135deg, #FF9800, #FFC107);
            --selection-color: rgba(255, 143, 0, 0.3);
            --admin-badge-bg: linear-gradient(135deg, #FF9800, #FFC107);
            --reply-preview-bg: rgba(255, 143, 0, 0.1);
            --reply-preview-border: #FF8F00;
            --reply-quote-bg: rgba(255, 143, 0, 0.15);
            --reply-quote-border: #FF8F00;
            --download-btn-bg: linear-gradient(135deg, #FF9800, #FFC107);
            --new-badge-bg: linear-gradient(135deg, #FF9800, #FFC107);
            --image-message-bg: rgba(255, 143, 0, 0.1);
            --selected-message-border: rgba(255, 143, 0, 0.7);
        }
        
        .dark {
            --bg-color: #181818;
            --text-color: #ffffff;
            --border-color: #3e4042;
            --secondary-color: #2c2c2c;
            --chat-received-bg: #2c2c2c;
            --chat-sent-text: #ffffff;
            --selection-color: rgba(93, 92, 222, 0.4);
            --action-menu-bg: rgba(60, 60, 60, 0.95);
            --highlight-color: #FFEB3B;
            --blocked-color: #ff6b6b;
            --reaction-bg: rgba(40, 40, 40, 0.9);
            --reaction-shadow: rgba(0, 0, 0, 0.3);
            --group-icon-bg: #388E3C;
            --danger-color: #ff6b6b;
            --success-color: #66bb6a;
            --input-bg: #2c2c2c;
            --input-placeholder: #6c6c6c;
            --link-color: #2196F3;
            --admin-badge-text: white;
            --log-bg: rgba(20, 20, 20, 0.9);
            --log-info: #64B5F6;
            --log-warning: #FFD54F;
            --log-error: #FF8A80;
            --log-success: #81C784;
            --overlay-bg: rgba(0, 0, 0, 0.8);
            --event-bg: #2a2a2a;
            --event-border: #3e3e3e;
            --restricted-badge-bg: #FFC107;
            --restricted-badge-text: #000000;
            --side-menu-bg: #222222;
            --side-menu-active: #333333;
            --side-menu-hover: #2a2a2a;
            --log-panel-bg: #222222;
            --log-panel-border: #3e3e3e;
            --link-hover: #64B5F6;
            --admin-notif-bg: #2a2a2a;
            --admin-notif-border: #333333;
            --forecast-win-bg: rgba(76, 175, 80, 0.15);
            --forecast-loss-bg: rgba(244, 67, 54, 0.15);
            --forecast-pending-bg: rgba(255, 193, 7, 0.15);
            --comment-bg: #2a2a2a;
            --comment-border: #333333;
            --notification-dot: #FF4842;
            --warning-bg: rgba(255, 152, 0, 0.15);
            --warning-text: #FFA726;
            --image-message-bg: rgba(93, 92, 222, 0.15);
            --image-viewer-bg: rgba(0, 0, 0, 0.95);
            --selected-message-border: rgba(93, 92, 222, 0.8);
            --date-separator-bg: rgba(255, 255, 255, 0.1);
            --date-separator-text: #aaaaaa;
            --reply-preview-bg: rgba(93, 92, 222, 0.15);
            --reply-preview-text: var(--text-color);
            --deleted-message-bg: rgba(255, 255, 255, 0.05);
            --deleted-message-text: #888888;
            --action-bar-bg: #222222;
            --action-bar-text: #ffffff;
            --action-bar-border: #3e3e3e;
            --reply-quote-bg: rgba(93, 92, 222, 0.2);
            --group-info-bg: #222222;
            --group-info-border: #3e3e3e;
            --download-btn-text: white;
            --theme-selector-border: #444;
            --user-item-bg: #222222;
            --plan-active-bg: rgba(93, 92, 222, 0.15);
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-user-select: none;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            position: fixed;
            overflow: hidden;
            font-weight: 500;
            letter-spacing: -0.2px;
        }
        
        .side-menu {
            position: fixed;
            top: 0;
            left: -250px;
            height: 100%;
            width: 250px;
            background-color: var(--side-menu-bg);
            z-index: 1000;
            transition: left 0.3s ease;
            box-shadow: 2px 0 10px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
        }
        
        .side-menu.active {
            left: 0;
        }
        
        .side-menu-header {
            display: flex;
            align-items: center;
            padding: 20px 15px;
            border-bottom: none;
        }
        
        .side-menu-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
            margin-left: 15px;
        }
        
        .side-menu-close {
            font-size: 20px;
            color: var(--text-color);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
        }
        
        .side-menu-content {
            flex: 1;
            overflow-y: auto;
        }
        
        .side-menu-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .side-menu-item.active {
            background-color: var(--side-menu-active);
        }
        
        .side-menu-item i {
            font-size: 20px;
            width: 30px;
            color: var(--primary-color);
        }
        
        .side-menu-text {
            margin-left: 15px;
            font-weight: 500;
        }
        
        .side-menu-footer {
            margin-top: auto;
        }
        
        .side-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        
        .side-menu-overlay.active {
            display: block;
        }
        
        .header {
            background-color: var(--bg-color);
            border-bottom: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            z-index: 10;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .header.search-active {
            height: 50px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            transition: opacity 0.3s ease;
        }
        
        .header-title {
            font-weight: bold;
            font-size: 18px;
            color: var(--primary-color);
            border-bottom: none;
            text-decoration: none;
            transition: opacity 0.3s ease;
            flex: 1;
        }
        
        #header-action {
            display: flex;
            align-items: center;
            gap: 15px;
            transition: opacity 0.3s ease;
        }
        
        .menu-button, .back-button, .search-button, .events-button, .info-button, .select-button {
            padding: 8px;
            cursor: pointer;
            font-size: 18px;
            color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }
        
        .menu-button:active, .back-button:active, .search-button:active, .events-button:active, .info-button:active, .select-button:active {
            background-color: var(--secondary-color);
        }
        
        .notification-dot {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 8px;
            height: 8px;
            background-color: var(--notification-dot);
            border-radius: 50%;
            display: none;
        }
        
        .notification-dot.active {
            display: block;
        }
        
        .events-button {
            position: relative;
        }
        
        .search-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            background-color: var(--bg-color);
            display: flex;
            align-items: center;
            padding: 0 15px;
            opacity: 0;
            pointer-events: none;
            transform: translateY(-5px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 20;
        }
        
        .search-container.active {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }
        
        .search-input {
            flex: 1;
            padding: 10px 15px;
            border-radius: 18px;
            border: none;
            background-color: var(--secondary-color);
            font-size: 16px;
            color: var(--text-color);
            outline: none;
            margin-right: 10px;
            transition: background-color 0.2s ease;
        }
        
        .search-close {
            padding: 8px;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }
        
        .search-close:active {
            background-color: var(--secondary-color);
        }
        
        .header.search-active .header-left,
        .header.search-active .header-title,
        .header.search-active #header-action {
            opacity: 0;
            pointer-events: none;
        }

        /* Debug log panel */
        .debug-log-panel {
            position: fixed;
            bottom: 80px;
            left: 10px;
            right: 10px;
            max-height: 200px;
            background-color: var(--log-panel-bg);
            border: 1px solid var(--log-panel-border);
            border-radius: 8px;
            z-index: 1001;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .debug-log-panel.active {
            display: flex;
        }

        .debug-log-header {
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .debug-log-close {
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 3px;
            transition: background-color 0.2s ease;
        }

        .debug-log-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .debug-log-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }

        .debug-log-item {
            margin-bottom: 8px;
            padding: 6px 8px;
            border-radius: 4px;
            border-left: 3px solid;
        }

        .debug-log-item.error {
            background-color: rgba(244, 67, 54, 0.1);
            border-left-color: var(--log-error);
            color: var(--log-error);
        }

        .debug-log-item.warning {
            background-color: rgba(255, 193, 7, 0.1);
            border-left-color: var(--log-warning);
            color: var(--log-warning);
        }

        .debug-log-item.info {
            background-color: rgba(33, 150, 243, 0.1);
            border-left-color: var(--log-info);
            color: var(--log-info);
        }

        .debug-log-item.success {
            background-color: rgba(76, 175, 80, 0.1);
            border-left-color: var(--log-success);
            color: var(--log-success);
        }

        .debug-log-timestamp {
            font-size: 10px;
            opacity: 0.7;
            margin-right: 5px;
        }

        .debug-log-link {
            color: var(--link-color);
            text-decoration: underline;
            cursor: pointer;
            word-break: break-all;
        }

        .debug-log-link:hover {
            color: var(--link-hover);
        }

        .debug-toggle-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--log-error);
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1002;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: transform 0.2s ease;
        }

        .debug-toggle-btn.active {
            display: flex;
        }

        .debug-toggle-btn:hover {
            transform: scale(1.1);
        }
        
        .content {
            position: fixed;
            top: 50px;
            bottom: 60px;
            left: 0;
            right: 0;
            overflow: hidden;
            background-color: var(--bg-color);
        }
        
        .content.no-bottom-nav {
            bottom: 0;
        }
        
        .bottom-nav {
            background-color: var(--bg-color);
            border-top: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            z-index: 10;
            box-shadow: 0 -1px 3px rgba(0,0,0,0.1);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            color: var(--inactive-text);
            font-size: 10px;
            cursor: pointer;
            height: 100%;
            padding: 8px 0;
            position: relative;
        }
        
        .nav-item.active {
            color: var(--primary-color);
        }
        
        .nav-icon {
            font-size: 22px;
            margin-bottom: 4px;
        }
        
        .section {
            padding: 0;
            display: none;
            height: 100%;
            overflow: hidden;
        }
        
        .section.active {
            display: flex;
            flex-direction: column;
        }
        
        .profile-pic {
            width: 50px;
            height: 50px;
            background-color: var(--secondary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .profile-pic img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }
        
        .profile-pic-edit {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: var(--primary-color);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            transition: transform 0.2s ease;
        }
        
        .profile-pic-edit:hover, .profile-pic-edit:active {
            transform: scale(1.1);
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }
        
        .loading-spinner {
            font-size: 60px;
            color: var(--primary-color);
            animation: pulse 2s infinite, bounce 1.5s infinite;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }
        
        .settings-container {
            padding: 15px;
            overflow-y: auto;
            height: 100%;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: none;
            cursor: pointer;
        }
        
        .setting-icon {
            width: 36px;
            height: 36px;
            background-color: var(--secondary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .setting-label {
            font-weight: 500;
        }
        
        .button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            margin-top: 20px;
            cursor: pointer;
            transition: transform 0.15s ease, opacity 0.2s ease, background-color 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .button:active {
            transform: scale(0.98);
            opacity: 0.9;
        }
        
        .button:hover {
            background-color: #4a49c0;
        }

        .button:disabled {
            background-color: var(--border-color);
            color: var(--inactive-text);
            cursor: not-allowed;
        }
        
        .button.danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .button.danger:hover {
            background-color: #e53935;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        .profile-header {
            display: flex;
            align-items: flex-start;
            padding: 20px;
            border-bottom: none;
        }
        
        .profile-header .profile-pic {
            width: 80px;
            height: 80px;
            margin-right: 20px;
        }
        
        .profile-header .profile-pic i {
            font-size: 30px;
            color: var(--primary-color);
        }
        
        .profile-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        .profile-name {
            font-weight: bold;
            font-size: 20px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }
        
        .profile-email {
            color: #6b7280;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .profile-status {
            color: #6b7280;
        }
        
        .profile-edit {
            color: var(--primary-color);
            font-size: 14px;
            margin-top: 5px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 8px;
            border-radius: 15px;
        }
        
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .auth-header {
            padding: 40px 0 20px;
            text-align: center;
        }
        
        .auth-logo {
            font-size: 50px;
            color: var(--primary-color);
            margin-bottom: 15px;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .auth-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .auth-subtitle {
            font-size: 16px;
            color: var(--text-color);
            opacity: 0.8;
            margin-bottom: 20px;
            padding: 0 20px;
            text-align: center;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: none;
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 15px 0;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            color: var(--inactive-text);
            transition: color 0.3s, background-color 0.2s ease;
            text-decoration: none;
            border-bottom: none;
        }
        
        .auth-tab.active {
            color: var(--primary-color);
        }
        
        .auth-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 25%;
            width: 50%;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 3px 3px 0 0;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: scaleX(0); }
            to { transform: scaleX(1); }
        }
        
        .auth-form {
            padding: 20px;
            display: none;
            animation: fadeUp 0.5s ease;
        }
        
        @keyframes fadeUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }
        
        .form-input {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg);
            font-size: 16px;
            color: var(--text-color);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            outline: none;
        }
        
        .form-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.25);
        }
        
        .form-input::placeholder {
            color: var(--input-placeholder);
        }
        
        .form-error {
            color: var(--danger-color);
            font-size: 13px;
            margin-top: 6px;
            display: none;
            animation: shakeX 0.75s ease;
        }
        
        @keyframes shakeX {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
            20%, 40%, 60%, 80% { transform: translateX(4px); }
        }
        
        .form-footer {
            margin-top: 30px;
            text-align: center;
        }
        
        .form-footer-text {
            margin-top: 15px;
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
        }
        
        .form-link {
            color: var(--link-color);
            text-decoration: none;
            font-weight: bold;
            transition: color 0.2s;
        }
        
        .form-link:hover {
            text-decoration: underline;
        }

        .log-message {
            margin-top: 15px;
            padding: 12px;
            font-weight: bold;
            border-radius: 6px;
            white-space: pre-line;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }
          
        .log-message.info {
            background: #d1ecf1;
            color: #0c5460;
        }
          
        .log-message.success {
            background: #d4edda;
            color: #155724;
        }
          
        .log-message.error {
            background: #f8d7da;
            color: #721c24;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--inactive-text);
        }

        .empty-state i {
            font-size: 50px;
            margin-bottom: 15px;
            color: var(--border-color);
        }

        .empty-state-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .empty-state-text {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .btn-loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .button.loading {
            pointer-events: none;
            opacity: 0.8;
        }
        
        .button.loading .btn-text {
            visibility: hidden;
        }
        
        .button.loading .btn-loader {
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -10px;
            margin-left: -10px;
            visibility: visible;
        }
        
        .notification {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            opacity: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 12px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            font-weight: 500;
            z-index: 1000;
            max-width: 90%;
            text-align: center;
            line-height: 1.4;
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
            pointer-events: auto;
        }

        .notification.success {
            background-color: var(--bg-color);
            color: var(--success-color);
        }

        .notification.error {
            background-color: var(--bg-color);
            color: var(--danger-color);
        }

        .notification.info {
            background-color: var(--bg-color);
            color: var(--primary-color);
        }
        
        .verify-animation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .football-bounce {
            font-size: 80px;
            color: var(--primary-color);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-40px); }
            60% { transform: translateY(-20px); }
        }

        .verify-text {
            margin-top: 30px;
            font-size: 16px;
            color: var(--text-color);
            opacity: 0.8;
            text-align: center;
        }
        
        .confirmation-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--bg-color);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            width: 85%;
            max-width: 300px;
            padding: 20px;
            z-index: 150;
            display: none;
        }
        
        .confirmation-dialog.active {
            display: block;
        }
        
        .confirmation-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .confirmation-text {
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.4;
        }
        
        .confirmation-buttons {
            display: flex;
            justify-content: space-between;
        }
        
        .confirmation-button {
            padding: 10px 15px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            min-width: 100px;
            text-align: center;
        }
        
        .confirmation-cancel {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }
        
        .confirmation-confirm {
            background-color: var(--primary-color);
            color: white;
        }
        
        .confirmation-delete {
            background-color: var(--danger-color);
            color: white;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 90;
            display: none;
        }
        
        .overlay.active {
            display: block;
        }

        .event-icon {
            width: 50px;
            height: 50px;
            background-color: var(--event-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            border: 1px solid var(--event-border);
        }
        
        .event-icon i {
            font-size: 22px;
            color: var(--primary-color);
        }

        .event-item {
            transition: none;
            cursor: default;
            position: relative;
        }

        .event-header {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .event-content {
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
        }

        .event-time {
            font-size: 12px;
            color: var(--inactive-text);
            margin-top: 5px;
        }
        
        .admin-badge {
            display: inline-block;
            background-color: var(--admin-badge-bg);
            color: var(--admin-badge-text);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 6px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .restricted-badge {
            display: inline-block;
            background-color: var(--restricted-badge-bg);
            color: var(--restricted-badge-text);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 6px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .new-badge {
            display: inline-block;
            background-color: var(--new-badge-bg);
            color: var(--new-badge-text);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 6px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .admin-count-badge {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: bold;
            margin-left: 6px;
        }

        .event-item.group-create .event-icon {
            background-color: rgba(76, 175, 80, 0.2);
        }
        
        .event-item.group-create .event-icon i {
            color: var(--success-color);
        }
        
        .event-item.permission-change .event-icon {
            background-color: rgba(255, 193, 7, 0.2);
        }
        
        .event-item.permission-change .event-icon i {
            color: var(--restricted-badge-bg);
        }
        
        .event-item.user-join .event-icon {
            background-color: rgba(33, 150, 243, 0.2);
        }
        
        .event-item.user-join .event-icon i {
            color: var(--log-info);
        }

        .restricted-message {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            background-color: rgba(255, 193, 7, 0.1);
            border-radius: 10px;
            font-size: 14px;
            color: var(--text-color);
        }
        
        .profile-edit-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .profile-edit-dialog.active {
            display: flex;
        }
        
        .profile-image-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .profile-image-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-bottom: 10px;
            position: relative;
        }
        
        .profile-image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }
        
        .profile-image-preview i {
            font-size: 50px;
            color: var(--primary-color);
        }
        
        .profile-upload-btn {
            position: absolute;
            bottom: 10px;
            right: calc(50% - 60px);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s ease, background-color 0.2s ease;
        }
        
        .profile-upload-btn:hover, .profile-upload-btn:active {
            transform: scale(1.1);
            background-color: #4a49c0;
        }

        input[type="file"] {
            display: none;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .section-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            text-decoration: none;
            border-bottom: none;
            padding: 0 16px; 
            margin: 15px 0;
        }
        
        .field-error {
            color: var(--danger-color);
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }
        
        .save-field-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            margin-left: 10px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .save-field-btn:hover {
            background-color: #4a49c0;
        }
        
        .save-field-btn:disabled {
            background-color: var(--border-color);
            cursor: not-allowed;
        }
        
        .editable-field {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .editable-field-input {
            flex: 1;
        }
        
        .forecasts-section {
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        
        .ai-forecasts-section {
            padding: 0;
            height: 100%;
            overflow: hidden;
        }
        
        .forecasts-tabs, .ai-forecasts-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin: 0;
            background-color: var(--bg-color);
            position: sticky;
            top: 0;
            z-index: 5;
            flex-shrink: 0;
        }
        
        .forecast-tab, .ai-forecast-tab {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            position: relative;
            color: var(--inactive-text);
            transition: color 0.3s, background-color 0.2s ease;
        }
        
        .forecast-tab.active, .ai-forecast-tab.active {
            color: var(--primary-color);
        }
        
        .forecast-tab.active::after, .ai-forecast-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 20%;
            width: 60%;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 3px 3px 0 0;
            animation: slideIn 0.3s ease;
        }
        
        .forecasts-content, .ai-forecasts-content {
            display: none;
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0;
        }
        
        .forecasts-content.active, .ai-forecasts-content.active {
            display: flex;
            flex-direction: column;
        }
        
        .forecasts-list, .ai-forecasts-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 15px;
            min-height: 100%;
        }
        
        /* Amélioration du système de cartes avec 3 faces */
        .forecast-item {
            background-color: var(--secondary-color);
            border-radius: 15px;
            padding: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            min-height: 300px;
            perspective: 1000px;
            transition: transform 0.2s ease;
            cursor: pointer;
        }

        .forecast-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .forecast-card-container {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 300px;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }

        .forecast-card-container.show-details {
            transform: rotateY(120deg);
        }

        .forecast-card-container.show-probabilities {
            transform: rotateY(240deg);
        }

        .forecast-face {
            position: absolute;
            width: 100%;
            height: 100%;
            min-height: 300px;
            backface-visibility: hidden;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border-radius: 15px;
            background-color: var(--secondary-color);
        }

        .forecast-front {
            transform: rotateY(0deg);
        }

        .forecast-details {
            transform: rotateY(-120deg);
            background-color: var(--secondary-color);
        }

        .forecast-probabilities {
            transform: rotateY(-240deg);
            background-color: var(--secondary-color);
        }

        .face-indicator {
            position: absolute;
            bottom: 10px;
            right: 15px;
            display: flex;
            gap: 6px;
            z-index: 10;
        }

        .face-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: rgba(0,0,0,0.3);
            transition: background-color 0.3s ease;
        }

        .face-dot.active {
            background-color: var(--primary-color);
        }

        .swipe-instruction {
            position: absolute;
            bottom: 10px;
            left: 15px;
            font-size: 12px;
            color: var(--inactive-text);
            opacity: 0.7;
        }
        
        .forecast-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .forecast-match {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 15px 0;
        }
        
        .forecast-team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            flex: 1;
        }
        
        .forecast-team-logo {
            width: 45px;
            height: 45px;
            background-color: var(--bg-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .forecast-team-name {
            font-weight: 500;
            text-align: center;
            font-size: 14px;
            line-height: 1.2;
        }
        
        .forecast-score {
            font-size: 24px;
            font-weight: bold;
            padding: 0 20px;
            display: flex;
            align-items: center;
            color: var(--primary-color);
        }
        
        .forecast-status {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .forecast-status.pending {
            background-color: var(--forecast-pending-bg);
            color: var(--text-color);
        }
        
        .forecast-status.win {
            background-color: var(--forecast-win-bg);
            color: var(--text-color);
        }
        
        .forecast-status.loss {
            background-color: var(--forecast-loss-bg);
            color: var(--text-color);
        }
        
        .forecast-date {
            font-size: 12px;
            color: var(--inactive-text);
            margin-top: 10px;
        }
        
        .forecast-confidence {
            display: flex;
            align-items: center;
            margin-top: 15px;
            font-size: 13px;
            color: var(--text-color);
        }
        
        .confidence-bar-container {
            flex: 1;
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            margin: 0 10px;
            overflow: hidden;
        }
        
        .confidence-bar {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .forecast-description {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .poisson-probabilities {
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .poisson-title {
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 16px;
            color: var(--primary-color);
            text-align: center;
        }

        .poisson-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            padding: 5px 0;
        }

        .poisson-row:not(:last-child) {
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .estimated-odds {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 15px;
            text-align: center;
            font-weight: bold;
            margin-top: 15px;
        }

        .combined-matches {
            background-color: rgba(0,0,0,0.05);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .combined-matches-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .match-detail {
            background-color: var(--bg-color);
            padding: 10px;
            margin: 8px 0;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .match-name {
            font-weight: 500;
            margin-bottom: 5px;
        }

        .match-prediction {
            font-size: 13px;
            color: var(--primary-color);
            margin-bottom: 3px;
        }

        .match-confidence {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .no-forecasts {
            text-align: center;
            padding: 40px 20px;
            color: var(--inactive-text);
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .no-forecasts i {
            font-size: 50px;
            margin-bottom: 15px;
            color: var(--primary-color);
            opacity: 0.5;
        }

        .admin-notification {
            background-color: var(--bg-color);
            border-radius: 15px;
            margin: 10px 15px 20px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .admin-notification-header {
            color: var(--text-color);
            padding: 0 0 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: none;
            margin-bottom: 10px;
        }
        
        .admin-notification-title {
            display: flex;
            align-items: center;
        }
        
        .admin-notification-title i {
            margin-right: 8px;
            color: var(--primary-color);
        }
        
        .admin-notification-content {
            padding: 5px 0;
            line-height: 1.4;
        }
        
        .admin-notification-footer {
            padding: 5px 0 0;
            font-size: 12px;
            color: var(--inactive-text);
            text-align: right;
            border-top: none;
            margin-top: 10px;
            padding-top: 8px;
        }
        
        .event-close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .event-close-btn:hover, .event-close-btn:active {
            transform: scale(1.1);
        }
        
        .event-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 5px;
        }
        
        .event-action-btn {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            border: none;
            border-radius: 8px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: transform 0.1s ease;
        }
        
        .event-action-btn:hover, .event-action-btn:active {
            transform: translateY(-1px);
        }
        
        .event-action-btn.delete {
            color: var(--danger-color);
        }
        
        .admin-notif-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .admin-notif-dialog.active {
            display: flex;
        }
        
        .score-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .score-option {
            padding: 5px 12px;
            border-radius: 15px;
            background-color: var(--bg-color);
            font-weight: bold;
            font-size: 14px;
            border: 1px solid var(--border-color);
            transition: transform 0.1s ease;
            cursor: pointer;
        }
        
        .score-option:hover, .score-option:active {
            transform: translateY(-1px);
        }

        .score-option.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        #delete-account-confirmation .confirmation-text {
            color: var(--danger-color);
            font-weight: bold;
        }

        .social-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding: 0 15px;
            gap: 10px;
        }
        
        .social-button {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px 10px;
            border-radius: 10px;
            background-color: var(--secondary-color);
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }
        
        .social-button:active {
            transform: scale(0.98);
        }
        
        .social-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .social-button.whatsapp {
            color: var(--social-whatsapp);
        }
        
        .social-button.telegram {
            color: var(--social-telegram);
        }
        
        .social-button.youtube {
            color: var(--social-youtube);
        }

        .about-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .about-dialog.active {
            display: flex;
        }
        
        .about-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .about-logo {
            text-align: center;
            margin: 20px 0;
        }
        
        .about-logo i {
            font-size: 60px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .about-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 10px;
        }
        
        .about-version {
            text-align: center;
            font-size: 14px;
            color: var(--inactive-text);
            margin-bottom: 30px;
        }
        
        .about-section {
            margin-bottom: 25px;
        }
        
        .about-section-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .about-section-content {
            line-height: 1.5;
            font-size: 14px;
        }
        
        .about-footer {
            text-align: center;
            padding: 20px 0;
            font-size: 12px;
            color: var(--inactive-text);
            border-top: none;
            margin-top: auto;
        }

        .edit-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .edit-dialog.active {
            display: flex;
        }
        
        .edit-header {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: none;
            flex-shrink: 0;
        }
        
        .edit-title {
            flex: 1;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            text-decoration: none;
            border-bottom: none;
        }
        
        .edit-back {
            color: var(--primary-color);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
        }
        
        .edit-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .terms-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .terms-dialog.active {
            display: flex;
        }
        
        .terms-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .terms-header {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: none;
            flex-shrink: 0;
        }
        
        .terms-title {
            flex: 1;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            text-decoration: none;
            border-bottom: none;
        }
        
        .terms-back {
            color: var(--primary-color);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
        }
        
        .warning-box {
            background-color: var(--warning-bg);
            border-left: 4px solid var(--warning-text);
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-weight: 500;
        }
        
        .warning-box i {
            color: var(--warning-text);
            margin-right: 10px;
        }
    
        #header-action {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .search-button, .events-button, .info-button {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }
        
        .search-button:active, .events-button:active, .info-button:active {
            background-color: var(--secondary-color);
        }
        
        /* Improved search bar animation */
        @keyframes searchBarIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes searchBarOut {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-5px);
            }
        }
        
        .search-container.active {
            animation: searchBarIn 0.3s ease forwards;
        }
        
        .search-container.hiding {
            animation: searchBarOut 0.3s ease forwards;
        }
        
        /* Touch ripple effect for buttons */
        .ripple {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }
        
        @keyframes ripple {
            to {
                transform: scale(2.5);
                opacity: 0;
            }
        }
        
        /* Interface Theme Selector */
        .theme-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 15px 0;
            justify-items: center;
        }
        
        .theme-option {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            cursor: pointer;
            position: relative;
            border: 2px solid var(--theme-selector-border);
            overflow: hidden;
            transition: transform 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .theme-option:hover {
            transform: scale(1.05);
        }
        
        .theme-option.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px var(--primary-color);
        }
        
        .theme-option.active:before {
            content: '\f00c';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            text-shadow: 0 0 3px rgba(0,0,0,0.5);
            z-index: 3;
        }
        
        .theme-option.theme-blue {
            background-color: #5D5CDE;
        }
        
        .theme-option.theme-green {
            background-color: #4CAF50;
        }
        
        .theme-option.theme-red {
            background-color: #F44336;
        }
        
        .theme-option.theme-orange {
            background-color: #FF9800;
        }

        .theme-option.theme-red-pink {
            background: linear-gradient(135deg, #F44336, #E91E63);
        }

        .theme-option.theme-green-yellow {
            background: linear-gradient(135deg, #4CAF50, #CDDC39);
        }

        .theme-option.theme-blue-purple {
            background: linear-gradient(135deg, #2196F3, #9C27B0);
        }

        .theme-option.theme-orange-gold {
            background: linear-gradient(135deg, #FF9800, #FFC107);
        }
        
        .theme-label {
            margin-top: 5px;
            font-size: 11px;
            text-align: center;
            font-weight: 500;
            line-height: 1.2;
        }
        
        .interface-section {
            background-color: var(--secondary-color);
            border-radius: 10px;
            padding: 15px;
            margin: 15px;
        }
        
        .interface-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
            color: var(--primary-color);
        }

        /* Subscription Section Styles */
        .subscription-section {
            padding: 0;
            height: 100%;
            overflow-y: auto;
        }

        .current-plan {
            background-color: var(--plan-active-bg);
            border: 2px solid var(--plan-active-border);
            border-radius: 15px;
            padding: 20px;
            margin: 15px;
            text-align: center;
        }

        .current-plan-title {
            font-weight: bold;
            font-size: 18px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .current-plan-info {
            color: var(--text-color);
            margin-bottom: 15px;
        }

        .sats-balance {
            font-size: 24px;
            font-weight: bold;
            color: var(--sats-color);
            margin: 10px 0;
        }

        .sats-balance i {
            margin-right: 8px;
        }

        .plan-item {
            background-color: var(--secondary-color);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 15px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .plan-item:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(93, 92, 222, 0.2);
        }

        .plan-item.popular {
            border-color: var(--primary-color);
            position: relative;
        }

        .plan-item.popular::before {
            content: "Populaire";
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .plan-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .plan-price {
            font-size: 32px;
            font-weight: bold;
            color: var(--sats-color);
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .plan-duration {
            font-size: 14px;
            color: var(--inactive-text);
        }

        .plan-features {
            list-style: none;
            margin: 15px 0;
            text-align: left;
        }

        .plan-features li {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .plan-features li::before {
            content: '✓';
            color: var(--success-color);
            font-weight: bold;
            margin-right: 10px;
        }

        .plan-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            transition: all 0.2s ease;
        }

        .plan-button:hover {
            background-color: #4a49c0;
            transform: translateY(-2px);
        }

        .plan-button:active {
            transform: translateY(0);
        }

        .plan-button:disabled {
            background-color: var(--border-color);
            color: var(--inactive-text);
            cursor: not-allowed;
            transform: none;
        }

        /* Tutorials Section Styles */
        .tutorials-section {
            padding: 0;
            height: 100%;
            overflow-y: auto;
        }

        .tutorial-item {
            background-color: var(--secondary-color);
            border-radius: 15px;
            margin: 15px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }

        .tutorial-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .tutorial-thumbnail {
            position: relative;
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, var(--primary-color), #4a49c0);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .tutorial-play-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary-color);
            transition: all 0.3s ease;
        }

        .tutorial-thumbnail:hover .tutorial-play-button {
            transform: scale(1.1);
            background-color: white;
        }

        .tutorial-content {
            padding: 20px;
        }

        .tutorial-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .tutorial-description {
            color: var(--inactive-text);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .tutorial-duration {
            display: flex;
            align-items: center;
            color: var(--primary-color);
            font-size: 14px;
            font-weight: 500;
        }

        .tutorial-duration i {
            margin-right: 8px;
        }

        .tutorial-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--sats-color);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .video-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .video-modal.active {
            display: flex;
        }

        .video-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            background-color: #000;
            border-radius: 10px;
            overflow: hidden;
        }

        .video-player {
            width: 100%;
            height: auto;
            max-height: 80vh;
        }

        .video-close {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.5);
            transition: background-color 0.2s ease;
        }

        .video-close:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }

        .fab {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            cursor: pointer;
            font-size: 20px;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .fab:hover {
            transform: scale(1.1);
        }

        .fab:active {
            transform: scale(0.95);
        }
        
        @media (max-height: 640px) {
            .fab {
                bottom: 70px;
            }
        }
        
        @media (max-width: 380px) {
            .confirmation-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .confirmation-button {
                width: 100%;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }
    </style>
</head>
<body>
    <div id="verify-animation" class="verify-animation">
        <div class="football-bounce">
            <i class="fas fa-futbol"></i>
        </div>
        <div class="verify-text">Vérification en cours...</div>
    </div>

    <!-- Debug Panel -->
    <div id="debug-log-panel" class="debug-log-panel">
        <div class="debug-log-header">
            <span>Debug Console</span>
            <span class="debug-log-close" id="debug-log-close">×</span>
        </div>
        <div class="debug-log-content" id="debug-log-content">
            <!-- Logs will be added here -->
        </div>
    </div>

    <div id="debug-toggle-btn" class="debug-toggle-btn">
        <i class="fas fa-bug"></i>
    </div>
    
    <div class="side-menu" id="side-menu">
        <div class="side-menu-header">
            <div class="side-menu-close" id="side-menu-close">
                <i class="fas fa-times"></i>
            </div>
            <div class="side-menu-title">Pari Alliance</div>
        </div>
        <div class="side-menu-content">
            <div class="side-menu-item" id="menu-profile">
                <i class="fas fa-user"></i>
                <div class="side-menu-text">Profil</div>
            </div>
            <div class="side-menu-item" id="menu-subscription">
                <i class="fas fa-crown"></i>
                <div class="side-menu-text">Abonnement</div>
            </div>
            <div class="side-menu-item" id="menu-tutorials">
                <i class="fas fa-play-circle"></i>
                <div class="side-menu-text">Tutoriels</div>
            </div>
            <div class="side-menu-item" id="menu-interface">
                <i class="fas fa-paint-brush"></i>
                <div class="side-menu-text">Interface</div>
            </div>
        </div>
        <div class="side-menu-footer">
            <div class="side-menu-item" id="menu-terms">
                <i class="fas fa-file-alt"></i>
                <div class="side-menu-text">Conditions d'utilisation</div>
            </div>
            <div class="side-menu-item" id="menu-about">
                <i class="fas fa-info-circle"></i>
                <div class="side-menu-text">À propos</div>
            </div>
        </div>
    </div>
    
    <div class="side-menu-overlay" id="side-menu-overlay"></div>
    
    <div id="auth-screen" class="auth-screen" style="display: none;">
        <div class="auth-header">
            <div class="auth-logo">
                <i class="fas fa-futbol"></i>
            </div>
            <h1 class="auth-title">Pari Alliance</h1>
            <p class="auth-subtitle">Pronostics sportifs avancés</p>
        </div>
        
        <div class="auth-tabs">
            <div class="auth-tab active" id="login-tab">Connexion</div>
            <div class="auth-tab" id="register-tab">Inscription</div>
        </div>
        
        <div id="login-form" class="auth-form active">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="login-email" placeholder="Votre email">
                <div id="login-email-error" class="form-error">Veuillez entrer un email valide</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Mot de passe</label>
                <input type="password" class="form-input" id="login-password" placeholder="Votre mot de passe">
                <div id="login-password-error" class="form-error">Le mot de passe est obligatoire</div>
            </div>
            
            <div id="login-log" class="log-message" style="display:none;"></div>

            <div class="form-footer">
                <button class="button" id="loginBtn">
                    <span class="btn-loader" style="display:none;"></span>
                    <span class="btn-text">Se connecter</span>
                </button>
                <p class="form-footer-text">
                    Vous n'avez pas de compte ? <a href="#" class="form-link" id="goto-register">S'inscrire</a>
                </p>
            </div>
        </div>
        
        <div id="register-form" class="auth-form">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="register-email" placeholder="Votre adresse email">
                <div id="register-email-error" class="form-error">Veuillez entrer un email valide</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Mot de passe</label>
                <input type="password" class="form-input" id="register-password" placeholder="Créez un mot de passe sécurisé">
                <div id="register-password-error" class="form-error">Le mot de passe doit contenir au moins 6 caractères</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Confirmer le mot de passe</label>
                <input type="password" class="form-input" id="register-confirm-password" placeholder="Confirmez votre mot de passe">
                <div id="register-confirm-password-error" class="form-error">Les mots de passe ne correspondent pas</div>
            </div>
            
            <div id="register-log" class="log-message" style="display:none;"></div>

            <div class="form-footer">
                <button class="button" id="registerBtn">
                    <span class="btn-loader" style="display:none;"></span>
                    <span class="btn-text">S'inscrire</span>
                </button>
                <p class="form-footer-text">
                    Vous avez déjà un compte ? <a href="#" class="form-link" id="goto-login">Se connecter</a>
                </p>
            </div>
        </div>
    </div>

    <div id="loading" class="loading" style="display: none;">
        <i class="fas fa-futbol loading-spinner"></i>
        <div style="font-weight: bold; font-size: 24px; color: var(--primary-color);">Pari Alliance</div>
        <div style="margin-top: 10px; color: #6b7280;">Chargement...</div>
    </div>

    <div class="header">
        <div class="header-left">
            <div id="header-menu-button" class="menu-button">
                <i class="fas fa-bars"></i>
            </div>
            <div id="header-back-button" class="back-button" style="display:none;">
                <i class="fas fa-chevron-left"></i>
            </div>
        </div>
        <div id="header-title" class="header-title">Prédictions IA</div>
        <div id="header-action">
            <div class="search-button" id="search-button">
                <i class="fas fa-search"></i>
            </div>
            <div class="events-button" id="events-button">
                <i class="fas fa-bell"></i>
                <div class="notification-dot" id="events-notification-dot"></div>
            </div>
        </div>
        
        <div class="search-container" id="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="Rechercher...">
            <div class="search-close" id="search-close">
                <i class="fas fa-times"></i>
            </div>
        </div>
    </div>

    <div class="content">
        <div id="ai-forecasts-section" class="section active">
            <div class="ai-forecasts-tabs">
                <div class="ai-forecast-tab active" data-tab="combines">Combinés</div>
                <div class="ai-forecast-tab" data-tab="sures">Sûrs</div>
                <div class="ai-forecast-tab" data-tab="safes">Safes</div>
            </div>
            
            <div class="ai-forecasts-content active" id="combines-content">
                <div class="ai-forecasts-list" id="combines-list">
                </div>
            </div>
            
            <div class="ai-forecasts-content" id="sures-content">
                <div class="ai-forecasts-list" id="sures-list">
                </div>
            </div>

            <div class="ai-forecasts-content" id="safes-content">
                <div class="ai-forecasts-list" id="safes-list">
                </div>
            </div>
        </div>
        
        <div id="events-section" class="section">
            <div id="events-list" style="height: 100%; overflow-y: auto; padding: 10px;">
                <div class="empty-state">
                    <i class="fas fa-bell"></i>
                    <div class="empty-state-title">Aucun événement</div>
                    <div class="empty-state-text">Les événements apparaîtront ici</div>
                </div>
            </div>
        </div>
        
        <div id="forecasts-section" class="section">
            <div class="forecasts-content active" style="height: 100%; overflow-y: auto;">
                <div class="forecasts-list" id="simple-forecasts-list">
                </div>
            </div>
        </div>
        
        <div id="subscription-section" class="section">
            <div style="height: 100%; overflow-y: auto;">
                <div class="current-plan">
                    <div class="current-plan-title">Plan Actuel</div>
                    <div class="current-plan-info">Plan Gratuit</div>
                    <div class="sats-balance">
                        <i class="fab fa-bitcoin"></i>
                        <span id="user-sats-balance">0</span> sats
                    </div>
                    <div style="font-size: 14px; color: var(--inactive-text);">
                        Rechargez vos sats pour accéder aux plans premium
                    </div>
                </div>

                <div class="plan-item popular">
                    <div class="plan-title">
                        <i class="fas fa-calendar-day"></i>
                        Plan Quotidien
                    </div>
                    <div class="plan-price">
                        <i class="fab fa-bitcoin"></i>
                        10 <span class="plan-duration">sats/jour</span>
                    </div>
                    <ul class="plan-features">
                        <li>Accès aux pronostics du jour</li>
                        <li>Notifications en temps réel</li>
                        <li>Support prioritaire</li>
                    </ul>
                    <button class="plan-button" id="daily-plan-btn">
                        S'abonner au plan quotidien
                    </button>
                </div>

                <div class="plan-item">
                    <div class="plan-title">
                        <i class="fas fa-calendar-week"></i>
                        Plan Hebdomadaire
                    </div>
                    <div class="plan-price">
                        <i class="fab fa-bitcoin"></i>
                        60 <span class="plan-duration">sats/semaine</span>
                    </div>
                    <ul class="plan-features">
                        <li>Tous les avantages du plan quotidien</li>
                        <li>Économisez 10 sats par semaine</li>
                        <li>Accès aux analyses avancées</li>
                        <li>Historique complet des pronostics</li>
                    </ul>
                    <button class="plan-button" id="weekly-plan-btn">
                        S'abonner au plan hebdomadaire
                    </button>
                </div>
            </div>
        </div>

        <div id="tutorials-section" class="section">
            <div style="height: 100%; overflow-y: auto;">
                <div class="tutorial-item">
                    <div class="tutorial-thumbnail" data-video="free-sats">
                        <div class="tutorial-play-button">
                            <i class="fas fa-play"></i>
                        </div>
                        <div class="tutorial-badge">Gratuit</div>
                    </div>
                    <div class="tutorial-content">
                        <div class="tutorial-title">Comment obtenir des sats gratuitement</div>
                        <div class="tutorial-description">
                            Découvrez toutes les méthodes pour gagner des satoshis gratuitement et recharger votre compte sans dépenser d'argent. Ce tutoriel vous guide à travers différentes plateformes et techniques pour accumuler des sats.
                        </div>
                        <div class="tutorial-duration">
                            <i class="far fa-clock"></i>
                            5 minutes
                        </div>
                    </div>
                </div>

                <div class="tutorial-item">
                    <div class="tutorial-thumbnail" data-video="buy-plan">
                        <div class="tutorial-play-button">
                            <i class="fas fa-play"></i>
                        </div>
                        <div class="tutorial-badge">Premium</div>
                    </div>
                    <div class="tutorial-content">
                        <div class="tutorial-title">Comment acheter un plan d'abonnement</div>
                        <div class="tutorial-description">
                            Guide complet pour souscrire à un plan premium et profiter de tous les avantages de Pari Alliance. Apprenez à gérer votre abonnement et optimiser votre utilisation de la plateforme.
                        </div>
                        <div class="tutorial-duration">
                            <i class="far fa-clock"></i>
                            3 minutes
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="interface-section" class="section">
            <div style="height: 100%; overflow-y: auto; padding: 10px;">
                <div class="interface-section">
                    <div class="interface-title">Thème de couleur</div>
                    <div class="theme-selector">
                        <div class="theme-option theme-blue active" data-theme="default">
                            <div class="theme-label">Bleu</div>
                        </div>
                        <div class="theme-option theme-green" data-theme="green">
                            <div class="theme-label">Vert</div>
                        </div>
                        <div class="theme-option theme-red" data-theme="red">
                            <div class="theme-label">Rouge</div>
                        </div>
                        <div class="theme-option theme-orange" data-theme="orange">
                            <div class="theme-label">Orange</div>
                        </div>
                        <div class="theme-option theme-red-pink" data-theme="red-pink">
                            <div class="theme-label">Rouge-Rose</div>
                        </div>
                        <div class="theme-option theme-green-yellow" data-theme="green-yellow">
                            <div class="theme-label">Vert-Jaune</div>
                        </div>
                        <div class="theme-option theme-blue-purple" data-theme="blue-purple">
                            <div class="theme-label">Bleu-Violet</div>
                        </div>
                        <div class="theme-option theme-orange-gold" data-theme="orange-gold">
                            <div class="theme-label">Orange-Doré</div>
                        </div>
                    </div>
                </div>
                
                <div class="interface-section">
                    <div class="interface-title">Mode d'affichage</div>
                    <div class="setting-item">
                        <div class="setting-row">
                            <div class="setting-icon">
                                <i class="fas fa-moon" style="color: var(--primary-color);"></i>
                            </div>
                            <div class="setting-label">Mode sombre</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="dark-toggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="profile-section" class="section">
            <div style="height: 100%; overflow-y: auto;">
                <div class="profile-header">
                    <div class="profile-pic">
                        <i class="fas fa-user"></i>
                        <div class="profile-pic-edit" id="edit-profile-pic">
                            <i class="fas fa-pencil-alt"></i>
                        </div>
                    </div>
                    <div class="profile-info">
                        <div class="profile-name" id="profile-name">
                            <span id="profile-name-text">Utilisateur</span>
                            <span class="admin-badge" id="admin-badge" style="display: none;">Admin</span>
                        </div>
                        <div class="profile-email" id="profile-email">user@example.com</div>
                        <div class="profile-status">En ligne</div>
                        <div class="profile-edit" id="edit-profile-btn">
                            <i class="fas fa-edit"></i> Modifier le profil
                        </div>
                    </div>
                </div>
                
                <div class="section-title">Paramètres</div>
                
                <div class="settings-container">
                    <div class="section-title">Nous rejoindre</div>
                    
                    <div class="social-buttons">
                        <div class="social-button whatsapp" id="whatsapp-btn">
                            WhatsApp
                        </div>
                        <div class="social-button telegram" id="telegram-btn">
                            Telegram
                        </div>
                        <div class="social-button youtube" id="youtube-btn">
                            YouTube
                        </div>
                    </div>
                    
                    <button id="logout-btn" class="button">Se déconnecter</button>
                    <button id="delete-account-btn" class="button danger" style="margin-top: 15px;">Supprimer mon compte</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="admin-notif-dialog" class="admin-notif-dialog">
        <div class="edit-header">
            <div class="edit-back" id="admin-notif-back">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="edit-title">Nouvelle notification</div>
        </div>
        <div class="edit-content">
            <div class="form-group">
                <label class="form-label">Titre de la notification</label>
                <input type="text" class="form-input" id="notif-title" placeholder="Titre de votre notification">
                <div id="notif-title-error" class="field-error">Le titre est requis</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Contenu</label>
                <textarea class="form-input" id="notif-content" placeholder="Contenu de votre notification" rows="5" style="resize: none;"></textarea>
                <div id="notif-content-error" class="field-error">Le contenu est requis</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Type de notification</label>
                <select class="form-input" id="notif-type">
                    <option value="info">Information</option>
                    <option value="alert">Alerte</option>
                    <option value="update">Mise à jour</option>
                </select>
            </div>
            
            <button class="button" id="send-notification-btn">
                <span class="btn-loader" style="display:none;"></span>
                <span class="btn-text">Envoyer la notification</span>
            </button>
        </div>
    </div>
    
    <div id="profile-edit-dialog" class="profile-edit-dialog">
        <div class="edit-header">
            <div class="edit-back" id="profile-edit-back">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="edit-title">Modifier le profil</div>
        </div>
        <div class="edit-content">
            <div class="profile-image-upload">
                <div class="profile-image-preview" id="profile-image-preview">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-upload-btn" id="profile-upload-btn">
                    <i class="fas fa-camera"></i>
                </div>
                <input type="file" id="profile-image-input" accept="image/*">
            </div>
            
            <div class="form-group">
                <label class="form-label">Nom d'utilisateur</label>
                <div class="editable-field">
                    <input type="text" class="form-input editable-field-input" id="edit-display-name" placeholder="Entrez votre nom d'utilisateur">
                    <button class="save-field-btn" id="save-display-name-btn">Enregistrer</button>
                </div>
                <div id="edit-display-name-error" class="field-error">Le nom d'utilisateur est requis</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Photo de profil</label>
                <button class="button" id="save-profile-image-btn" style="margin-top: 10px;">
                    <span class="btn-loader" style="display:none;"></span>
                    <span class="btn-text">Enregistrer la photo</span>
                </button>
            </div>
        </div>
    </div>
    
    <div id="about-dialog" class="about-dialog">
        <div class="edit-header">
            <div class="edit-back" id="about-back">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="edit-title">À propos</div>
        </div>
        <div class="about-content">
            <div class="about-logo">
                <i class="fas fa-futbol"></i>
                <div class="about-title">Pari Alliance</div>
                <div class="about-version">Version 2.0.0</div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Description</div>
                <div class="about-section-content">
                    Pari Alliance est une application de prédictions sportives basée sur l'intelligence artificielle qui fournit des pronostics précis et fiables.
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Fonctionnalités</div>
                <div class="about-section-content">
                    • Prédictions IA avancées<br>
                    • Combinés intelligents<br>
                    • Pronostics sûrs<br>
                    • Analyses simples<br>
                    • Mode sombre personnalisable<br>
                    • Thèmes de couleurs multiples<br>
                    • Plans d'abonnement flexibles
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">À propos de l'application</div>
                <div class="about-section-content">
                    Le logo de l'application représente un ballon de football symbolisant notre expertise dans le domaine sportif. L'application a été créée par Pronosoft AI.
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Confidentialité</div>
                <div class="about-section-content">
                    Pari Alliance respecte votre vie privée. Vos données personnelles ne sont utilisées que pour le fonctionnement de l'application et ne sont jamais partagées avec des tiers.
                </div>
            </div>
            
            <div class="about-footer">
                © 2025-2026 Pari Alliance. Tous droits réservés.
            </div>
        </div>
    </div>
    
    <div id="terms-dialog" class="terms-dialog">
        <div class="terms-header">
            <div class="terms-back" id="terms-back">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="terms-title">Conditions d'utilisation</div>
        </div>
        <div class="terms-content">
            <div class="about-section">
                <div class="about-section-title">Conditions générales</div>
                <div class="about-section-content">
                    En utilisant l'application Pari Alliance, vous acceptez de respecter les présentes conditions d'utilisation. L'accès et l'utilisation de cette application sont soumis à votre acceptation et au respect des présentes conditions.
                </div>
            </div>
            
            <div class="warning-box">
                <i class="fas fa-exclamation-triangle"></i> <strong>AVERTISSEMENT :</strong> Les pronostics sont fournis à titre informatif uniquement. La vente ou revente de ces pronostics est strictement interdite et passible de bannissement à vie et de poursuites judiciaires.
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Utilisation des pronostics</div>
                <div class="about-section-content">
                    Les pronostics sportifs fournis dans cette application sont destinés uniquement à des fins d'information et de divertissement. Ils peuvent être utilisés pour effectuer des paris réels, mais il est recommandé de le faire avec responsabilité.<br><br>
                    
                    Nous ne sommes pas responsables de leurs pertes éventuelles. Les pronostics ne constituent en aucun cas une incitation au jeu ou un conseil d'investissement.<br><br>
                    
                    Il est strictement interdit de:<br>
                    • Revendre ou commercialiser ces pronostics<br>
                    • Partager ces informations en dehors de la plateforme<br>
                    • Utiliser ces informations à des fins commerciales<br><br>
                    
                    Tout utilisateur enfreignant ces règles s'expose à une suspension immédiate de son compte et à d'éventuelles poursuites judiciaires.
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Utilisation de l'application</div>
                <div class="about-section-content">
                    Vous vous engagez à utiliser l'application de manière légale et responsable. Il est interdit de:<br>
                    • Publier du contenu illégal, diffamatoire, harcelant ou menaçant<br>
                    • Usurper l'identité d'une autre personne<br>
                    • Tenter d'accéder sans autorisation à des parties de l'application qui vous sont interdites<br>
                    • Perturber le fonctionnement normal de l'application<br>
                    • Publier des messages à caractère commercial non sollicités
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Responsabilité</div>
                <div class="about-section-content">
                    Pari Alliance n'est pas responsable des pertes financières ou autres dommages qui pourraient résulter de l'utilisation des pronostics(des événements imprévus tels que les cartons rouges,les fautes pouvant causer un penalty etc...)ou des informations disponibles sur l'application. Les utilisateurs sont seuls responsables de leurs décisions et de leurs actions.
                </div>
            </div>
        </div>
    </div>
    
    <div id="delete-account-confirmation" class="confirmation-dialog">
        <div class="confirmation-title">Supprimer votre compte ?</div>
        <div class="confirmation-text">ATTENTION : Cette action est définitive et irréversible. Toutes vos données seront supprimées.</div>
        <div class="confirmation-buttons">
            <div class="confirmation-button confirmation-cancel" id="delete-account-cancel">Annuler</div>
            <div class="confirmation-button confirmation-delete" id="delete-account-confirm">Supprimer</div>
        </div>
    </div>

    <div id="logout-confirmation" class="confirmation-dialog">
        <div class="confirmation-title">Se déconnecter ?</div>
        <div class="confirmation-text">Voulez-vous vraiment vous déconnecter de Pari Alliance ?</div>
        <div class="confirmation-buttons">
            <div class="confirmation-button confirmation-cancel" id="logout-cancel">Annuler</div>
            <div class="confirmation-button confirmation-confirm" id="logout-confirm">Déconnecter</div>
        </div>
    </div>

    <div id="plan-confirmation" class="confirmation-dialog">
        <div class="confirmation-title">Confirmer l'abonnement</div>
        <div class="confirmation-text" id="plan-confirmation-text">Voulez-vous vraiment souscrire à ce plan ?</div>
        <div class="confirmation-buttons">
            <div class="confirmation-button confirmation-cancel" id="plan-cancel">Annuler</div>
            <div class="confirmation-button confirmation-confirm" id="plan-confirm">Confirmer</div>
        </div>
    </div>

    <div id="overlay" class="overlay"></div>

    <div class="notification" id="notification"></div>

    <div id="video-modal" class="video-modal">
        <div class="video-container">
            <div class="video-close" id="video-close">
                <i class="fas fa-times"></i>
            </div>
            <video class="video-player" id="video-player" controls>
                <source src="" type="video/mp4">
                Votre navigateur ne supporte pas la lecture vidéo.
            </video>
        </div>
    </div>

    <div class="bottom-nav" id="bottom-nav">
        <div class="nav-item active" data-section="ai-forecasts" style="flex: 1;">
            <i class="nav-icon fas fa-brain"></i>
            <span>Prédictions IA</span>
        </div>
        <div class="nav-item" data-section="forecasts" style="flex: 1;">
            <i class="nav-icon fas fa-futbol"></i>
            <span>Simples</span>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, deleteUser } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, query, orderBy, addDoc, onSnapshot, where, deleteDoc, serverTimestamp, updateDoc, arrayUnion, arrayRemove, limit, Timestamp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDTPLxUiA8lj82kqc6CyCPLQDITc0CtLUE",
            authDomain: "ichat-betai.firebaseapp.com",
            databaseURL: "https://ichat-betai-default-rtdb.firebaseio.com",
            projectId: "ichat-betai",
            storageBucket: "ichat-betai.appspot.com",
            messagingSenderId: "168337722600",
            appId: "1:168337722600:web:beb331f83cc4778c5b4d5d",
            measurementId: "G-STXPSZN7X8"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Debug system
        let debugLogs = [];
        let debugPanelVisible = false;

        function addDebugLog(message, type = 'info', linkUrl = null) {
            const timestamp = new Date().toLocaleTimeString('fr-FR');
            const log = {
                timestamp,
                message,
                type,
                linkUrl
            };
            
            debugLogs.push(log);
            
            // Keep only last 50 logs
            if (debugLogs.length > 50) {
                debugLogs.shift();
            }
            
            updateDebugPanel();
            
            // Show debug button if there are errors
            if (type === 'error') {
                document.getElementById('debug-toggle-btn').classList.add('active');
            }
        }

        function updateDebugPanel() {
            const content = document.getElementById('debug-log-content');
            content.innerHTML = '';
            
            debugLogs.forEach(log => {
                const item = document.createElement('div');
                item.className = `debug-log-item ${log.type}`;
                
                let messageContent = log.message;
                
                // Handle Firestore index links
                if (log.linkUrl) {
                    const linkPattern = /https:\/\/console\.firebase\.google\.com[^\s)]+/g;
                    messageContent = messageContent.replace(linkPattern, (url) => {
                        return `<a href="${url}" target="_blank" rel="noopener noreferrer" class="debug-log-link">${url}</a>`;
                    });
                }
                
                item.innerHTML = `
                    <span class="debug-log-timestamp">${log.timestamp}</span>
                    ${messageContent}
                `;
                content.appendChild(item);
            });
            
            // Auto scroll to bottom
            content.scrollTop = content.scrollHeight;
        }

        function handleFirestoreError(error, operation) {
            let errorMessage = `Erreur ${operation}: ${error.code || 'inconnu'}`;
            let linkUrl = null;
            
            if (error.code === 'failed-precondition' || error.message.includes('index')) {
                // Extract index URL from error message if available
                const urlMatch = error.message.match(/https:\/\/console\.firebase\.google\.com[^\s)]+/);
                if (urlMatch) {
                    linkUrl = urlMatch[0];
                    errorMessage += `\n\nLien pour créer l'index: ${linkUrl}`;
                } else {
                    errorMessage += '\n\nUn index Firestore est requis. Consultez la console Firebase.';
                }
            }
            
            console.error(`${operation} error:`, error);
            addDebugLog(errorMessage, 'error', linkUrl);
            
            return errorMessage;
        }

        let isLoggedIn = false;
        let currentUser = null;
        let currentUserData = null;
        let isAdmin = false;
        let currentSection = 'ai-forecasts';
        let isOnline = navigator.onLine;
        let eventsUnsubscribe = null;
        let profileImageFile = null;
        let profileUpdating = false;
        let isLoadingEvents = false;
        let profileNameChanged = false;
        let currentEventForDeletion = null;
        let currentForecastTab = 'combines';
        let lastViewedEventTimestamp = null;
        let hasNewEvents = false;
        let isSearchActive = false;
        let currentSearchContext = '';
        let selectedTheme = localStorage.getItem('parisAllianceTheme') || 'default';
        let forecastsCache = {};
        let usersCache = {};
        let userSatsBalance = 0;
        let currentPlanType = '';

        // Function to get current date in YYYY-MM-DD format
        function getCurrentDateString() {
            return new Date().toISOString().slice(0, 10);
        }

        // Function to get forecast file URL for today with new dynamic approach
        function getForecastFileUrl() {
            const today = getCurrentDateString();
            return `https://raw.githubusercontent.com/Jonnhy2255/Pronosoftbot/main/prédiction-${today}-analyse-ia.json`;
        }

        // Function to fetch forecasts from GitHub with new structure
        async function fetchForecastsFromGitHub() {
            const fileUrl = getForecastFileUrl();
            
            try {
                addDebugLog(`Récupération des pronostics depuis: ${fileUrl}`, 'info');
                
                const response = await fetch(fileUrl);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        addDebugLog(`Fichier de pronostics non trouvé pour aujourd'hui (${getCurrentDateString()})`, 'warning');
                        return null;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                addDebugLog(`Pronostics récupérés avec succès - Structure: ${Object.keys(data).join(', ')}`, 'success');
                
                return data;
            } catch (error) {
                addDebugLog(`Erreur lors de la récupération des pronostics: ${error.message}`, 'error');
                throw error;
            }
        }

        // Function to process and categorize forecasts with new structure
        function processForecastData(data) {
            const processed = {
                combines: [],
                sures: [],
                safes: [],
                simple: []
            };

            if (!data) {
                return processed;
            }

            // Traiter les combinés depuis predictions_combinees.details
            if (data.predictions_combinees && data.predictions_combinees.details) {
                data.predictions_combinees.details.forEach(forecast => {
                    processed.combines.push({
                        id: forecast.id,
                        name: forecast.name,
                        description: forecast.description,
                        matches: forecast.matches,
                        confidence: forecast.combined_confidence,
                        estimated_odds: forecast.estimated_odds,
                        type: 'combined',
                        size: forecast.size
                    });
                });
            }

            // Traiter les "sûrs" depuis recommandations.best_combined
            if (data.recommandations && data.recommandations.best_combined) {
                data.recommandations.best_combined.forEach(forecast => {
                    processed.sures.push({
                        id: forecast.id,
                        name: forecast.name,
                        description: forecast.description,
                        matches: forecast.matches,
                        confidence: forecast.combined_confidence,
                        estimated_odds: forecast.estimated_odds,
                        type: 'combined',
                        size: forecast.size
                    });
                });
            }

            // Traiter les "safes" depuis recommandations.safest_bets
            if (data.recommandations && data.recommandations.safest_bets) {
                data.recommandations.safest_bets.forEach(forecast => {
                    processed.safes.push({
                        id: forecast.id,
                        HomeTeam: forecast.HomeTeam,
                        AwayTeam: forecast.AwayTeam,
                        confidence: forecast.confidence,
                        date: forecast.date,
                        league: forecast.league,
                        country: forecast.country,
                        prediction: forecast.prediction,
                        type: 'single',
                        score_prediction: forecast.score_prediction,
                        poisson_probabilities: forecast.poisson_probabilities
                    });
                });
            }

            // Traiter les pronostics simples
            if (data.predictions_simples && data.predictions_simples.details) {
                data.predictions_simples.details.forEach(forecast => {
                    processed.simple.push({
                        id: forecast.id,
                        HomeTeam: forecast.HomeTeam,
                        AwayTeam: forecast.AwayTeam,
                        confidence: forecast.confidence,
                        date: forecast.date,
                        league: forecast.league,
                        country: forecast.country,
                        prediction: forecast.prediction,
                        type: 'single',
                        score_prediction: forecast.score_prediction,
                        poisson_probabilities: forecast.poisson_probabilities
                    });
                });
            }

            return processed;
        }

        // Enhanced card system with 3 faces and improved touch handling
        function setupCardInteractions() {
            let touchStartX = 0;
            let touchStartY = 0;
            let currentCard = null;
            let cardState = 0; // 0: front, 1: details, 2: probabilities

            document.addEventListener('touchstart', function(e) {
                const card = e.target.closest('.forecast-item');
                if (!card) return;

                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                currentCard = card;
            }, { passive: true });

            document.addEventListener('touchend', function(e) {
                if (!currentCard) return;

                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                const diffX = touchStartX - touchEndX;
                const diffY = touchStartY - touchEndY;

                // Check if it's a horizontal swipe (not vertical)
                if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                    const container = currentCard.querySelector('.forecast-card-container');
                    const indicators = currentCard.querySelectorAll('.face-dot');
                    
                    // Get current state
                    const currentState = container.classList.contains('show-details') ? 1 : 
                                       container.classList.contains('show-probabilities') ? 2 : 0;
                    
                    let newState;
                    if (diffX > 0) {
                        // Swipe left - next face
                        newState = (currentState + 1) % 3;
                    } else {
                        // Swipe right - previous face
                        newState = (currentState - 1 + 3) % 3;
                    }
                    
                    // Update card state
                    container.classList.remove('show-details', 'show-probabilities');
                    indicators.forEach(dot => dot.classList.remove('active'));
                    
                    if (newState === 1) {
                        container.classList.add('show-details');
                        indicators[1].classList.add('active');
                    } else if (newState === 2) {
                        container.classList.add('show-probabilities');
                        indicators[2].classList.add('active');
                    } else {
                        indicators[0].classList.add('active');
                    }
                }

                currentCard = null;
            }, { passive: true });

            // Support for clicks/taps
            document.addEventListener('click', function(e) {
                const card = e.target.closest('.forecast-item');
                if (!card) return;
                
                // Avoid toggle if clicking on a link or button
                if (e.target.closest('a, button')) return;
                
                const container = card.querySelector('.forecast-card-container');
                const indicators = card.querySelectorAll('.face-dot');
                
                // Get current state
                const currentState = container.classList.contains('show-details') ? 1 : 
                                   container.classList.contains('show-probabilities') ? 2 : 0;
                
                // Cycle to next face
                const newState = (currentState + 1) % 3;
                
                // Update card state
                container.classList.remove('show-details', 'show-probabilities');
                indicators.forEach(dot => dot.classList.remove('active'));
                
                if (newState === 1) {
                    container.classList.add('show-details');
                    indicators[1].classList.add('active');
                } else if (newState === 2) {
                    container.classList.add('show-probabilities');
                    indicators[2].classList.add('active');
                } else {
                    indicators[0].classList.add('active');
                }
            });
        }

        function setupTheme() {
            document.documentElement.classList.remove('theme-green', 'theme-red', 'theme-orange', 'theme-red-pink', 'theme-green-yellow', 'theme-blue-purple', 'theme-orange-gold');
            
            if (selectedTheme !== 'default') {
                document.documentElement.classList.add(`theme-${selectedTheme}`);
            }
            
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
            });
            
            const activeThemeOption = document.querySelector(`.theme-option[data-theme="${selectedTheme}"]`);
            if (activeThemeOption) {
                activeThemeOption.classList.add('active');
            }
        }
        
        function setupDarkMode() {
            const savedPreference = localStorage.getItem('parisAllianceDarkMode');
            
            if (savedPreference === 'true') {
                document.documentElement.classList.add('dark');
                document.getElementById('dark-toggle').checked = true;
            } else if (savedPreference === 'false') {
                document.documentElement.classList.remove('dark');
                document.getElementById('dark-toggle').checked = false;
            } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                document.getElementById('dark-toggle').checked = true;
            } else {
                document.documentElement.classList.remove('dark');
                document.getElementById('dark-toggle').checked = false;
            }
            
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (localStorage.getItem('parisAllianceDarkMode') === null) {
                    if (event.matches) {
                        document.documentElement.classList.add('dark');
                        document.getElementById('dark-toggle').checked = true;
                    } else {
                        document.documentElement.classList.remove('dark');
                        document.getElementById('dark-toggle').checked = false;
                    }
                }
            });
        }
        
        function setupConnectionMonitoring() {
            function updateConnectionStatus() {
                if (navigator.onLine) {
                    isOnline = true;
                } else {
                    isOnline = false;
                    showNotification("Pas de connexion internet.", "error");
                }
            }
            
            window.addEventListener('online', () => {
                showNotification("Connexion rétablie", "success");
                isOnline = true;
                
                setTimeout(() => {
                    if (isLoggedIn && (currentSection === 'ai-forecasts' || currentSection === 'forecasts')) {
                        loadForecastsData(currentForecastTab);
                    }
                }, 1000);
            });
            
            window.addEventListener('offline', () => {
                updateConnectionStatus();
            });
            
            updateConnectionStatus();
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            notification.classList.remove('show');
            
            setTimeout(() => {
                notification.textContent = message;
                notification.className = 'notification ' + type;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    
                    setTimeout(() => {
                        notification.className = 'notification';
                        notification.textContent = '';
                    }, 300);
                }, 3000);
            }, 100);
        }

        async function loadUserSubscriptionData() {
            if (!currentUser) return;
            
            try {
                const userRef = doc(db, "Users", currentUser.uid);
                const userDoc = await getDoc(userRef);
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    userSatsBalance = userData.satsBalance || 0;
                    currentPlanType = userData.currentPlan || 'free';
                    
                    updateSubscriptionDisplay();
                }
            } catch (error) {
                console.error('Erreur lors du chargement des données d\'abonnement:', error);
            }
        }

        function updateSubscriptionDisplay() {
            const satsBalanceElement = document.getElementById('user-sats-balance');
            if (satsBalanceElement) {
                satsBalanceElement.textContent = userSatsBalance;
            }
            
            // Les boutons affichent toujours "S'abonner" au lieu de "Sats insuffisants"
            const planButtons = document.querySelectorAll('.plan-button');
            planButtons.forEach(button => {
                const isDaily = button.id === 'daily-plan-btn';
                
                button.disabled = false;
                if (isDaily) {
                    button.textContent = 'S\'abonner au plan quotidien';
                } else {
                    button.textContent = 'S\'abonner au plan hebdomadaire';
                }
            });
        }

        async function subscribeToPlan(planType) {
            const requiredSats = planType === 'daily' ? 10 : 60;
            
            if (userSatsBalance < requiredSats) {
                showNotification('Sats insuffisants pour ce plan', 'error');
                return;
            }
            
            try {
                const userRef = doc(db, "Users", currentUser.uid);
                await updateDoc(userRef, {
                    satsBalance: userSatsBalance - requiredSats,
                    currentPlan: planType,
                    planExpiryDate: new Date(Date.now() + (planType === 'daily' ? 24 * 60 * 60 * 1000 : 7 * 24 * 60 * 60 * 1000))
                });
                
                userSatsBalance -= requiredSats;
                currentPlanType = planType;
                
                updateSubscriptionDisplay();
                
                showNotification(`Abonnement ${planType === 'daily' ? 'quotidien' : 'hebdomadaire'} activé !`, 'success');
                
            } catch (error) {
                console.error('Erreur lors de l\'abonnement:', error);
                showNotification('Erreur lors de l\'abonnement', 'error');
            }
        }

        function showPlanConfirmation(planType) {
            const requiredSats = planType === 'daily' ? 10 : 60;
            const planName = planType === 'daily' ? 'quotidien' : 'hebdomadaire';
            
            document.getElementById('plan-confirmation-text').textContent = 
                `Voulez-vous vraiment souscrire au plan ${planName} pour ${requiredSats} sats ?`;
            
            document.getElementById('plan-confirmation').classList.add('active');
            document.getElementById('overlay').classList.add('active');
            
            // Store plan type for confirmation
            document.getElementById('plan-confirm').setAttribute('data-plan', planType);
            
            history.pushState({ page: 'plan-confirmation' }, '');
        }

        function hidePlanConfirmation() {
            document.getElementById('plan-confirmation').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }

        function playTutorialVideo(videoType) {
            const videoModal = document.getElementById('video-modal');
            const videoPlayer = document.getElementById('video-player');
            
            // Simulate video URLs (replace with actual video URLs)
            const videoUrls = {
                'free-sats': 'https://example.com/free-sats-tutorial.mp4',
                'buy-plan': 'https://example.com/buy-plan-tutorial.mp4'
            };
            
            if (videoUrls[videoType]) {
                videoPlayer.src = videoUrls[videoType];
                videoModal.classList.add('active');
                history.pushState({ page: 'video-tutorial' }, '');
            } else {
                // Fallback: show notification for demo
                const videoTitles = {
                    'free-sats': 'Comment obtenir des sats gratuitement',
                    'buy-plan': 'Comment acheter un plan d\'abonnement'
                };
                
                showNotification(`Vidéo "${videoTitles[videoType]}" bientôt disponible`, 'info');
            }
        }

        function closeVideoModal() {
            const videoModal = document.getElementById('video-modal');
            const videoPlayer = document.getElementById('video-player');
            
            videoModal.classList.remove('active');
            videoPlayer.pause();
            videoPlayer.src = '';
        }
        
        function setupUIEvents() {
            // Debug panel setup
            document.getElementById('debug-toggle-btn').addEventListener('click', function() {
                debugPanelVisible = !debugPanelVisible;
                const panel = document.getElementById('debug-log-panel');
                if (debugPanelVisible) {
                    panel.classList.add('active');
                    updateDebugPanel();
                } else {
                    panel.classList.remove('active');
                }
            });

            document.getElementById('debug-log-close').addEventListener('click', function() {
                debugPanelVisible = false;
                document.getElementById('debug-log-panel').classList.remove('active');
            });

            document.getElementById('header-menu-button').addEventListener('click', function() {
                document.getElementById('side-menu').classList.add('active');
                document.getElementById('side-menu-overlay').classList.add('active');
            });
            
            document.getElementById('side-menu-close').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
            });
            
            document.getElementById('side-menu-overlay').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
            });
            
            document.getElementById('menu-profile').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showProfileSection();
            });

            document.getElementById('menu-subscription').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showSubscriptionSection();
            });

            document.getElementById('menu-tutorials').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showTutorialsSection();
            });
            
            document.getElementById('menu-interface').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showInterfaceSection();
            });
            
            document.getElementById('menu-terms').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showTermsDialog();
            });
            
            document.getElementById('terms-back').addEventListener('click', hideTermsDialog);
            
            document.getElementById('menu-about').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showAboutDialog();
            });
            
            document.getElementById('about-back').addEventListener('click', hideAboutDialog);
            
            document.getElementById('search-button').addEventListener('click', function() {
                toggleSearchBar();
            });
            
            document.getElementById('search-close').addEventListener('click', function() {
                hideSearchBar();
            });
            
            document.getElementById('search-input').addEventListener('input', function() {
                handleSearch(this.value);
            });
            
            document.getElementById('events-button').addEventListener('click', function() {
                showEventsSection();
                updateLastViewedEventTimestamp();
                hideEventNotificationDot();
            });
            
            document.getElementById('bottom-nav').addEventListener('click', function(e) {
                const navItems = this.querySelectorAll('.nav-item');
                
                for (let i = 0; i < navItems.length; i++) {
                    const item = navItems[i];
                    const rect = item.getBoundingClientRect();
                    
                    if (e.clientX >= rect.left && e.clientX <= rect.right &&
                        e.clientY >= rect.top && e.clientY <= rect.bottom) {
                        
                        const section = item.getAttribute('data-section');
                        if (section === 'ai-forecasts') {
                            showAIForecastsSection();
                        } else if (section === 'forecasts') {
                            showForecastsSection();
                        }
                        
                        break;
                    }
                }
            });

            // Tutorial video events
            document.querySelectorAll('.tutorial-thumbnail').forEach(thumbnail => {
                thumbnail.addEventListener('click', function() {
                    const videoType = this.getAttribute('data-video');
                    playTutorialVideo(videoType);
                });
            });

            document.getElementById('video-close').addEventListener('click', closeVideoModal);

            // Subscription plan events
            document.getElementById('daily-plan-btn').addEventListener('click', function() {
                showPlanConfirmation('daily');
            });

            document.getElementById('weekly-plan-btn').addEventListener('click', function() {
                showPlanConfirmation('weekly');
            });

            document.getElementById('plan-cancel').addEventListener('click', hidePlanConfirmation);
            document.getElementById('plan-confirm').addEventListener('click', function() {
                const planType = this.getAttribute('data-plan');
                hidePlanConfirmation();
                subscribeToPlan(planType);
            });
            
            document.querySelectorAll('.ai-forecast-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchAIForecastTab(tabId);
                });
            });
            
            document.getElementById('dark-toggle').addEventListener('change', function() {
                if (this.checked) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                
                localStorage.setItem('parisAllianceDarkMode', this.checked ? 'true' : 'false');
            });
            
            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', function() {
                    const theme = this.getAttribute('data-theme');
                    selectedTheme = theme;
                    
                    document.documentElement.classList.remove('theme-green', 'theme-red', 'theme-orange', 'theme-red-pink', 'theme-green-yellow', 'theme-blue-purple', 'theme-orange-gold');
                    
                    if (theme !== 'default') {
                        document.documentElement.classList.add(`theme-${theme}`);
                    }
                    
                    document.querySelectorAll('.theme-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    localStorage.setItem('parisAllianceTheme', theme);
                    
                    const themeNames = {
                        'default': 'Bleu',
                        'green': 'Vert',
                        'red': 'Rouge',
                        'orange': 'Orange',
                        'red-pink': 'Rouge-Rose',
                        'green-yellow': 'Vert-Jaune',
                        'blue-purple': 'Bleu-Violet',
                        'orange-gold': 'Orange-Doré'
                    };
                    
                    showNotification(`Thème ${themeNames[theme]} appliqué`, 'success');
                });
            });
            
            document.getElementById('logout-btn').addEventListener('click', showLogoutConfirmation);
            document.getElementById('logout-cancel').addEventListener('click', hideLogoutConfirmation);
            document.getElementById('logout-confirm').addEventListener('click', logoutUser);
            
            document.getElementById('delete-account-btn').addEventListener('click', showDeleteAccountConfirmation);
            
            document.getElementById('delete-account-cancel').addEventListener('click', hideDeleteAccountConfirmation);
            document.getElementById('delete-account-confirm').addEventListener('click', deleteAccount);
            
            document.getElementById('edit-profile-btn').addEventListener('click', showProfileEditDialog);
            document.getElementById('edit-profile-pic').addEventListener('click', showProfileEditDialog);
            
            document.getElementById('profile-edit-back').addEventListener('click', hideProfileEditDialog);
            document.getElementById('profile-upload-btn').addEventListener('click', function() {
                document.getElementById('profile-image-input').click();
            });
            
            document.getElementById('profile-image-input').addEventListener('change', handleProfileImageSelect);
            
            document.getElementById('save-display-name-btn').addEventListener('click', updateDisplayName);
            document.getElementById('save-profile-image-btn').addEventListener('click', updateProfileImage);
            
            document.getElementById('edit-display-name').addEventListener('input', function() {
                profileNameChanged = true;
                document.getElementById('save-display-name-btn').disabled = this.value.trim() === '';
            });
            
            document.getElementById('admin-notif-back').addEventListener('click', hideAdminNotificationDialog);
            document.getElementById('send-notification-btn').addEventListener('click', sendAdminNotification);
            
            document.addEventListener('contextmenu', function(e) {
                if (e.target.tagName === 'IMG') {
                    e.preventDefault();
                    return false;
                }
            });
            
            document.getElementById('whatsapp-btn').addEventListener('click', function() {
                openSocialLink('whatsapp');
            });
            
            document.getElementById('telegram-btn').addEventListener('click', function() {
                openSocialLink('telegram');
            });
            
            document.getElementById('youtube-btn').addEventListener('click', function() {
                openSocialLink('youtube');
            });
            
            const touchableElements = document.querySelectorAll('.menu-button, .back-button, .search-button, .events-button, .info-button, .search-close');
            touchableElements.forEach(element => {
                element.addEventListener('touchstart', createRippleEffect);
            });
            
            window.addEventListener('popstate', handleBackButton);
            
            history.pushState({ page: 'main' }, '');

            // Setup card interactions for improved swipe handling
            setupCardInteractions();
        }
        
        function handleBackButton(event) {
            event.preventDefault();
            
            if (document.querySelector('.confirmation-dialog.active')) {
                document.querySelectorAll('.confirmation-dialog.active').forEach(dialog => {
                    const cancelBtn = dialog.querySelector('.confirmation-cancel');
                    if (cancelBtn) cancelBtn.click();
                });
                history.pushState({ page: 'main' }, '');
                return;
            }

            if (document.getElementById('video-modal').classList.contains('active')) {
                closeVideoModal();
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            if (isSearchActive) {
                hideSearchBar();
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            if (document.getElementById('side-menu').classList.contains('active')) {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            if (currentSection !== 'ai-forecasts') {
                showAIForecastsSection();
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            const dialogs = [
                { id: 'about-dialog', backBtn: 'about-back' },
                { id: 'terms-dialog', backBtn: 'terms-back' },
                { id: 'profile-edit-dialog', backBtn: 'profile-edit-back' },
                { id: 'admin-notif-dialog', backBtn: 'admin-notif-back' }
            ];
            
            for (const dialog of dialogs) {
                if (document.getElementById(dialog.id).classList.contains('active')) {
                    document.getElementById(dialog.backBtn).click();
                    history.pushState({ page: 'main' }, '');
                    return;
                }
            }
            
            if (currentSection === 'ai-forecasts') {
                history.pushState({ page: 'main' }, '');
            }
        }
        
        function createRippleEffect(e) {
            const button = e.currentTarget;
            const circle = document.createElement('span');
            const diameter = Math.max(button.clientWidth, button.clientHeight);
            
            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${e.touches[0].pageX - button.offsetLeft - diameter / 2}px`;
            circle.style.top = `${e.touches[0].pageY - button.offsetTop - diameter / 2}px`;
            circle.classList.add('ripple');
            
            const ripple = button.querySelector('.ripple');
            if (ripple) {
                ripple.remove();
            }
            
            button.appendChild(circle);
            
            setTimeout(() => {
                circle.remove();
            }, 600);
        }
        
        function toggleSearchBar() {
            const searchContainer = document.getElementById('search-container');
            const searchInput = document.getElementById('search-input');
            const header = document.querySelector('.header');
            
            if (isSearchActive) {
                hideSearchBar();
            } else {
                header.classList.add('search-active');
                searchContainer.classList.add('active');
                searchInput.focus();
                isSearchActive = true;
                
                history.pushState({ page: 'search' }, '');
                
                currentSearchContext = currentSection;
                
                if (currentSearchContext === 'ai-forecasts') {
                    searchInput.placeholder = 'Rechercher une prédiction...';
                } else if (currentSearchContext === 'events') {
                    searchInput.placeholder = 'Rechercher un événement...';
                } else if (currentSearchContext === 'forecasts') {
                    searchInput.placeholder = 'Rechercher un pronostic...';
                }
            }
        }
        
        function hideSearchBar() {
            const searchContainer = document.getElementById('search-container');
            const searchInput = document.getElementById('search-input');
            const header = document.querySelector('.header');
            
            searchContainer.classList.remove('active');
            searchContainer.classList.add('hiding');
            
            setTimeout(() => {
                header.classList.remove('search-active');
                searchInput.value = '';
                searchContainer.classList.remove('hiding');
                isSearchActive = false;
                
                handleSearch('');
            }, 300);
        }
        
        function handleSearch(query) {
            if (currentSearchContext === 'ai-forecasts') {
                filterForecasts(query);
            } else if (currentSearchContext === 'events') {
                filterEvents(query);
            } else if (currentSearchContext === 'forecasts') {
                filterForecasts(query);
            }
        }

        function filterForecasts(query) {
            // Implement forecast filtering logic here
            // This would filter the displayed forecasts based on the search query
        }

        function filterEvents(query) {
            // Implement events filtering logic here
            // This would filter the displayed events based on the search query
        }
        
        function openSocialLink(platform) {
            let url = '';
            
            switch(platform) {
                case 'whatsapp':
                    url = 'https://wa.me/';
                    showNotification('Ouverture de WhatsApp', 'info');
                    break;
                case 'telegram':
                    url = 'https://t.me/';
                    showNotification('Ouverture de Telegram', 'info');
                    break;
                case 'youtube':
                    url = 'https://www.youtube.com/';
                    showNotification('Ouverture de YouTube', 'info');
                    break;
                default:
                    return;
            }
            
            window.open(url, '_blank', 'noopener,noreferrer');
        }
        
        function showTermsDialog() {
            document.getElementById('terms-dialog').classList.add('active');
            history.pushState({ page: 'terms' }, '');
        }
        
        function hideTermsDialog() {
            document.getElementById('terms-dialog').classList.remove('active');
        }
        
        function showAboutDialog() {
            document.getElementById('about-dialog').classList.add('active');
            history.pushState({ page: 'about' }, '');
        }
        
        function hideAboutDialog() {
            document.getElementById('about-dialog').classList.remove('active');
        }

        function showSubscriptionSection() {
            hideSearchBar();
            
            currentSection = 'subscription';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('subscription-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Abonnement';
            
            document.getElementById('header-menu-button').style.display = 'none';
            document.getElementById('header-back-button').style.display = 'block';
            
            document.getElementById('header-action').innerHTML = '';
            
            document.getElementById('header-back-button').addEventListener('click', function() {
                showAIForecastsSection();
            });

            document.getElementById('bottom-nav').style.display = 'none';
            document.querySelector('.content').classList.add('no-bottom-nav');
            
            loadUserSubscriptionData();
            
            history.pushState({ page: 'subscription' }, '');
        }

        function showTutorialsSection() {
            hideSearchBar();
            
            currentSection = 'tutorials';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('tutorials-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Tutoriels';
            
            document.getElementById('header-menu-button').style.display = 'none';
            document.getElementById('header-back-button').style.display = 'block';
            
            document.getElementById('header-action').innerHTML = '';
            
            document.getElementById('header-back-button').addEventListener('click', function() {
                showAIForecastsSection();
            });

            document.getElementById('bottom-nav').style.display = 'none';
            document.querySelector('.content').classList.add('no-bottom-nav');
            
            history.pushState({ page: 'tutorials' }, '');
        }
        
        function switchAIForecastTab(tabId) {
            currentForecastTab = tabId;
            
            document.querySelectorAll('.ai-forecast-tab').forEach(tab => {
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            document.querySelectorAll('.ai-forecasts-content').forEach(content => {
                if (content.id === `${tabId}-content`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
            
            loadForecastsData(tabId);
        }
        
        function showAIForecastsSection() {
            hideSearchBar();
            
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.getAttribute('data-section') === 'ai-forecasts') {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            document.getElementById('header-menu-button').style.display = 'block';
            document.getElementById('header-back-button').style.display = 'none';
            
            currentSection = 'ai-forecasts';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('ai-forecasts-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Prédictions IA';
            
            document.getElementById('header-action').innerHTML = `
                <div class="search-button" id="search-button">
                    <i class="fas fa-search"></i>
                </div>
                <div class="events-button" id="events-button">
                    <i class="fas fa-bell"></i>
                    <div class="notification-dot" id="events-notification-dot"></div>
                </div>
            `;
            
            if (hasNewEvents) {
                document.getElementById('events-notification-dot').classList.add('active');
            }
            
            document.getElementById('search-button').addEventListener('click', toggleSearchBar);
            document.getElementById('events-button').addEventListener('click', function() {
                showEventsSection();
                updateLastViewedEventTimestamp();
                hideEventNotificationDot();
            });

            document.getElementById('bottom-nav').style.display = 'flex';
            document.querySelector('.content').classList.remove('no-bottom-nav');
            
            loadForecastsData(currentForecastTab);
        }
        
        function showInterfaceSection() {
            hideSearchBar();
            
            currentSection = 'interface';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('interface-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Interface';
            
            document.getElementById('header-menu-button').style.display = 'none';
            document.getElementById('header-back-button').style.display = 'block';
            
            document.getElementById('header-action').innerHTML = '';
            
            document.getElementById('header-back-button').addEventListener('click', function() {
                showAIForecastsSection();
            });

            document.getElementById('bottom-nav').style.display = 'none';
            document.querySelector('.content').classList.add('no-bottom-nav');
            
            setupTheme();
            
            history.pushState({ page: 'interface' }, '');
        }
        
        async function loadForecastsData(tabType) {
            if (forecastsCache[tabType]) {
                displayForecastsFromCache(tabType);
                return;
            }
            
            let listElement;
            if (currentSection === 'ai-forecasts') {
                listElement = document.getElementById(`${tabType}-list`);
            } else {
                listElement = document.getElementById('simple-forecasts-list');
            }
            
            if (!listElement) return;
            
            listElement.innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 200px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 30px; color: var(--primary-color);"></i>
                    <div style="margin-top: 10px; font-weight: bold;">Chargement des pronostics...</div>
                </div>
            `;
            
            try {
                // Fetch forecasts from GitHub
                const githubData = await fetchForecastsFromGitHub();
                
                if (!githubData) {
                    listElement.innerHTML = `
                        <div class="no-forecasts">
                            <i class="fas fa-calendar-day"></i>
                            <div class="empty-state-title">Pas de pronostics aujourd'hui</div>
                            <div class="empty-state-text">Aucun pronostic disponible pour aujourd'hui (${getCurrentDateString()})</div>
                        </div>
                    `;
                    return;
                }
                
                // Process and categorize the data
                const processedData = processForecastData(githubData);
                
                // Cache the processed data
                Object.keys(processedData).forEach(type => {
                    forecastsCache[type] = processedData[type];
                });
                
                if (currentSection === 'ai-forecasts') {
                    displayForecastsFromCache(tabType);
                } else {
                    displayForecastsFromCache('simple');
                }
                
            } catch (error) {
                addDebugLog(`Erreur chargement pronostics: ${error.message}`, 'error');
                listElement.innerHTML = `
                    <div class="no-forecasts">
                        <i class="fas fa-exclamation-circle"></i>
                        <div class="empty-state-title">Erreur</div>
                        <div class="empty-state-text">Impossible de charger les pronostics depuis GitHub</div>
                    </div>
                `;
            }
        }
        
        function displayForecastsFromCache(tabType) {
            let listElement;
            if (currentSection === 'ai-forecasts') {
                listElement = document.getElementById(`${tabType}-list`);
            } else {
                listElement = document.getElementById('simple-forecasts-list');
            }
            
            if (!listElement || !forecastsCache[tabType]) return;
            
            listElement.innerHTML = '';
            
            const forecasts = forecastsCache[tabType];
            
            if (forecasts.length === 0) {
                listElement.innerHTML = `
                    <div class="no-forecasts">
                        <i class="fas fa-futbol"></i>
                        <div class="empty-state-title">Aucun pronostic</div>
                        <div class="empty-state-text">Aucun pronostic disponible pour cette catégorie</div>
                    </div>
                `;
                return;
            }
            
            const fragment = document.createDocumentFragment();
            
            forecasts.forEach((forecastData) => {
                const forecastElement = createForecastElement(forecastData, tabType);
                fragment.appendChild(forecastElement);
            });
            
            listElement.appendChild(fragment);
        }
        
        function createForecastElement(forecastData, type) {
            const forecastElement = document.createElement('div');
            forecastElement.className = 'forecast-item';
            
            let statusClass = 'pending';
            let statusText = 'À venir';
            
            if (forecastData.status === 'win') {
                statusClass = 'win';
                statusText = 'Gagné';
            } else if (forecastData.status === 'loss') {
                statusClass = 'loss';
                statusText = 'Perdu';
            }
            
            let formattedDate = 'Aujourd\'hui';
            if (forecastData.date) {
                const dateStr = forecastData.date;
                if (dateStr.includes('UTC')) {
                    const dateParts = dateStr.split(' à ');
                    if (dateParts.length === 2) {
                        const timePart = dateParts[1].replace(' UTC', '');
                        formattedDate = `${dateParts[0]} à ${timePart}`;
                    }
                } else {
                    formattedDate = dateStr;
                }
            }

            let frontContent = '';
            let detailsContent = '';
            let probabilitiesContent = '';
            
            if (type === 'combines' || type === 'sures') {
                // Combinés - Afficher TOUS les matchs sur la première face
                frontContent = `
                    <div class="forecast-header">
                        <div>${forecastData.name || 'Combiné'}</div>
                        <div class="forecast-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="combined-matches">
                        <div class="combined-matches-title">${type === 'sures' ? 'Combiné Sûr' : 'Combiné IA'} (${forecastData.matches ? forecastData.matches.length : 0} matchs)</div>
                        ${forecastData.matches ? forecastData.matches.map(match => 
                            `<div class="match-detail">
                                <div class="match-name">${match.match}</div>
                                <div class="match-prediction">${match.prediction}</div>
                            </div>`
                        ).join('') : ''}
                    </div>
                `;

                // 2ème face - Juste la description, pas les matchs
                detailsContent = `
                    <div class="forecast-description">
                        <h3 style="color: var(--primary-color); margin-bottom: 15px;">Description complète</h3>
                        <div style="background-color: rgba(0,0,0,0.05); padding: 15px; border-radius: 10px; line-height: 1.5;">
                            ${forecastData.description || 'Aucune description disponible pour ce combiné.'}
                        </div>
                    </div>
                    ${forecastData.estimated_odds ? `
                        <div class="estimated-odds">
                            Cote estimée: ${forecastData.estimated_odds}
                        </div>
                    ` : ''}
                `;

                probabilitiesContent = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h3 style="color: var(--primary-color); margin-bottom: 15px;">Statistiques avancées</h3>
                        <div style="background-color: rgba(0,0,0,0.05); padding: 15px; border-radius: 10px;">
                            <div style="margin-bottom: 10px;">
                                <strong>Taille du combiné:</strong> ${forecastData.size || forecastData.matches?.length || 'N/A'} matchs
                            </div>
                            <div style="margin-bottom: 10px;">
                                <strong>Confiance globale:</strong> ${forecastData.confidence || 'N/A'}%
                            </div>
                            ${forecastData.estimated_odds ? `
                                <div style="margin-bottom: 10px;">
                                    <strong>Cote estimée:</strong> ${forecastData.estimated_odds}
                                </div>
                            ` : ''}
                            <div style="font-size: 12px; margin-top: 15px; opacity: 0.8;">
                                Plus le combiné contient de matchs, plus la cote est élevée mais le risque augmente.
                            </div>
                        </div>
                    </div>
                `;
            } else {
                // Safes et Simples
                frontContent = `
                    <div class="forecast-header">
                        <div>${forecastData.league || 'Compétition'}</div>
                        <div class="forecast-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="forecast-match">
                        <div class="forecast-team">
                            <div class="forecast-team-logo">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="forecast-team-name">${forecastData.HomeTeam || 'Équipe 1'}</div>
                        </div>
                        <div class="forecast-score">VS</div>
                        <div class="forecast-team">
                            <div class="forecast-team-logo">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="forecast-team-name">${forecastData.AwayTeam || 'Équipe 2'}</div>
                        </div>
                    </div>
                    <div style="text-align: center; font-weight: bold; margin: 15px 0; padding: 10px; background-color: var(--primary-color); color: white; border-radius: 10px;">
                        ${type === 'safes' ? 'Pronostic Safe' : 'Pronostic'}: ${forecastData.prediction || 'N/A'}
                    </div>
                `;

                detailsContent = `
                    <div class="forecast-description">
                        <h3 style="color: var(--primary-color); margin-bottom: 15px;">Informations du match</h3>
                        <div style="background-color: rgba(0,0,0,0.05); padding: 15px; border-radius: 10px;">
                            <div style="margin-bottom: 8px;"><strong>Match:</strong> ${forecastData.HomeTeam} vs ${forecastData.AwayTeam}</div>
                            <div style="margin-bottom: 8px;"><strong>Compétition:</strong> ${forecastData.league || 'N/A'}</div>
                            <div style="margin-bottom: 8px;"><strong>Pays:</strong> ${forecastData.country || 'N/A'}</div>
                            <div style="margin-bottom: 8px;"><strong>Prédiction de score:</strong> ${forecastData.score_prediction || 'N/A'}</div>
                            <div style="margin-bottom: 8px;"><strong>Confiance:</strong> ${forecastData.confidence || 'N/A'}%</div>
                        </div>
                    </div>
                `;

                probabilitiesContent = `
                    <div>
                        <h3 style="color: var(--primary-color); margin-bottom: 15px; text-align: center;">Probabilités de Poisson</h3>
                        ${forecastData.poisson_probabilities ? `
                            <div class="poisson-probabilities">
                                <div class="poisson-row">
                                    <span>🏠 Victoire domicile:</span>
                                    <strong>${forecastData.poisson_probabilities.win1?.toFixed(1) || 'N/A'}%</strong>
                                </div>
                                <div class="poisson-row">
                                    <span>🤝 Match nul:</span>
                                    <strong>${forecastData.poisson_probabilities.draw?.toFixed(1) || 'N/A'}%</strong>
                                </div>
                                <div class="poisson-row">
                                    <span>✈️ Victoire extérieur:</span>
                                    <strong>${forecastData.poisson_probabilities.win2?.toFixed(1) || 'N/A'}%</strong>
                                </div>
                                <div class="poisson-row">
                                    <span>⚽ Plus de 1.5 buts:</span>
                                    <strong>${forecastData.poisson_probabilities.over15?.toFixed(1) || 'N/A'}%</strong>
                                </div>
                                <div class="poisson-row">
                                    <span>🎯 Plus de 2.5 buts:</span>
                                    <strong>${forecastData.poisson_probabilities.over25?.toFixed(1) || 'N/A'}%</strong>
                                </div>
                                <div class="poisson-row">
                                    <span>⚽⚽ Les deux équipes marquent:</span>
                                    <strong>${forecastData.poisson_probabilities.btts?.toFixed(1) || 'N/A'}%</strong>
                                </div>
                            </div>
                        ` : `
                            <div style="text-align: center; padding: 20px; color: var(--inactive-text);">
                                <i class="fas fa-chart-bar" style="font-size: 30px; margin-bottom: 10px;"></i>
                                <div>Probabilités non disponibles pour ce match</div>
                            </div>
                        `}
                    </div>
                `;
            }
            
            const confidence = forecastData.confidence || 75;
            const confidenceSection = `
                <div class="forecast-confidence">
                    <span>Confiance:</span>
                    <div class="confidence-bar-container">
                        <div class="confidence-bar" style="width: ${confidence}%"></div>
                    </div>
                    <span>${confidence}%</span>
                </div>
                <div class="forecast-date">${formattedDate}</div>
            `;
            
            forecastElement.innerHTML = `
                <div class="forecast-card-container">
                    <div class="forecast-face forecast-front">
                        ${frontContent}
                        ${confidenceSection}
                    </div>
                    <div class="forecast-face forecast-details">
                        ${detailsContent}
                    </div>
                    <div class="forecast-face forecast-probabilities">
                        ${probabilitiesContent}
                    </div>
                </div>
                <div class="face-indicator">
                    <div class="face-dot active"></div>
                    <div class="face-dot"></div>
                    <div class="face-dot"></div>
                </div>
                <div class="swipe-instruction">Swipez ou appuyez →</div>
            `;
            
            return forecastElement;
        }
        
        function showForecastsSection() {
            hideSearchBar();
            
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.getAttribute('data-section') === 'forecasts') {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            document.getElementById('header-menu-button').style.display = 'block';
            document.getElementById('header-back-button').style.display = 'none';
            
            currentSection = 'forecasts';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('forecasts-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Simples';
            
            document.getElementById('header-action').innerHTML = `
                <div class="search-button" id="search-button">
                    <i class="fas fa-search"></i>
                </div>
                <div class="events-button" id="events-button">
                    <i class="fas fa-bell"></i>
                    <div class="notification-dot" id="events-notification-dot"></div>
                </div>
            `;
            
            if (hasNewEvents) {
                document.getElementById('events-notification-dot').classList.add('active');
            }
            
            document.getElementById('search-button').addEventListener('click', toggleSearchBar);
            document.getElementById('events-button').addEventListener('click', function() {
                showEventsSection();
                updateLastViewedEventTimestamp();
                hideEventNotificationDot();
            });

            document.getElementById('bottom-nav').style.display = 'flex';
            document.querySelector('.content').classList.remove('no-bottom-nav');
            
            loadForecastsData('simple');
        }
        
        function showEventsSection() {
            hideSearchBar();
            
            currentSection = 'events';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('events-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Événements';
            
            document.getElementById('header-menu-button').style.display = 'none';
            document.getElementById('header-back-button').style.display = 'block';
            
            document.getElementById('header-action').innerHTML = `
                <div class="search-button" id="search-button">
                    <i class="fas fa-search"></i>
                </div>
            `;
            
            if (isAdmin) {
                document.getElementById('header-action').innerHTML += `
                    <div class="events-button" id="create-notification-btn" style="background-color: var(--primary-color); color: white;">
                        <i class="fas fa-bullhorn"></i>
                    </div>
                `;
                
                document.getElementById('create-notification-btn').addEventListener('click', function() {
                    showAdminNotificationDialog();
                });
            }
            
            document.getElementById('search-button').addEventListener('click', toggleSearchBar);
            
            document.getElementById('header-back-button').addEventListener('click', function() {
                showAIForecastsSection();
            });
            
            document.getElementById('bottom-nav').style.display = 'none';
            document.querySelector('.content').classList.add('no-bottom-nav');
            
            listenToEvents();
            
            history.pushState({ page: 'events' }, '');
        }
        
        function showProfileSection() {
            hideSearchBar();
            
            currentSection = 'profile';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('profile-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Profil';
            
            document.getElementById('header-menu-button').style.display = 'none';
            document.getElementById('header-back-button').style.display = 'block';
            
            document.getElementById('header-action').innerHTML = '';
            
            document.getElementById('header-back-button').addEventListener('click', function() {
                showAIForecastsSection();
            });

            document.getElementById('bottom-nav').style.display = 'none';
            document.querySelector('.content').classList.add('no-bottom-nav');
            
            history.pushState({ page: 'profile' }, '');
        }

        function listenToEvents() {
            if (eventsUnsubscribe) {
                eventsUnsubscribe();
            }
            
            try {
                const eventsRef = collection(db, "Events");
                const q = query(eventsRef, orderBy("createdAt", "desc"), limit(50));
                
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const eventsList = document.getElementById('events-list');
                    
                    if (snapshot.empty) {
                        eventsList.innerHTML = `
                            <div class="empty-state">
                                <i class="fas fa-bell"></i>
                                <div class="empty-state-title">Aucun événement</div>
                                <div class="empty-state-text">Les événements apparaîtront ici</div>
                            </div>
                        `;
                        return;
                    }
                    
                    const events = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        events.push({
                            id: doc.id,
                            ...data
                        });
                    });
                    
                    displayEvents(events);
                    
                    // Check for new events
                    const latestEventTimestamp = events[0]?.createdAt;
                    if (lastViewedEventTimestamp && latestEventTimestamp && 
                        latestEventTimestamp.seconds > lastViewedEventTimestamp) {
                        hasNewEvents = true;
                        showEventNotificationDot();
                    }
                    
                }, (error) => {
                    const errorMsg = handleFirestoreError(error, 'écoute des événements');
                    document.getElementById('events-list').innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div class="empty-state-title">Erreur</div>
                            <div class="empty-state-text">Impossible de charger les événements</div>
                        </div>
                    `;
                });
                
                eventsUnsubscribe = unsubscribe;
                
            } catch (error) {
                handleFirestoreError(error, 'configuration de l\'écoute des événements');
            }
        }

        function displayEvents(events) {
            const eventsList = document.getElementById('events-list');
            eventsList.innerHTML = '';
            
            const fragment = document.createDocumentFragment();
            
            events.forEach(event => {
                const eventElement = createEventElement(event);
                fragment.appendChild(eventElement);
            });
            
            eventsList.appendChild(fragment);
        }

        function createEventElement(eventData) {
            const eventDiv = document.createElement('div');
            eventDiv.className = 'admin-notification';
            
            const eventTime = eventData.createdAt ? 
                eventData.createdAt.toDate().toLocaleString('fr-FR') : 
                'Date inconnue';
            
            eventDiv.innerHTML = `
                <div class="admin-notification-header">
                    <div class="admin-notification-title">
                        <i class="fas fa-bullhorn"></i>
                        ${eventData.title || 'Notification'}
                    </div>
                </div>
                <div class="admin-notification-content">
                    ${eventData.content || 'Contenu non disponible'}
                </div>
                <div class="admin-notification-footer">
                    ${eventTime}
                </div>
                ${isAdmin ? `
                    <div class="event-close-btn" onclick="deleteEvent('${eventData.id}')">
                        <i class="fas fa-times"></i>
                    </div>
                ` : ''}
            `;
            
            return eventDiv;
        }

        function updateLastViewedEventTimestamp() {
            lastViewedEventTimestamp = Math.floor(Date.now() / 1000);
            localStorage.setItem('parisAllianceLastViewedEvent', lastViewedEventTimestamp.toString());
        }

        function hideEventNotificationDot() {
            hasNewEvents = false;
            const dot = document.getElementById('events-notification-dot');
            if (dot) {
                dot.classList.remove('active');
            }
        }

        function showEventNotificationDot() {
            const dot = document.getElementById('events-notification-dot');
            if (dot) {
                dot.classList.add('active');
            }
        }

        async function deleteEvent(eventId) {
            if (!isAdmin) {
                showNotification('Seuls les administrateurs peuvent supprimer les événements', 'error');
                return;
            }
            
            try {
                await deleteDoc(doc(db, "Events", eventId));
                showNotification('Événement supprimé', 'success');
            } catch (error) {
                console.error('Erreur lors de la suppression de l\'événement:', error);
                showNotification('Erreur lors de la suppression de l\'événement', 'error');
            }
        }

        function showAdminNotificationDialog() {
            document.getElementById('admin-notif-dialog').classList.add('active');
            history.pushState({ page: 'admin-notification' }, '');
        }

        function hideAdminNotificationDialog() {
            document.getElementById('admin-notif-dialog').classList.remove('active');
        }

        async function sendAdminNotification() {
            const title = document.getElementById('notif-title').value.trim();
            const content = document.getElementById('notif-content').value.trim();
            const type = document.getElementById('notif-type').value;
            
            if (!title) {
                document.getElementById('notif-title-error').style.display = 'block';
                return;
            } else {
                document.getElementById('notif-title-error').style.display = 'none';
            }
            
            if (!content) {
                document.getElementById('notif-content-error').style.display = 'block';
                return;
            } else {
                document.getElementById('notif-content-error').style.display = 'none';
            }
            
            setButtonLoading('send-notification-btn', true);
            
            try {
                const eventData = {
                    title: title,
                    content: content,
                    type: type,
                    createdAt: serverTimestamp(),
                    from: currentUser.uid,
                    fromName: currentUserData?.displayName || 'Administrateur'
                };
                
                await addDoc(collection(db, "Events"), eventData);
                
                showNotification('Notification envoyée avec succès', 'success');
                hideAdminNotificationDialog();
                
                // Clear form
                document.getElementById('notif-title').value = '';
                document.getElementById('notif-content').value = '';
                document.getElementById('notif-type').value = 'info';
                
            } catch (error) {
                console.error('Erreur lors de l\'envoi de la notification:', error);
                showNotification('Erreur lors de l\'envoi de la notification', 'error');
            } finally {
                setButtonLoading('send-notification-btn', false);
            }
        }
        
        async function updateDisplayName() {
            if (!profileNameChanged) return;
            
            const displayName = document.getElementById('edit-display-name').value.trim();
            
            if (!displayName) {
                document.getElementById('edit-display-name-error').style.display = 'block';
                return;
            } else {
                document.getElementById('edit-display-name-error').style.display = 'none';
            }
            
            document.getElementById('save-display-name-btn').disabled = true;
            
            try {
                const userRef = doc(db, "Users", currentUser.uid);
                await updateDoc(userRef, {
                    displayName: displayName
                });
                
                currentUserData.displayName = displayName;
                
                updateProfileInfo();
                
                showNotification('Nom d\'utilisateur mis à jour', 'success');
                profileNameChanged = false;
            } catch (error) {
                handleFirestoreError(error, 'mise à jour du nom d\'utilisateur');
                showNotification('Erreur lors de la mise à jour du nom d\'utilisateur', 'error');
            } finally {
                document.getElementById('save-display-name-btn').disabled = false;
            }
        }
        
        async function updateProfileImage() {
            if (!profileImageFile) {
                showNotification('Aucune nouvelle image sélectionnée', 'info');
                return;
            }
            
            setButtonLoading('save-profile-image-btn', true);
            
            try {
                const userRef = doc(db, "Users", currentUser.uid);
                await updateDoc(userRef, {
                    photoURL: profileImageFile
                });
                
                currentUserData.photoURL = profileImageFile;
                
                updateProfileInfo();
                
                showNotification('Photo de profil mise à jour', 'success');
                profileImageFile = null;
                
                const imageButton = document.getElementById('save-profile-image-btn');
                imageButton.textContent = 'Image enregistrée';
                setTimeout(() => {
                    if (imageButton.querySelector('.btn-text')) {
                        imageButton.querySelector('.btn-text').textContent = 'Enregistrer la photo';
                    }
                }, 2000);
                
            } catch (error) {
                handleFirestoreError(error, 'mise à jour de la photo de profil');
                showNotification('Erreur lors de la mise à jour de la photo de profil', 'error');
            } finally {
                setButtonLoading('save-profile-image-btn', false);
            }
        }
        
        function handleProfileImageSelect(e) {
            const file = e.target.files[0];
            if (!file || !file.type.match('image.*')) {
                showNotification('Veuillez sélectionner une image valide', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showNotification('L\'image est trop volumineuse (max 5 Mo)', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const imagePreview = document.getElementById('profile-image-preview');
                imagePreview.innerHTML = `<img src="${e.target.result}" alt="Aperçu">`;
                profileImageFile = e.target.result;
                
                document.getElementById('save-profile-image-btn').disabled = false;
                showNotification('Image sélectionnée, cliquez sur "Enregistrer" pour confirmer', 'info');
            };
            reader.readAsDataURL(file);
        }
        
        function showProfileEditDialog() {
            const dialog = document.getElementById('profile-edit-dialog');
            const nameInput = document.getElementById('edit-display-name');
            const imagePreview = document.getElementById('profile-image-preview');
            
            nameInput.value = currentUserData?.displayName || '';
            
            if (currentUserData?.photoURL) {
                imagePreview.innerHTML = `<img src="${currentUserData.photoURL}" alt="Photo de profil">`;
            } else {
                imagePreview.innerHTML = `<i class="fas fa-user"></i>`;
            }
            
            profileImageFile = null;
            profileNameChanged = false;
            
            document.getElementById('save-display-name-btn').disabled = true;
            document.getElementById('save-profile-image-btn').disabled = true;
            
            dialog.classList.add('active');
            history.pushState({ page: 'profile-edit' }, '');
        }
        
        function hideProfileEditDialog() {
            document.getElementById('profile-edit-dialog').classList.remove('active');
        }
        
        function showLogoutConfirmation() {
            document.getElementById('logout-confirmation').classList.add('active');
            document.getElementById('overlay').classList.add('active');
            history.pushState({ page: 'logout-confirmation' }, '');
        }
        
        function hideLogoutConfirmation() {
            document.getElementById('logout-confirmation').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }
        
        function showDeleteAccountConfirmation() {
            document.getElementById('delete-account-confirmation').classList.add('active');
            document.getElementById('overlay').classList.add('active');
            history.pushState({ page: 'delete-account-confirmation' }, '');
        }
        
        function hideDeleteAccountConfirmation() {
            document.getElementById('delete-account-confirmation').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }
        
        async function deleteAccount() {
            hideDeleteAccountConfirmation();
            
            if (!currentUser) return;
            
            try {
                showNotification('Suppression du compte en cours...', 'info');
                
                const userRef = doc(db, "Users", currentUser.uid);
                await deleteDoc(userRef);
                
                await deleteUser(currentUser);
                
                showNotification('Compte supprimé avec succès', 'success');
                
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
                
            } catch (error) {
                console.error('Erreur lors de la suppression du compte:', error);
                
                let errorMessage = 'Erreur lors de la suppression du compte';
                
                if (error.code === 'auth/requires-recent-login') {
                    errorMessage = 'Veuillez vous reconnecter avant de supprimer votre compte';
                } else if (error.code === 'permission-denied') {
                    errorMessage = 'Permissions insuffisantes pour supprimer le compte';
                }
                
                showNotification(errorMessage, 'error');
            }
        }
        
        async function logoutUser() {
            hideLogoutConfirmation();
            
            try {
                if (eventsUnsubscribe) {
                    eventsUnsubscribe();
                    eventsUnsubscribe = null;
                }
                
                await signOut(auth);
                
                isLoggedIn = false;
                currentUser = null;
                currentUserData = null;
                isAdmin = false;
                
                showNotification('Déconnexion réussie', 'success');
                
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
                
            } catch (error) {
                console.error('Erreur lors de la déconnexion:', error);
                showNotification('Erreur lors de la déconnexion', 'error');
            }
        }
        
        function updateProfileInfo() {
            if (!currentUserData) return;
            
            const profilePic = document.querySelector('.profile-header .profile-pic');
            const profileNameText = document.getElementById('profile-name-text');
            const profileEmail = document.getElementById('profile-email');
            const adminBadge = document.getElementById('admin-badge');
            
            if (profilePic) {
                if (currentUserData.photoURL) {
                    profilePic.innerHTML = `
                        <img src="${currentUserData.photoURL}" alt="Photo de profil">
                        <div class="profile-pic-edit" id="edit-profile-pic">
                            <i class="fas fa-pencil-alt"></i>
                        </div>
                    `;
                } else {
                    profilePic.innerHTML = `
                        <i class="fas fa-user"></i>
                        <div class="profile-pic-edit" id="edit-profile-pic">
                            <i class="fas fa-pencil-alt"></i>
                        </div>
                    `;
                }
                
                const editBtn = profilePic.querySelector('.profile-pic-edit');
                if (editBtn) {
                    editBtn.addEventListener('click', showProfileEditDialog);
                }
            }
            
            if (profileNameText) {
                profileNameText.textContent = currentUserData.displayName || 'Utilisateur';
            }
            
            if (profileEmail) {
                profileEmail.textContent = currentUser.email || 'Non défini';
            }
            
            if (adminBadge) {
                if (isAdmin) {
                    adminBadge.style.display = 'inline-block';
                } else {
                    adminBadge.style.display = 'none';
                }
            }
        }

        async function loadUsers() {
            try {
                const usersRef = collection(db, "Users");
                const q = query(usersRef, orderBy("createdAt", "asc"));
                
                const snapshot = await getDocs(q);
                usersCache = {};
                const users = [];
                
                snapshot.forEach(doc => {
                    const userData = doc.data();
                    usersCache[doc.id] = userData;
                    users.push({
                        id: doc.id,
                        ...userData
                    });
                });
                
                // Déterminer qui est admin (compte le plus ancien)
                if (users.length > 0) {
                    const oldestUser = users[0];
                    if (oldestUser.id === currentUser.uid) {
                        isAdmin = true;
                        updateAdminStatus();
                    }
                }
                
            } catch (error) {
                handleFirestoreError(error, 'chargement des utilisateurs');
            }
        }
        
        function updateAdminStatus() {
            // Mettre à jour l'interface pour refléter le statut d'admin
            updateProfileInfo();
        }
        
        function setButtonLoading(buttonId, loading) {
            const button = document.getElementById(buttonId);
            if (!button) return;
            
            const loader = button.querySelector('.btn-loader');
            const text = button.querySelector('.btn-text');
            
            if (loading) {
                button.classList.add('loading');
                if (loader) loader.style.display = 'inline-block';
                button.disabled = true;
            } else {
                button.classList.remove('loading');
                if (loader) loader.style.display = 'none';
                button.disabled = false;
            }
        }

        // Make deleteEvent globally accessible
        window.deleteEvent = deleteEvent;
        
        // Initialize app
        function initApp() {
            addDebugLog('Initialisation de l\'application', 'info');
            
            setupDarkMode();
            setupTheme();
            setupConnectionMonitoring();
            setupUIEvents();
            
            // Load last viewed event timestamp
            const lastViewed = localStorage.getItem('parisAllianceLastViewedEvent');
            if (lastViewed) {
                lastViewedEventTimestamp = parseInt(lastViewed);
            }
            
            onAuthStateChanged(auth, async (user) => {
                document.getElementById('verify-animation').style.display = 'none';
                
                if (user) {
                    addDebugLog(`Utilisateur connecté: ${user.email}`, 'success');
                    
                    currentUser = user;
                    isLoggedIn = true;
                    
                    try {
                        const userRef = doc(db, "Users", user.uid);
                        const userDoc = await getDoc(userRef);
                        
                        if (userDoc.exists()) {
                            currentUserData = userDoc.data();
                        } else {
                            currentUserData = {
                                email: user.email,
                                displayName: user.displayName || 'Utilisateur',
                                photoURL: user.photoURL || null,
                                createdAt: serverTimestamp(),
                                satsBalance: 0,
                                currentPlan: 'free'
                            };
                            
                            await setDoc(userRef, currentUserData);
                        }
                        
                        updateProfileInfo();
                        await loadUsers(); // Charger les utilisateurs pour déterminer qui est admin
                        
                        document.getElementById('auth-screen').style.display = 'none';
                        document.getElementById('loading').style.display = 'none';
                        
                        showAIForecastsSection();
                        
                    } catch (error) {
                        addDebugLog(`Erreur lors de la récupération des données utilisateur: ${error.message}`, 'error');
                        showNotification('Erreur lors de la connexion', 'error');
                    }
                } else {
                    addDebugLog('Aucun utilisateur connecté', 'info');
                    
                    isLoggedIn = false;
                    currentUser = null;
                    currentUserData = null;
                    isAdmin = false;
                    
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('auth-screen').style.display = 'flex';
                }
            });
        }
        
        // Event listeners for auth
        document.getElementById('login-tab').addEventListener('click', function() {
            document.getElementById('register-tab').classList.remove('active');
            this.classList.add('active');
            document.getElementById('register-form').classList.remove('active');
            document.getElementById('login-form').classList.add('active');
        });
        
        document.getElementById('register-tab').addEventListener('click', function() {
            document.getElementById('login-tab').classList.remove('active');
            this.classList.add('active');
            document.getElementById('login-form').classList.remove('active');
            document.getElementById('register-form').classList.add('active');
        });
        
        document.getElementById('goto-register').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('register-tab').click();
        });
        
        document.getElementById('goto-login').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('login-tab').click();
        });
        
        document.getElementById('loginBtn').addEventListener('click', async function() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            let hasError = false;
            
            if (!email || !email.includes('@')) {
                document.getElementById('login-email-error').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('login-email-error').style.display = 'none';
            }
            
            if (!password) {
                document.getElementById('login-password-error').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('login-password-error').style.display = 'none';
            }
            
            if (hasError) return;
            
            setButtonLoading('loginBtn', true);
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                console.error('Erreur de connexion:', error);
                
                let errorMessage = 'Erreur de connexion';
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Aucun compte trouvé avec cet email';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Mot de passe incorrect';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email invalide';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Trop de tentatives. Réessayez plus tard';
                }
                
                const logElement = document.getElementById('login-log');
                logElement.textContent = errorMessage;
                logElement.className = 'log-message error';
                logElement.style.display = 'block';
            } finally {
                setButtonLoading('loginBtn', false);
            }
        });
        
        document.getElementById('registerBtn').addEventListener('click', async function() {
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            let hasError = false;
            
            if (!email || !email.includes('@')) {
                document.getElementById('register-email-error').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('register-email-error').style.display = 'none';
            }
            
            if (!password || password.length < 6) {
                document.getElementById('register-password-error').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('register-password-error').style.display = 'none';
            }
            
            if (password !== confirmPassword) {
                document.getElementById('register-confirm-password-error').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('register-confirm-password-error').style.display = 'none';
            }
            
            if (hasError) return;
            
            setButtonLoading('registerBtn', true);
            
            try {
                await createUserWithEmailAndPassword(auth, email, password);
            } catch (error) {
                console.error('Erreur d\'inscription:', error);
                
                let errorMessage = 'Erreur d\'inscription';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Cet email est déjà utilisé';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email invalide';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Mot de passe trop faible';
                }
                
                const logElement = document.getElementById('register-log');
                logElement.textContent = errorMessage;
                logElement.className = 'log-message error';
                logElement.style.display = 'block';
            } finally {
                setButtonLoading('registerBtn', false);
            }
        });
        
        // Initialize the app
        initApp();
    </script>
</body>
</html>
