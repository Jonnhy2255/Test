<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pari Alliance</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <style>
        :root {
            /* Thème par défaut (bleu) */
            --primary-color: #5D5CDE;
            --text-color: #000000;
            --bg-color: #ffffff;
            --border-color: #dddfe2;
            --secondary-color: #f0f2f5;
            --chat-sent-bg: #5D5CDE;
            --chat-sent-text: #ffffff;
            --chat-received-bg: #f0f2f5;
            --selection-color: rgba(93, 92, 222, 0.3);
            --action-menu-bg: rgba(0, 0, 0, 0.9);
            --action-menu-text: #ffffff;
            --highlight-color: #FFEB3B;
            --blocked-color: #ff6b6b;
            --reaction-bg: rgba(255, 255, 255, 0.9);
            --reaction-shadow: rgba(0, 0, 0, 0.1);
            --group-icon-bg: #4CAF50;
            --danger-color: #ff4842;
            --success-color: #4caf50;
            --input-bg: #f0f2f5;
            --input-placeholder: #8e8e93;
            --button-text: #000000;
            --inactive-text: #8e8e93;
            --link-color: #007aff;
            --admin-badge-bg: #5D5CDE;
            --admin-badge-text: white;
            --log-bg: rgba(0, 0, 0, 0.8);
            --log-text: #ffffff;
            --log-info: #2196F3;
            --log-warning: #FFC107;
            --log-error: #FF5252;
            --log-success: #4CAF50;
            --overlay-bg: rgba(0, 0, 0, 0.7);
            --event-bg: #f1f1f1;
            --event-border: #e0e0e0;
            --restricted-badge-bg: #FFC107;
            --restricted-badge-text: #000000;
            --side-menu-bg: #ffffff;
            --side-menu-active: #f0f2f5;
            --side-menu-hover: #f5f5f5;
            --log-panel-bg: #f8f9fa;
            --log-panel-border: #e0e0e0;
            --link-hover: #0056b3;
            --admin-notif-bg: #f8f9fa;
            --admin-notif-border: #e0e0e0;
            --forecast-win-bg: rgba(76, 175, 80, 0.2);
            --forecast-loss-bg: rgba(244, 67, 54, 0.2);
            --forecast-pending-bg: rgba(255, 193, 7, 0.2);
            --comment-bg: #f5f5f5;
            --comment-border: #ebebeb;
            --social-whatsapp: #25D366;
            --social-telegram: #0088cc;
            --social-youtube: #FF0000;
            --partner-google: #4285F4;
            --partner-firebase: #FFCA28;
            --partner-github: #333333;
            --partner-quora: #B92B27;
            --notification-dot: #FF4842;
            --warning-bg: rgba(255, 152, 0, 0.1);
            --warning-text: #FF9800;
            --image-message-bg: rgba(93, 92, 222, 0.1);
            --image-viewer-bg: rgba(0, 0, 0, 0.9);
            --selected-message-border: rgba(93, 92, 222, 0.7);
            --date-separator-bg: rgba(0, 0, 0, 0.05);
            --date-separator-text: var(--inactive-text);
            --reply-preview-bg: rgba(93, 92, 222, 0.1);
            --reply-preview-border: var(--primary-color);
            --reply-preview-text: var(--text-color);
            --deleted-message-bg: rgba(0, 0, 0, 0.05);
            --deleted-message-text: #888888;
            --action-bar-bg: var(--bg-color);
            --action-bar-text: var(--text-color);
            --action-bar-border: var(--border-color);
            --reply-quote-bg: rgba(93, 92, 222, 0.15);
            --reply-quote-border: var(--primary-color);
            --group-info-bg: var(--bg-color);
            --group-info-border: var(--border-color);
            --download-btn-bg: var(--primary-color);
            --download-btn-text: white;
            --new-badge-bg: var(--primary-color);
            --new-badge-text: white;
            --theme-selector-border: #ddd;
            --user-item-bg: var(--bg-color);
            --unread-badge-bg: #FF4842;
            --unread-badge-text: white;
            --sats-color: #F7931A;
            --plan-active-bg: rgba(93, 92, 222, 0.1);
            --plan-active-border: var(--primary-color);
        }
        
        /* Thème vert */
        .theme-green {
            --primary-color: #4CAF50;
            --chat-sent-bg: #4CAF50;
            --selection-color: rgba(76, 175, 80, 0.3);
            --admin-badge-bg: #4CAF50;
            --reply-preview-bg: rgba(76, 175, 80, 0.1);
            --reply-preview-border: #4CAF50;
            --reply-quote-bg: rgba(76, 175, 80, 0.15);
            --reply-quote-border: #4CAF50;
            --download-btn-bg: #4CAF50;
            --new-badge-bg: #4CAF50;
            --image-message-bg: rgba(76, 175, 80, 0.1);
            --selected-message-border: rgba(76, 175, 80, 0.7);
        }
        
        /* Thème rouge */
        .theme-red {
            --primary-color: #F44336;
            --chat-sent-bg: #F44336;
            --selection-color: rgba(244, 67, 54, 0.3);
            --admin-badge-bg: #F44336;
            --reply-preview-bg: rgba(244, 67, 54, 0.1);
            --reply-preview-border: #F44336;
            --reply-quote-bg: rgba(244, 67, 54, 0.15);
            --reply-quote-border: #F44336;
            --download-btn-bg: #F44336;
            --new-badge-bg: #F44336;
            --image-message-bg: rgba(244, 67, 54, 0.1);
            --selected-message-border: rgba(244, 67, 54, 0.7);
        }
        
        /* Thème orange */
        .theme-orange {
            --primary-color: #FF9800;
            --chat-sent-bg: #FF9800;
            --selection-color: rgba(255, 152, 0, 0.3);
            --admin-badge-bg: #FF9800;
            --reply-preview-bg: rgba(255, 152, 0, 0.1);
            --reply-preview-border: #FF9800;
            --reply-quote-bg: rgba(255, 152, 0, 0.15);
            --reply-quote-border: #FF9800;
            --download-btn-bg: #FF9800;
            --new-badge-bg: #FF9800;
            --image-message-bg: rgba(255, 152, 0, 0.1);
            --selected-message-border: rgba(255, 152, 0, 0.7);
        }

        /* Nouveau thème rouge-rose */
        .theme-red-pink {
            --primary-color: #E91E63;
            --chat-sent-bg: linear-gradient(135deg, #F44336, #E91E63);
            --selection-color: rgba(233, 30, 99, 0.3);
            --admin-badge-bg: linear-gradient(135deg, #F44336, #E91E63);
            --reply-preview-bg: rgba(233, 30, 99, 0.1);
            --reply-preview-border: #E91E63;
            --reply-quote-bg: rgba(233, 30, 99, 0.15);
            --reply-quote-border: #E91E63;
            --download-btn-bg: linear-gradient(135deg, #F44336, #E91E63);
            --new-badge-bg: linear-gradient(135deg, #F44336, #E91E63);
            --image-message-bg: rgba(233, 30, 99, 0.1);
            --selected-message-border: rgba(233, 30, 99, 0.7);
        }

        /* Nouveau thème vert-jaune */
        .theme-green-yellow {
            --primary-color: #8BC34A;
            --chat-sent-bg: linear-gradient(135deg, #4CAF50, #CDDC39);
            --selection-color: rgba(139, 195, 74, 0.3);
            --admin-badge-bg: linear-gradient(135deg, #4CAF50, #CDDC39);
            --reply-preview-bg: rgba(139, 195, 74, 0.1);
            --reply-preview-border: #8BC34A;
            --reply-quote-bg: rgba(139, 195, 74, 0.15);
            --reply-quote-border: #8BC34A;
            --download-btn-bg: linear-gradient(135deg, #4CAF50, #CDDC39);
            --new-badge-bg: linear-gradient(135deg, #4CAF50, #CDDC39);
            --image-message-bg: rgba(139, 195, 74, 0.1);
            --selected-message-border: rgba(139, 195, 74, 0.7);
        }

        /* Nouveau thème bleu-violet */
        .theme-blue-purple {
            --primary-color: #673AB7;
            --chat-sent-bg: linear-gradient(135deg, #2196F3, #9C27B0);
            --selection-color: rgba(103, 58, 183, 0.3);
            --admin-badge-bg: linear-gradient(135deg, #2196F3, #9C27B0);
            --reply-preview-bg: rgba(103, 58, 183, 0.1);
            --reply-preview-border: #673AB7;
            --reply-quote-bg: rgba(103, 58, 183, 0.15);
            --reply-quote-border: #673AB7;
            --download-btn-bg: linear-gradient(135deg, #2196F3, #9C27B0);
            --new-badge-bg: linear-gradient(135deg, #2196F3, #9C27B0);
            --image-message-bg: rgba(103, 58, 183, 0.1);
            --selected-message-border: rgba(103, 58, 183, 0.7);
        }

        /* Nouveau thème orange-doré */
        .theme-orange-gold {
            --primary-color: #FF8F00;
            --chat-sent-bg: linear-gradient(135deg, #FF9800, #FFC107);
            --selection-color: rgba(255, 143, 0, 0.3);
            --admin-badge-bg: linear-gradient(135deg, #FF9800, #FFC107);
            --reply-preview-bg: rgba(255, 143, 0, 0.1);
            --reply-preview-border: #FF8F00;
            --reply-quote-bg: rgba(255, 143, 0, 0.15);
            --reply-quote-border: #FF8F00;
            --download-btn-bg: linear-gradient(135deg, #FF9800, #FFC107);
            --new-badge-bg: linear-gradient(135deg, #FF9800, #FFC107);
            --image-message-bg: rgba(255, 143, 0, 0.1);
            --selected-message-border: rgba(255, 143, 0, 0.7);
        }
        
        .dark {
            --bg-color: #181818;
            --text-color: #ffffff;
            --border-color: #3e4042;
            --secondary-color: #2c2c2c;
            --chat-received-bg: #2c2c2c;
            --chat-sent-text: #ffffff;
            --selection-color: rgba(93, 92, 222, 0.4);
            --action-menu-bg: rgba(60, 60, 60, 0.95);
            --highlight-color: #FFEB3B;
            --blocked-color: #ff6b6b;
            --reaction-bg: rgba(40, 40, 40, 0.9);
            --reaction-shadow: rgba(0, 0, 0, 0.3);
            --group-icon-bg: #388E3C;
            --danger-color: #ff6b6b;
            --success-color: #66bb6a;
            --input-bg: #2c2c2c;
            --input-placeholder: #6c6c6c;
            --link-color: #2196F3;
            --admin-badge-text: white;
            --log-bg: rgba(20, 20, 20, 0.9);
            --log-info: #64B5F6;
            --log-warning: #FFD54F;
            --log-error: #FF8A80;
            --log-success: #81C784;
            --overlay-bg: rgba(0, 0, 0, 0.8);
            --event-bg: #2a2a2a;
            --event-border: #3e3e3e;
            --restricted-badge-bg: #FFC107;
            --restricted-badge-text: #000000;
            --side-menu-bg: #222222;
            --side-menu-active: #333333;
            --side-menu-hover: #2a2a2a;
            --log-panel-bg: #222222;
            --log-panel-border: #3e3e3e;
            --link-hover: #64B5F6;
            --admin-notif-bg: #2a2a2a;
            --admin-notif-border: #333333;
            --forecast-win-bg: rgba(76, 175, 80, 0.15);
            --forecast-loss-bg: rgba(244, 67, 54, 0.15);
            --forecast-pending-bg: rgba(255, 193, 7, 0.15);
            --comment-bg: #2a2a2a;
            --comment-border: #333333;
            --notification-dot: #FF4842;
            --warning-bg: rgba(255, 152, 0, 0.15);
            --warning-text: #FFA726;
            --image-message-bg: rgba(93, 92, 222, 0.15);
            --image-viewer-bg: rgba(0, 0, 0, 0.95);
            --selected-message-border: rgba(93, 92, 222, 0.8);
            --date-separator-bg: rgba(255, 255, 255, 0.1);
            --date-separator-text: #aaaaaa;
            --reply-preview-bg: rgba(93, 92, 222, 0.15);
            --reply-preview-text: var(--text-color);
            --deleted-message-bg: rgba(255, 255, 255, 0.05);
            --deleted-message-text: #888888;
            --action-bar-bg: #222222;
            --action-bar-text: #ffffff;
            --action-bar-border: #3e3e3e;
            --reply-quote-bg: rgba(93, 92, 222, 0.2);
            --group-info-bg: #222222;
            --group-info-border: #3e3e3e;
            --download-btn-text: white;
            --theme-selector-border: #444;
            --user-item-bg: #222222;
            --plan-active-bg: rgba(93, 92, 222, 0.15);
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-user-select: none;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            position: fixed;
            overflow: hidden;
            font-weight: 500;
            letter-spacing: -0.2px;
        }
        
        .side-menu {
            position: fixed;
            top: 0;
            left: -250px;
            height: 100%;
            width: 250px;
            background-color: var(--side-menu-bg);
            z-index: 1000;
            transition: left 0.3s ease;
            box-shadow: 2px 0 10px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
        }
        
        .side-menu.active {
            left: 0;
        }
        
        .side-menu-header {
            display: flex;
            align-items: center;
            padding: 20px 15px;
            border-bottom: none;
        }
        
        .side-menu-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
            margin-left: 15px;
        }
        
        .side-menu-close {
            font-size: 20px;
            color: var(--text-color);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
        }
        
        .side-menu-content {
            flex: 1;
            overflow-y: auto;
        }
        
        .side-menu-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        
        .side-menu-item.active {
            background-color: var(--side-menu-active);
        }
        
        .side-menu-item i {
            font-size: 20px;
            width: 30px;
            color: var(--primary-color);
        }
        
        .side-menu-text {
            margin-left: 15px;
            font-weight: 500;
        }
        
        .side-menu-footer {
            margin-top: auto;
        }
        
        .side-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        
        .side-menu-overlay.active {
            display: block;
        }
        
        .header {
            background-color: var(--bg-color);
            border-bottom: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            z-index: 10;
            transition: all 0.3s ease;
        }
        
        .header.search-active {
            height: 50px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            transition: opacity 0.3s ease;
        }
        
        .header-title {
            font-weight: bold;
            font-size: 18px;
            color: var(--primary-color);
            border-bottom: none;
            text-decoration: none;
            transition: opacity 0.3s ease;
            flex: 1;
        }
        
        #header-action {
            display: flex;
            align-items: center;
            gap: 15px;
            transition: opacity 0.3s ease;
        }
        
        .menu-button, .back-button, .search-button, .events-button, .info-button, .select-button {
            padding: 8px;
            cursor: pointer;
            font-size: 18px;
            color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }
        
        .menu-button:active, .back-button:active, .search-button:active, .events-button:active, .info-button:active, .select-button:active {
            background-color: var(--secondary-color);
        }
        
        .notification-dot {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 8px;
            height: 8px;
            background-color: var(--notification-dot);
            border-radius: 50%;
            display: none;
        }
        
        .notification-dot.active {
            display: block;
        }
        
        .events-button {
            position: relative;
        }
        
        .search-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            background-color: var(--bg-color);
            display: flex;
            align-items: center;
            padding: 0 15px;
            opacity: 0;
            pointer-events: none;
            transform: translateY(-5px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            z-index: 20;
        }
        
        .search-container.active {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
        }
        
        .search-input {
            flex: 1;
            padding: 10px 15px;
            border-radius: 18px;
            border: none;
            background-color: var(--secondary-color);
            font-size: 16px;
            color: var(--text-color);
            outline: none;
            margin-right: 10px;
            transition: background-color 0.2s ease;
        }
        
        .search-close {
            padding: 8px;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }
        
        .search-close:active {
            background-color: var(--secondary-color);
        }
        
        .header.search-active .header-left,
        .header.search-active .header-title,
        .header.search-active #header-action {
            opacity: 0;
            pointer-events: none;
        }

        /* Debug log panel */
        .debug-log-panel {
            position: fixed;
            bottom: 80px;
            left: 10px;
            right: 10px;
            max-height: 200px;
            background-color: var(--log-panel-bg);
            border: 1px solid var(--log-panel-border);
            border-radius: 8px;
            z-index: 1001;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .debug-log-panel.active {
            display: flex;
        }

        .debug-log-header {
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .debug-log-close {
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 3px;
            transition: background-color 0.2s ease;
        }

        .debug-log-close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .debug-log-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }

        .debug-log-item {
            margin-bottom: 8px;
            padding: 6px 8px;
            border-radius: 4px;
            border-left: 3px solid;
        }

        .debug-log-item.error {
            background-color: rgba(244, 67, 54, 0.1);
            border-left-color: var(--log-error);
            color: var(--log-error);
        }

        .debug-log-item.warning {
            background-color: rgba(255, 193, 7, 0.1);
            border-left-color: var(--log-warning);
            color: var(--log-warning);
        }

        .debug-log-item.info {
            background-color: rgba(33, 150, 243, 0.1);
            border-left-color: var(--log-info);
            color: var(--log-info);
        }

        .debug-log-item.success {
            background-color: rgba(76, 175, 80, 0.1);
            border-left-color: var(--log-success);
            color: var(--log-success);
        }

        .debug-log-timestamp {
            font-size: 10px;
            opacity: 0.7;
            margin-right: 5px;
        }

        .debug-log-link {
            color: var(--link-color);
            text-decoration: underline;
            cursor: pointer;
            word-break: break-all;
        }

        .debug-log-link:hover {
            color: var(--link-hover);
        }

        .debug-toggle-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--log-error);
            color: white;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1002;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: transform 0.2s ease;
        }

        .debug-toggle-btn.active {
            display: flex;
        }

        .debug-toggle-btn:hover {
            transform: scale(1.1);
        }
        
        /* Selection mode styles */
        .selection-toolbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 50px;
            background-color: var(--action-bar-bg);
            display: flex;
            align-items: center;
            padding: 0 15px;
            z-index: 25;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
            border-bottom: 1px solid var(--border-color);
        }
        
        .selection-toolbar.active {
            transform: translateY(0);
        }
        
        .selection-info {
            flex: 1;
            font-weight: bold;
            color: var(--text-color);
        }
        
        .selection-actions {
            display: flex;
            gap: 15px;
        }
        
        .selection-btn {
            padding: 8px;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 18px;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }
        
        .selection-btn.delete {
            color: var(--danger-color);
        }
        
        .selection-btn:active {
            background-color: var(--secondary-color);
        }
        
        .content {
            position: fixed;
            top: 50px;
            bottom: 60px;
            left: 0;
            right: 0;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            background-color: var(--bg-color);
            transition: top 0.3s ease;
        }
        
        .content.selection-mode {
            top: 100px;
        }
        
        .content.no-bottom-nav {
            bottom: 0;
        }
        
        .bottom-nav {
            background-color: var(--bg-color);
            border-top: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            z-index: 10;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            color: var(--inactive-text);
            font-size: 10px;
            cursor: pointer;
            height: 100%;
            padding: 8px 0;
            position: relative;
        }
        
        .nav-item.active {
            color: var(--primary-color);
        }
        
        .nav-icon {
            font-size: 22px;
            margin-bottom: 4px;
        }
        
        .section {
            padding: 10px 0;
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .profile-pic {
            width: 50px;
            height: 50px;
            background-color: var(--secondary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .profile-pic img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }
        
        .profile-pic-edit {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: var(--primary-color);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            transition: transform 0.2s ease;
        }
        
        .profile-pic-edit:hover, .profile-pic-edit:active {
            transform: scale(1.1);
        }
        
        .group-pic {
            width: 50px;
            height: 50px;
            background-color: var(--group-icon-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .group-pic img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }
        
        .group-pic-edit {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: var(--primary-color);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            cursor: pointer;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
            transition: transform 0.2s ease;
            z-index: 2;
        }
        
        .group-pic-edit:hover, .group-pic-edit:active {
            transform: scale(1.1);
        }
        
        .chat-item, .user-item, .event-item {
            display: flex;
            padding: 12px 16px;
            border-bottom: none;
            align-items: center;
            cursor: pointer;
            position: relative;
            transition: transform 0.3s ease, opacity 0.4s ease;
        }
        
        .chat-item.selected, .user-item.selected {
            background-color: var(--selection-color);
        }
        
        .item-content {
            flex: 1;
        }
        
        .item-title {
            font-weight: bold;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
        }
        
        .item-subtitle {
            color: #6b7280;
            font-size: 14px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .item-time {
            color: #6b7280;
            font-size: 12px;
        }
        
        .item-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }
        
        .admin-badge {
            display: inline-block;
            background-color: var(--admin-badge-bg);
            color: var(--admin-badge-text);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 6px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .restricted-badge {
            display: inline-block;
            background-color: var(--restricted-badge-bg);
            color: var(--restricted-badge-text);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 6px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .new-badge {
            display: inline-block;
            background-color: var(--new-badge-bg);
            color: var(--new-badge-text);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 6px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .unread-badge {
            display: inline-block;
            background-color: var(--unread-badge-bg);
            color: var(--unread-badge-text);
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 50%;
            font-weight: bold;
            min-width: 20px;
            text-align: center;
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 999;
        }
        
        .loading-spinner {
            font-size: 60px;
            color: var(--primary-color);
            animation: pulse 2s infinite, bounce 1.5s infinite;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }
        
        .settings-container {
            padding: 15px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: none;
            cursor: pointer;
        }
        
        .setting-icon {
            width: 36px;
            height: 36px;
            background-color: var(--secondary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            flex: 1;
        }
        
        .setting-label {
            font-weight: 500;
        }
        
        .button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            margin-top: 20px;
            cursor: pointer;
            transition: transform 0.15s ease, opacity 0.2s ease, background-color 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .button:active {
            transform: scale(0.98);
            opacity: 0.9;
        }
        
        .button:hover {
            background-color: #4a49c0;
        }

        .button:disabled {
            background-color: var(--border-color);
            color: var(--inactive-text);
            cursor: not-allowed;
        }
        
        .button.danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .button.danger:hover {
            background-color: #e53935;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        .chat-section {
            display: none;
            position: fixed;
            top: 50px;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--bg-color);
            z-index: 5;
            transition: top 0.3s ease;
        }
        
        .chat-section.selection-mode {
            top: 100px;
        }
        
        .chat-messages-container {
            position: absolute;
            top: 0;
            bottom: 60px;
            left: 0;
            right: 0;
            overflow-y: auto;
            background-color: var(--secondary-color);
            -webkit-overflow-scrolling: touch;
            padding: 15px;
        }
        
        .chat-messages {
            width: 100%;
            display: flex;
            flex-direction: column;
            min-height: 100%;
            justify-content: flex-end;
        }
        
        .chat-input-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            padding: 10px;
            background-color: var(--bg-color);
            border-top: none;
            align-items: flex-end;
            min-height: 60px;
            max-height: 150px;
            transition: min-height 0.2s ease;
        }
        
        .message-container {
            margin-bottom: 16px;
            clear: both;
            display: flex;
            flex-direction: column;
            max-width: 85%;
            position: relative;
        }
        
        .message-container.sent {
            float: right;
            margin-left: auto;
            align-items: flex-end;
        }
        
        .message-container.received {
            float: left;
            margin-right: auto;
            align-items: flex-start;
        }
        
        .message-container.selectable {
            cursor: pointer;
        }
        
        .message-container.selected::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -10px;
            right: -10px;
            bottom: -5px;
            background-color: var(--selection-color);
            border-radius: 15px;
            z-index: -1;
        }
        
        .message-container.selected .message-checkbox {
            display: block;
        }
        
        .message-checkbox {
            position: absolute;
            top: 5px;
            left: -25px;
            width: 16px;
            height: 16px;
            background-color: var(--primary-color);
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
            z-index: 10;
        }
        
        .message-container.sent .message-checkbox {
            left: auto;
            right: -25px;
        }
        
        .message-sender {
            font-size: 12px;
            margin-bottom: 2px;
            font-weight: bold;
            color: var(--text-color);
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .message {
            padding: 10px 14px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
            transition: background-color 0.2s ease, transform 0.3s ease;
            transform: translateX(0);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            font-weight: 500;
        }
        
        .message-received {
            background-color: var(--chat-received-bg);
            border-bottom-left-radius: 4px;
        }
        
        .message-sent {
            background: var(--chat-sent-bg);
            color: var(--chat-sent-text);
            border-bottom-right-radius: 4px;
        }
        
        .message.deleted {
            background-color: var(--deleted-message-bg);
            color: var(--deleted-message-text);
            font-style: italic;
        }
        
        .message-time {
            font-size: 10px;
            margin-top: 2px;
            opacity: 0.7;
        }
        
        .chat-input-wrapper {
            flex: 1;
            margin: 0 10px;
            position: relative;
        }
        
        .chat-input {
            width: 100%;
            padding: 10px 16px;
            border-radius: 20px;
            border: none;
            background-color: var(--secondary-color);
            font-size: 16px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            color: var(--text-color);
            font-weight: 400;
            outline: none;
            min-height: 40px;
            max-height: 100px;
            overflow-y: auto;
            line-height: 1.4;
            -webkit-user-select: text;
            user-select: text;
            vertical-align: middle;
            resize: none;
            transition: height 0.2s ease;
        }
        
        .send-button {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: transform 0.15s ease, background-color 0.2s ease;
        }
        
        .send-button:active {
            transform: scale(0.9);
        }
        
        .send-button:hover {
            background-color: #4a49c0;
        }

        .send-button:disabled {
            background-color: var(--border-color);
            color: var(--inactive-text);
            cursor: not-allowed;
        }
        
        .image-button {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            margin-right: 10px;
            transition: transform 0.15s ease, background-color 0.2s ease;
        }
        
        .image-button:active {
            transform: scale(0.9);
        }

        .image-button:disabled {
            color: var(--inactive-text);
            cursor: not-allowed;
        }
        
        .profile-header {
            display: flex;
            align-items: flex-start;
            padding: 20px;
            border-bottom: none;
        }
        
        .profile-header .profile-pic {
            width: 80px;
            height: 80px;
            margin-right: 20px;
        }
        
        .profile-header .profile-pic i {
            font-size: 30px;
            color: var(--primary-color);
        }
        
        .profile-info {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        
        .profile-name {
            font-weight: bold;
            font-size: 20px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }
        
        .profile-email {
            color: #6b7280;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .profile-status {
            color: #6b7280;
        }
        
        .profile-edit {
            color: var(--primary-color);
            font-size: 14px;
            margin-top: 5px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 8px;
            border-radius: 15px;
        }
        
        .auth-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }
        
        .auth-header {
            padding: 40px 0 20px;
            text-align: center;
        }
        
        .auth-logo {
            font-size: 50px;
            color: var(--primary-color);
            margin-bottom: 15px;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .auth-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .auth-subtitle {
            font-size: 16px;
            color: var(--text-color);
            opacity: 0.8;
            margin-bottom: 20px;
            padding: 0 20px;
            text-align: center;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: none;
        }
        
        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 15px 0;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            color: var(--inactive-text);
            transition: color 0.3s, background-color 0.2s ease;
            text-decoration: none;
            border-bottom: none;
        }
        
        .auth-tab.active {
            color: var(--primary-color);
        }
        
        .auth-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 25%;
            width: 50%;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 3px 3px 0 0;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: scaleX(0); }
            to { transform: scaleX(1); }
        }
        
        .auth-form {
            padding: 20px;
            display: none;
            animation: fadeUp 0.5s ease;
        }
        
        @keyframes fadeUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }
        
        .form-input {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg);
            font-size: 16px;
            color: var(--text-color);
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            outline: none;
        }
        
        .form-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(93, 92, 222, 0.25);
        }
        
        .form-input::placeholder {
            color: var(--input-placeholder);
        }
        
        .form-error {
            color: var(--danger-color);
            font-size: 13px;
            margin-top: 6px;
            display: none;
            animation: shakeX 0.75s ease;
        }
        
        @keyframes shakeX {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
            20%, 40%, 60%, 80% { transform: translateX(4px); }
        }
        
        .form-footer {
            margin-top: 30px;
            text-align: center;
        }
        
        .form-footer-text {
            margin-top: 15px;
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
        }
        
        .form-link {
            color: var(--link-color);
            text-decoration: none;
            font-weight: bold;
            transition: color 0.2s;
        }
        
        .form-link:hover {
            text-decoration: underline;
        }

        .log-message {
            margin-top: 15px;
            padding: 12px;
            font-weight: bold;
            border-radius: 6px;
            white-space: pre-line;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }
          
        .log-message.info {
            background: #d1ecf1;
            color: #0c5460;
        }
          
        .log-message.success {
            background: #d4edda;
            color: #155724;
        }
          
        .log-message.error {
            background: #f8d7da;
            color: #721c24;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--inactive-text);
        }

        .empty-state i {
            font-size: 50px;
            margin-bottom: 15px;
            color: var(--border-color);
        }

        .empty-state-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .empty-state-text {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .btn-loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 8px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .button.loading {
            pointer-events: none;
            opacity: 0.8;
        }
        
        .button.loading .btn-text {
            visibility: hidden;
        }
        
        .button.loading .btn-loader {
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -10px;
            margin-left: -10px;
            visibility: visible;
        }
        
        .notification {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            opacity: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 12px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            font-weight: 500;
            z-index: 1000;
            max-width: 90%;
            text-align: center;
            line-height: 1.4;
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
            pointer-events: auto;
        }

        .notification.success {
            background-color: var(--bg-color);
            color: var(--success-color);
        }

        .notification.error {
            background-color: var(--bg-color);
            color: var(--danger-color);
        }

        .notification.info {
            background-color: var(--bg-color);
            color: var(--primary-color);
        }
        
        .verify-animation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .football-bounce {
            font-size: 80px;
            color: var(--primary-color);
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-40px); }
            60% { transform: translateY(-20px); }
        }

        .verify-text {
            margin-top: 30px;
            font-size: 16px;
            color: var(--text-color);
            opacity: 0.8;
            text-align: center;
        }
        
        @keyframes deleteMessage {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            20% {
                opacity: 0.8;
                transform: scale(0.95);
            }
            100% {
                opacity: 0;
                transform: scale(0.5);
                height: 0;
                margin: 0;
                padding: 0;
            }
        }
        
        .message.deleting {
            animation: deleteMessage 0.3s ease forwards;
            pointer-events: none;
        }
        
        .create-group-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 100;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .create-group-dialog.active {
            display: flex;
        }
        
        .create-group-header {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: none;
        }
        
        .create-group-title {
            flex: 1;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            text-decoration: none;
            border-bottom: none;
        }
        
        .create-group-back {
            color: var(--primary-color);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
        }
        
        .create-group-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .group-form {
            display: flex;
            flex-direction: column;
        }
        
        .edit-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .edit-dialog.active {
            display: flex;
        }
        
        .edit-header {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: none;
        }
        
        .edit-title {
            flex: 1;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            text-decoration: none;
            border-bottom: none;
        }
        
        .edit-back {
            color: var(--primary-color);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
        }
        
        .edit-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .group-image-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: var(--group-icon-bg);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        
        .group-image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }
        
        .group-image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s ease;
            cursor: pointer;
        }
        
        .group-image-preview:hover .group-image-overlay {
            opacity: 1;
        }
        
        .group-image-overlay i {
            color: white;
            font-size: 20px;
        }
        
        .image-upload-btn {
            background-color: var(--secondary-color);
            color: var(--text-color);
            border: 1px dashed var(--border-color);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .fab {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 50;
            cursor: pointer;
            transition: transform 0.2s ease, background-color 0.2s ease;
        }
        
        .fab:active {
            transform: scale(0.95);
        }
        
        .fab:hover {
            background-color: #4a49c0;
        }

        .fab.disabled {
            background-color: var(--border-color);
            color: var(--inactive-text);
            cursor: not-allowed;
            box-shadow: none;
        }

        .fab.disabled:active {
            transform: none;
        }
        
        .fab i {
            font-size: 24px;
        }
        
        .confirmation-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--bg-color);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            width: 85%;
            max-width: 300px;
            padding: 20px;
            z-index: 150;
            display: none;
        }
        
        .confirmation-dialog.active {
            display: block;
        }
        
        .confirmation-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .confirmation-text {
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.4;
        }
        
        .confirmation-buttons {
            display: flex;
            justify-content: space-between;
        }
        
        .confirmation-button {
            padding: 10px 15px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            min-width: 100px;
            text-align: center;
        }
        
        .confirmation-cancel {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }
        
        .confirmation-confirm {
            background-color: var(--primary-color);
            color: white;
        }
        
        .confirmation-delete {
            background-color: var(--danger-color);
            color: white;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 90;
            display: none;
        }
        
        .overlay.active {
            display: block;
        }

        .event-icon {
            width: 50px;
            height: 50px;
            background-color: var(--event-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            border: 1px solid var(--event-border);
        }
        
        .event-icon i {
            font-size: 22px;
            color: var(--primary-color);
        }

        .event-item {
            transition: none;
            cursor: default;
            position: relative;
        }

        .event-header {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .event-content {
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
        }

        .event-time {
            font-size: 12px;
            color: var(--inactive-text);
            margin-top: 5px;
        }
        
        .admin-count-badge {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: bold;
            margin-left: 6px;
        }

        .event-item.group-create .event-icon {
            background-color: rgba(76, 175, 80, 0.2);
        }
        
        .event-item.group-create .event-icon i {
            color: var(--success-color);
        }
        
        .event-item.permission-change .event-icon {
            background-color: rgba(255, 193, 7, 0.2);
        }
        
        .event-item.permission-change .event-icon i {
            color: var(--restricted-badge-bg);
        }
        
        .event-item.user-join .event-icon {
            background-color: rgba(33, 150, 243, 0.2);
        }
        
        .event-item.user-join .event-icon i {
            color: var(--log-info);
        }

        .restricted-message {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            background-color: rgba(255, 193, 7, 0.1);
            border-radius: 10px;
            font-size: 14px;
            color: var(--text-color);
        }
        
        .profile-edit-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .profile-edit-dialog.active {
            display: flex;
        }
        
        .profile-image-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .profile-image-preview {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-bottom: 10px;
            position: relative;
        }
        
        .profile-image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
        }
        
        .profile-image-preview i {
            font-size: 50px;
            color: var(--primary-color);
        }
        
        .profile-upload-btn {
            position: absolute;
            bottom: 10px;
            right: calc(50% - 60px);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.2s ease, background-color 0.2s ease;
        }
        
        .profile-upload-btn:hover, .profile-upload-btn:active {
            transform: scale(1.1);
            background-color: #4a49c0;
        }

        input[type="file"] {
            display: none;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .section-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            text-decoration: none;
            border-bottom: none;
            padding: 0 16px; 
            margin: 15px 0;
        }
        
        .field-error {
            color: var(--danger-color);
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }
        
        .save-field-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            margin-left: 10px;
            font-size: 12px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .save-field-btn:hover {
            background-color: #4a49c0;
        }
        
        .save-field-btn:disabled {
            background-color: var(--border-color);
            cursor: not-allowed;
        }
        
        .editable-field {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .editable-field-input {
            flex: 1;
        }
        
        .forecasts-section {
            padding: 0 0 15px 0;
        }
        
        .forecasts-tabs {
            display: flex;
            border-bottom: none;
            margin-bottom: 15px;
            background-color: var(--bg-color);
            position: sticky;
            top: 0;
            z-index: 5;
        }
        
        .forecast-tab {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            position: relative;
            color: var(--inactive-text);
            transition: color 0.3s, background-color 0.2s ease;
        }
        
        .forecast-tab.active {
            color: var(--primary-color);
        }
        
        .forecast-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 20%;
            width: 60%;
            height: 3px;
            background-color: var(--primary-color);
            border-radius: 3px 3px 0 0;
            animation: slideIn 0.3s ease;
        }
        
        .forecasts-content {
            display: none;
            padding: 0 15px;
        }
        
        .forecasts-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .forecasts-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .forecast-item {
            background-color: var(--secondary-color);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .forecast-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .forecast-match {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .forecast-team {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            flex: 1;
        }
        
        .forecast-team-logo {
            width: 40px;
            height: 40px;
            background-color: var(--bg-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
        }
        
        .forecast-team-name {
            font-weight: 500;
            text-align: center;
            font-size: 14px;
        }
        
        .forecast-score {
            font-size: 22px;
            font-weight: bold;
            padding: 0 15px;
            display: flex;
            align-items: center;
        }
        
        .forecast-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .forecast-status.pending {
            background-color: var(--forecast-pending-bg);
            color: var(--text-color);
        }
        
        .forecast-status.win {
            background-color: var(--forecast-win-bg);
            color: var(--text-color);
        }
        
        .forecast-status.loss {
            background-color: var(--forecast-loss-bg);
            color: var(--text-color);
        }
        
        .forecast-date {
            font-size: 12px;
            color: var(--inactive-text);
        }
        
        .forecast-confidence {
            display: flex;
            align-items: center;
            margin-top: 10px;
            font-size: 13px;
            color: var(--text-color);
        }
        
        .confidence-bar-container {
            flex: 1;
            height: 6px;
            background-color: var(--border-color);
            border-radius: 3px;
            margin: 0 10px;
            overflow: hidden;
        }
        
        .confidence-bar {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 3px;
        }
        
        .no-forecasts {
            text-align: center;
            padding: 30px 15px;
            color: var(--inactive-text);
        }
        
        .no-forecasts i {
            font-size: 40px;
            margin-bottom: 15px;
            color: var(--primary-color);
            opacity: 0.5;
        }

        .admin-notification {
            background-color: var(--bg-color);
            border-radius: 15px;
            margin: 10px 15px 20px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .admin-notification-header {
            color: var(--text-color);
            padding: 0 0 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: none;
            margin-bottom: 10px;
        }
        
        .admin-notification-title {
            display: flex;
            align-items: center;
        }
        
        .admin-notification-title i {
            margin-right: 8px;
            color: var(--primary-color);
        }
        
        .admin-notification-content {
            padding: 5px 0;
            line-height: 1.4;
        }
        
        .admin-notification-footer {
            padding: 5px 0 0;
            font-size: 12px;
            color: var(--inactive-text);
            text-align: right;
            border-top: none;
            margin-top: 10px;
            padding-top: 8px;
        }
        
        .event-close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .event-close-btn:hover, .event-close-btn:active {
            transform: scale(1.1);
        }
        
        .event-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 5px;
        }
        
        .event-action-btn {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            border: none;
            border-radius: 8px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: transform 0.1s ease;
        }
        
        .event-action-btn:hover, .event-action-btn:active {
            transform: translateY(-1px);
        }
        
        .event-action-btn.delete {
            color: var(--danger-color);
        }
        
        .admin-notif-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .admin-notif-dialog.active {
            display: flex;
        }
        
        .score-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .score-option {
            padding: 5px 12px;
            border-radius: 15px;
            background-color: var(--bg-color);
            font-weight: bold;
            font-size: 14px;
            border: 1px solid var(--border-color);
            transition: transform 0.1s ease;
            cursor: pointer;
        }
        
        .score-option:hover, .score-option:active {
            transform: translateY(-1px);
        }

        .score-option.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        #delete-account-confirmation .confirmation-text {
            color: var(--danger-color);
            font-weight: bold;
        }

        .social-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding: 0 15px;
            gap: 10px;
        }
        
        .social-button {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px 10px;
            border-radius: 10px;
            background-color: var(--secondary-color);
            text-align: center;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }
        
        .social-button:active {
            transform: scale(0.98);
        }
        
        .social-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .social-button.whatsapp {
            color: var(--social-whatsapp);
        }
        
        .social-button.telegram {
            color: var(--social-telegram);
        }
        
        .social-button.youtube {
            color: var(--social-youtube);
        }

        .about-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .about-dialog.active {
            display: flex;
        }
        
        .about-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .about-logo {
            text-align: center;
            margin: 20px 0;
        }
        
        .about-logo i {
            font-size: 60px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .about-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 10px;
        }
        
        .about-version {
            text-align: center;
            font-size: 14px;
            color: var(--inactive-text);
            margin-bottom: 30px;
        }
        
        .about-section {
            margin-bottom: 25px;
        }
        
        .about-section-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .about-section-content {
            line-height: 1.5;
            font-size: 14px;
        }
        
        .about-footer {
            text-align: center;
            padding: 20px 0;
            font-size: 12px;
            color: var(--inactive-text);
            border-top: none;
            margin-top: auto;
        }
        
        @media (max-height: 640px) {
            .fab {
                bottom: 70px;
            }
        }
        
        @media (max-width: 380px) {
            .confirmation-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .confirmation-button {
                width: 100%;
            }
        }
        
        .message-with-image {
            padding: 5px;
            border-radius: 18px;
            background-color: var(--image-message-bg);
            max-width: 100%;
        }
        
        .message-image {
            width: 100%;
            max-width: 250px;
            max-height: 250px;
            border-radius: 13px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: transform 0.2s ease;
            pointer-events: auto;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
            object-fit: contain;
        }
        
        .message-image:hover {
            transform: scale(0.98);
        }
        
        .message-text {
            padding: 0 10px 5px;
            word-break: break-word;
        }
        
        .image-viewer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--image-viewer-bg);
            z-index: 1000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }
        
        .image-viewer.active {
            display: flex;
        }
        
        .viewer-image-container {
            position: relative;
            max-width: 90%;
            max-height: 80vh;
            margin: 0 auto;
        }
        
        .viewer-image {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 5px;
            object-fit: contain;
            pointer-events: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .viewer-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .viewer-close:hover {
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        .terms-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .terms-dialog.active {
            display: flex;
        }
        
        .terms-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .terms-header {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: none;
        }
        
        .terms-title {
            flex: 1;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            text-decoration: none;
            border-bottom: none;
        }
        
        .terms-back {
            color: var(--primary-color);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
        }
        
        .warning-box {
            background-color: var(--warning-bg);
            border-left: 4px solid var(--warning-text);
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-weight: 500;
        }
        
        .warning-box i {
            color: var(--warning-text);
            margin-right: 10px;
        }
    
        #header-action {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .search-button, .events-button, .info-button {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }
        
        .search-button:active, .events-button:active, .info-button:active {
            background-color: var(--secondary-color);
        }
        
        /* Improved search bar animation */
        @keyframes searchBarIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes searchBarOut {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-5px);
            }
        }
        
        .search-container.active {
            animation: searchBarIn 0.3s ease forwards;
        }
        
        .search-container.hiding {
            animation: searchBarOut 0.3s ease forwards;
        }
        
        /* Touch ripple effect for buttons */
        .ripple {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }
        
        @keyframes ripple {
            to {
                transform: scale(2.5);
                opacity: 0;
            }
        }

        /* Date separators in messages */
        .date-separator {
            text-align: center;
            margin: 20px 0;
            position: relative;
            user-select: none;
        }

        .date-separator:before {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            top: 50%;
            height: 1px;
            background-color: var(--border-color);
            z-index: 1;
        }

        .date-separator-text {
            display: inline-block;
            position: relative;
            z-index: 2;
            background-color: var(--date-separator-bg);
            padding: 3px 10px;
            border-radius: 10px;
            font-size: 12px;
            color: var(--date-separator-text);
            font-weight: 500;
        }

        /* Reply system */
        .reply-preview {
            background-color: var(--reply-preview-bg);
            border-left: 3px solid var(--reply-preview-border);
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: 5px;
            font-size: 14px;
            position: relative;
            display: none;
        }

        .reply-preview.active {
            display: block;
        }

        .reply-preview-header {
            font-weight: bold;
            margin-bottom: 3px;
            color: var(--primary-color);
        }

        .reply-preview-content {
            color: var(--reply-preview-text);
            opacity: 0.9;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .reply-preview-close {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.1);
            color: var(--text-color);
            cursor: pointer;
            font-size: 10px;
        }

        .chat-input-wrapper.with-reply {
            display: flex;
            flex-direction: column;
        }

        /* Adaptations for reply mode */
        .chat-input-container.with-reply {
            min-height: 100px;
        }
        
        /* Expandable text input styling */
        .chat-input {
            resize: none;
            overflow-y: auto;
            transition: height 0.2s ease;
        }

        /* Improved message quote styling */
        .message-quote {
            margin-bottom: 8px;
            background-color: var(--reply-quote-bg);
            border-left: 3px solid var(--reply-quote-border);
            border-radius: 8px;
            padding: 8px 10px;
            font-size: 13px;
            position: relative;
        }
        
        .message-quote-sender {
            font-weight: bold;
            margin-bottom: 3px;
            color: var(--primary-color);
            font-size: 12px;
        }
        
        .message-quote-content {
            color: var(--text-color);
            opacity: 0.85;
            font-style: italic;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Group info dialog */
        .group-info-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--group-info-bg);
            z-index: 120;
            display: none;
            flex-direction: column;
            animation: fadeIn 0.3s ease;
        }
        
        .group-info-dialog.active {
            display: flex;
        }
        
        .group-info-header {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: none;
        }
        
        .group-info-title {
            flex: 1;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            text-decoration: none;
            border-bottom: none;
        }
        
        .group-info-back {
            color: var(--primary-color);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
        }
        
        .group-info-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .group-info-section {
            margin-bottom: 20px;
        }
        
        .group-info-section-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .group-info-detail {
            background-color: var(--secondary-color);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .group-info-label {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .group-info-value {
            color: var(--text-color);
            line-height: 1.4;
        }
        
        .group-info-images {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .group-info-image {
            width: 100%;
            padding-bottom: 100%;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .group-info-image img {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.2s ease;
        }
        
        .group-info-image:hover img {
            transform: scale(1.05);
        }
        
        .group-info-image-empty {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--border-color);
            opacity: 0.5;
            font-size: 14px;
            text-align: center;
            padding: 10px;
            height: 100%;
        }
        
        .download-button {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background-color: var(--download-btn-bg);
            color: var(--download-btn-text);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease;
        }
        
        .download-button:hover {
            transform: scale(1.1);
        }
        
        /* Ajout des styles pour la section des utilisateurs */
        #users-section {
            padding: 10px 0;
        }
        
        .users-list {
            display: flex;
            flex-direction: column;
        }
        
        .user-item {
            background-color: var(--user-item-bg);
            transition: background-color 0.2s ease;
        }
        
        .user-item:hover, .user-item:active {
            background-color: var(--selection-color);
        }
        
        .user-pic {
            width: 50px;
            height: 50px;
            background-color: var(--secondary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            overflow: hidden;
        }
        
        .user-pic i {
            font-size: 20px;
            color: var(--primary-color);
        }
        
        .user-pic img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* Interface Theme Selector */
        .theme-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 15px 0;
            justify-items: center;
        }
        
        .theme-option {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            cursor: pointer;
            position: relative;
            border: 2px solid var(--theme-selector-border);
            overflow: hidden;
            transition: transform 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .theme-option:hover {
            transform: scale(1.05);
        }
        
        .theme-option.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px var(--primary-color);
        }
        
        .theme-option.active:before {
            content: '\f00c';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            text-shadow: 0 0 3px rgba(0,0,0,0.5);
            z-index: 3;
        }
        
        .theme-option.theme-blue {
            background-color: #5D5CDE;
        }
        
        .theme-option.theme-green {
            background-color: #4CAF50;
        }
        
        .theme-option.theme-red {
            background-color: #F44336;
        }
        
        .theme-option.theme-orange {
            background-color: #FF9800;
        }

        .theme-option.theme-red-pink {
            background: linear-gradient(135deg, #F44336, #E91E63);
        }

        .theme-option.theme-green-yellow {
            background: linear-gradient(135deg, #4CAF50, #CDDC39);
        }

        .theme-option.theme-blue-purple {
            background: linear-gradient(135deg, #2196F3, #9C27B0);
        }

        .theme-option.theme-orange-gold {
            background: linear-gradient(135deg, #FF9800, #FFC107);
        }
        
        .theme-label {
            margin-top: 5px;
            font-size: 11px;
            text-align: center;
            font-weight: 500;
            line-height: 1.2;
        }
        
        .interface-section {
            background-color: var(--secondary-color);
            border-radius: 10px;
            padding: 15px;
            margin: 15px;
        }
        
        .interface-title {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 16px;
            color: var(--primary-color);
        }

        .discussion-type-badge {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 8px;
            margin-left: 6px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .discussion-type-badge.group {
            background-color: var(--success-color);
        }

        .discussion-type-badge.direct {
            background-color: #007aff;
        }

        /* Subscription Section Styles */
        .subscription-section {
            padding: 10px 0;
        }

        .current-plan {
            background-color: var(--plan-active-bg);
            border: 2px solid var(--plan-active-border);
            border-radius: 15px;
            padding: 20px;
            margin: 15px;
            text-align: center;
        }

        .current-plan-title {
            font-weight: bold;
            font-size: 18px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .current-plan-info {
            color: var(--text-color);
            margin-bottom: 15px;
        }

        .sats-balance {
            font-size: 24px;
            font-weight: bold;
            color: var(--sats-color);
            margin: 10px 0;
        }

        .sats-balance i {
            margin-right: 8px;
        }

        .plan-item {
            background-color: var(--secondary-color);
            border-radius: 15px;
            padding: 20px;
            margin: 10px 15px;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .plan-item:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(93, 92, 222, 0.2);
        }

        .plan-item.popular {
            border-color: var(--primary-color);
            position: relative;
        }

        .plan-item.popular::before {
            content: "Populaire";
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .plan-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .plan-price {
            font-size: 32px;
            font-weight: bold;
            color: var(--sats-color);
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .plan-duration {
            font-size: 14px;
            color: var(--inactive-text);
        }

        .plan-features {
            list-style: none;
            margin: 15px 0;
            text-align: left;
        }

        .plan-features li {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .plan-features li::before {
            content: '✓';
            color: var(--success-color);
            font-weight: bold;
            margin-right: 10px;
        }

        .plan-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            transition: all 0.2s ease;
        }

        .plan-button:hover {
            background-color: #4a49c0;
            transform: translateY(-2px);
        }

        .plan-button:active {
            transform: translateY(0);
        }

        .plan-button:disabled {
            background-color: var(--border-color);
            color: var(--inactive-text);
            cursor: not-allowed;
            transform: none;
        }

        /* Tutorials Section Styles */
        .tutorials-section {
            padding: 10px 0;
        }

        .tutorial-item {
            background-color: var(--secondary-color);
            border-radius: 15px;
            margin: 15px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }

        .tutorial-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .tutorial-thumbnail {
            position: relative;
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, var(--primary-color), #4a49c0);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .tutorial-play-button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary-color);
            transition: all 0.3s ease;
        }

        .tutorial-thumbnail:hover .tutorial-play-button {
            transform: scale(1.1);
            background-color: white;
        }

        .tutorial-content {
            padding: 20px;
        }

        .tutorial-title {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .tutorial-description {
            color: var(--inactive-text);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .tutorial-duration {
            display: flex;
            align-items: center;
            color: var(--primary-color);
            font-size: 14px;
            font-weight: 500;
        }

        .tutorial-duration i {
            margin-right: 8px;
        }

        .tutorial-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--sats-color);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }

        .video-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .video-modal.active {
            display: flex;
        }

        .video-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            background-color: #000;
            border-radius: 10px;
            overflow: hidden;
        }

        .video-player {
            width: 100%;
            height: auto;
            max-height: 80vh;
        }

        .video-close {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.5);
            transition: background-color 0.2s ease;
        }

        .video-close:hover {
            background-color: rgba(0, 0, 0, 0.8);
        }
    </style>
</head>
<body>
    <div id="verify-animation" class="verify-animation">
        <div class="football-bounce">
            <i class="fas fa-futbol"></i>
        </div>
        <div class="verify-text">Vérification en cours...</div>
    </div>

    <!-- Debug Panel -->
    <div id="debug-log-panel" class="debug-log-panel">
        <div class="debug-log-header">
            <span>Debug Console</span>
            <span class="debug-log-close" id="debug-log-close">×</span>
        </div>
        <div class="debug-log-content" id="debug-log-content">
            <!-- Logs will be added here -->
        </div>
    </div>

    <div id="debug-toggle-btn" class="debug-toggle-btn">
        <i class="fas fa-bug"></i>
    </div>
    
    <div class="side-menu" id="side-menu">
        <div class="side-menu-header">
            <div class="side-menu-close" id="side-menu-close">
                <i class="fas fa-times"></i>
            </div>
            <div class="side-menu-title">Pari Alliance</div>
        </div>
        <div class="side-menu-content">
            <div class="side-menu-item" id="menu-profile">
                <i class="fas fa-user"></i>
                <div class="side-menu-text">Profil</div>
            </div>
            <div class="side-menu-item" id="menu-subscription">
                <i class="fas fa-crown"></i>
                <div class="side-menu-text">Abonnement</div>
            </div>
            <div class="side-menu-item" id="menu-tutorials">
                <i class="fas fa-play-circle"></i>
                <div class="side-menu-text">Tutoriels</div>
            </div>
            <div class="side-menu-item" id="menu-interface">
                <i class="fas fa-paint-brush"></i>
                <div class="side-menu-text">Interface</div>
            </div>
        </div>
        <div class="side-menu-footer">
            <div class="side-menu-item" id="menu-terms">
                <i class="fas fa-file-alt"></i>
                <div class="side-menu-text">Conditions d'utilisation</div>
            </div>
            <div class="side-menu-item" id="menu-about">
                <i class="fas fa-info-circle"></i>
                <div class="side-menu-text">À propos</div>
            </div>
        </div>
    </div>
    
    <div class="side-menu-overlay" id="side-menu-overlay"></div>
    
    <div id="auth-screen" class="auth-screen" style="display: none;">
        <div class="auth-header">
            <div class="auth-logo">
                <i class="fas fa-futbol"></i>
            </div>
            <h1 class="auth-title">Pari Alliance</h1>
            <p class="auth-subtitle">Messagerie de groupe sécurisée</p>
        </div>
        
        <div class="auth-tabs">
            <div class="auth-tab active" id="login-tab">Connexion</div>
            <div class="auth-tab" id="register-tab">Inscription</div>
        </div>
        
        <div id="login-form" class="auth-form active">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="login-email" placeholder="Votre email">
                <div id="login-email-error" class="form-error">Veuillez entrer un email valide</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Mot de passe</label>
                <input type="password" class="form-input" id="login-password" placeholder="Votre mot de passe">
                <div id="login-password-error" class="form-error">Le mot de passe est obligatoire</div>
            </div>
            
            <div id="login-log" class="log-message" style="display:none;"></div>

            <div class="form-footer">
                <button class="button" id="loginBtn">
                    <span class="btn-loader" style="display:none;"></span>
                    <span class="btn-text">Se connecter</span>
                </button>
                <p class="form-footer-text">
                    Vous n'avez pas de compte ? <a href="#" class="form-link" id="goto-register">S'inscrire</a>
                </p>
            </div>
        </div>
        
        <div id="register-form" class="auth-form">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="register-email" placeholder="Votre adresse email">
                <div id="register-email-error" class="form-error">Veuillez entrer un email valide</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Mot de passe</label>
                <input type="password" class="form-input" id="register-password" placeholder="Créez un mot de passe sécurisé">
                <div id="register-password-error" class="form-error">Le mot de passe doit contenir au moins 6 caractères</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Confirmer le mot de passe</label>
                <input type="password" class="form-input" id="register-confirm-password" placeholder="Confirmez votre mot de passe">
                <div id="register-confirm-password-error" class="form-error">Les mots de passe ne correspondent pas</div>
            </div>
            
            <div id="register-log" class="log-message" style="display:none;"></div>

            <div class="form-footer">
                <button class="button" id="registerBtn">
                    <span class="btn-loader" style="display:none;"></span>
                    <span class="btn-text">S'inscrire</span>
                </button>
                <p class="form-footer-text">
                    Vous avez déjà un compte ? <a href="#" class="form-link" id="goto-login">Se connecter</a>
                </p>
            </div>
        </div>
    </div>

    <div id="loading" class="loading" style="display: none;">
        <i class="fas fa-futbol loading-spinner"></i>
        <div style="font-weight: bold; font-size: 24px; color: var(--primary-color);">Pari Alliance</div>
        <div style="margin-top: 10px; color: #6b7280;">Chargement...</div>
    </div>

    <div class="header">
        <div class="header-left">
            <div id="header-menu-button" class="menu-button">
                <i class="fas fa-bars"></i>
            </div>
            <div id="header-back-button" class="back-button" style="display:none;">
                <i class="fas fa-chevron-left"></i>
            </div>
        </div>
        <div id="header-title" class="header-title">Discussions</div>
        <div id="header-action">
            <div class="search-button" id="search-button">
                <i class="fas fa-search"></i>
            </div>
            <div class="events-button" id="events-button">
                <i class="fas fa-bell"></i>
                <div class="notification-dot" id="events-notification-dot"></div>
            </div>
        </div>
        
        <div class="search-container" id="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="Rechercher...">
            <div class="search-close" id="search-close">
                <i class="fas fa-times"></i>
            </div>
        </div>
    </div>

    <!-- Selection Toolbar -->
    <div class="selection-toolbar" id="selection-toolbar">
        <div class="selection-info" id="selection-info">
            0 message sélectionné
        </div>
        <div class="selection-actions">
            <div class="selection-btn copy" id="selection-copy-btn">
                <i class="fas fa-copy"></i>
            </div>
            <div class="selection-btn reply" id="selection-reply-btn">
                <i class="fas fa-reply"></i>
            </div>
            <div class="selection-btn delete" id="selection-delete-btn">
                <i class="fas fa-trash"></i>
            </div>
            <div class="selection-btn cancel" id="selection-cancel-btn">
                <i class="fas fa-times"></i>
            </div>
        </div>
    </div>

    <div class="content">
        <div id="discussions-section" class="section active">
            <div class="chat-list" id="discussions-list">
                <div class="empty-state">
                    <i class="fas fa-comments"></i>
                    <div class="empty-state-title">Aucune discussion</div>
                    <div class="empty-state-text">Vos discussions apparaîtront ici</div>
                </div>
            </div>
            
            <div class="fab" id="create-group-btn">
                <i class="fas fa-plus"></i>
            </div>
        </div>
        
        <div id="events-section" class="section">
            <div id="events-list">
                <div class="empty-state">
                    <i class="fas fa-bell"></i>
                    <div class="empty-state-title">Aucun événement</div>
                    <div class="empty-state-text">Les événements apparaîtront ici</div>
                </div>
            </div>
            
            <div class="fab" id="close-events-btn" style="background-color: #f44336;">
                <i class="fas fa-arrow-left"></i>
            </div>
            
            <div class="fab" id="create-notification-btn" style="display: none; bottom: 150px;">
                <i class="fas fa-bullhorn"></i>
            </div>
        </div>
        
        <div id="users-section" class="section">
            <div class="users-list" id="users-list">
                <div class="empty-state">
                    <i class="fas fa-address-book"></i>
                    <div class="empty-state-title">Aucun utilisateur</div>
                    <div class="empty-state-text">Les utilisateurs apparaîtront ici</div>
                </div>
            </div>
        </div>
        
        <div id="subscription-section" class="section">
            <div class="current-plan">
                <div class="current-plan-title">Plan Actuel</div>
                <div class="current-plan-info">Plan Gratuit</div>
                <div class="sats-balance">
                    <i class="fab fa-bitcoin"></i>
                    <span id="user-sats-balance">0</span> sats
                </div>
                <div style="font-size: 14px; color: var(--inactive-text);">
                    Rechargez vos sats pour accéder aux plans premium
                </div>
            </div>

            <div class="plan-item popular">
                <div class="plan-title">
                    <i class="fas fa-calendar-day"></i>
                    Plan Quotidien
                </div>
                <div class="plan-price">
                    <i class="fab fa-bitcoin"></i>
                    10 <span class="plan-duration">sats/jour</span>
                </div>
                <ul class="plan-features">
                    <li>Accès aux pronostics du jour</li>
                    <li>Notifications en temps réel</li>
                    <li>Support prioritaire</li>
                </ul>
                <button class="plan-button" id="daily-plan-btn">
                    S'abonner au plan quotidien
                </button>
            </div>

            <div class="plan-item">
                <div class="plan-title">
                    <i class="fas fa-calendar-week"></i>
                    Plan Hebdomadaire
                </div>
                <div class="plan-price">
                    <i class="fab fa-bitcoin"></i>
                    60 <span class="plan-duration">sats/semaine</span>
                </div>
                <ul class="plan-features">
                    <li>Tous les avantages du plan quotidien</li>
                    <li>Économisez 10 sats par semaine</li>
                    <li>Accès aux analyses avancées</li>
                    <li>Historique complet des pronostics</li>
                </ul>
                <button class="plan-button" id="weekly-plan-btn">
                    S'abonner au plan hebdomadaire
                </button>
            </div>

            <div class="fab" id="close-subscription-btn" style="background-color: #f44336;">
                <i class="fas fa-arrow-left"></i>
            </div>
        </div>

        <div id="tutorials-section" class="section">
            <div class="tutorial-item">
                <div class="tutorial-thumbnail" data-video="free-sats">
                    <div class="tutorial-play-button">
                        <i class="fas fa-play"></i>
                    </div>
                    <div class="tutorial-badge">Gratuit</div>
                </div>
                <div class="tutorial-content">
                    <div class="tutorial-title">Comment obtenir des sats gratuitement</div>
                    <div class="tutorial-description">
                        Découvrez toutes les méthodes pour gagner des satoshis gratuitement et recharger votre compte sans dépenser d'argent.
                    </div>
                    <div class="tutorial-duration">
                        <i class="far fa-clock"></i>
                        5 minutes
                    </div>
                </div>
            </div>

            <div class="tutorial-item">
                <div class="tutorial-thumbnail" data-video="buy-plan">
                    <div class="tutorial-play-button">
                        <i class="fas fa-play"></i>
                    </div>
                    <div class="tutorial-badge">Premium</div>
                </div>
                <div class="tutorial-content">
                    <div class="tutorial-title">Comment acheter un plan d'abonnement</div>
                    <div class="tutorial-description">
                        Guide complet pour souscrire à un plan premium et profiter de tous les avantages de Pari Alliance.
                    </div>
                    <div class="tutorial-duration">
                        <i class="far fa-clock"></i>
                        3 minutes
                    </div>
                </div>
            </div>

            <div class="fab" id="close-tutorials-btn" style="background-color: #f44336;">
                <i class="fas fa-arrow-left"></i>
            </div>
        </div>
        
        <div id="interface-section" class="section">
            <div class="interface-section">
                <div class="interface-title">Thème de couleur</div>
                <div class="theme-selector">
                    <div class="theme-option theme-blue active" data-theme="default">
                        <div class="theme-label">Bleu</div>
                    </div>
                    <div class="theme-option theme-green" data-theme="green">
                        <div class="theme-label">Vert</div>
                    </div>
                    <div class="theme-option theme-red" data-theme="red">
                        <div class="theme-label">Rouge</div>
                    </div>
                    <div class="theme-option theme-orange" data-theme="orange">
                        <div class="theme-label">Orange</div>
                    </div>
                    <div class="theme-option theme-red-pink" data-theme="red-pink">
                        <div class="theme-label">Rouge-Rose</div>
                    </div>
                    <div class="theme-option theme-green-yellow" data-theme="green-yellow">
                        <div class="theme-label">Vert-Jaune</div>
                    </div>
                    <div class="theme-option theme-blue-purple" data-theme="blue-purple">
                        <div class="theme-label">Bleu-Violet</div>
                    </div>
                    <div class="theme-option theme-orange-gold" data-theme="orange-gold">
                        <div class="theme-label">Orange-Doré</div>
                    </div>
                </div>
            </div>
            
            <div class="interface-section">
                <div class="interface-title">Mode d'affichage</div>
                <div class="setting-item">
                    <div class="setting-row">
                        <div class="setting-icon">
                            <i class="fas fa-moon" style="color: var(--primary-color);"></i>
                        </div>
                        <div class="setting-label">Mode sombre</div>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="dark-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
            
            <div class="fab" id="close-interface-btn" style="background-color: #f44336;">
                <i class="fas fa-arrow-left"></i>
            </div>
        </div>
        
        <div id="profile-section" class="section">
            <div class="profile-header">
                <div class="profile-pic">
                    <i class="fas fa-user"></i>
                    <div class="profile-pic-edit" id="edit-profile-pic">
                        <i class="fas fa-pencil-alt"></i>
                    </div>
                </div>
                <div class="profile-info">
                    <div class="profile-name" id="profile-name">
                        <span id="profile-name-text">Utilisateur</span>
                        <span class="admin-badge" id="admin-badge" style="display: none;">Admin</span>
                    </div>
                    <div class="profile-email" id="profile-email">user@example.com</div>
                    <div class="profile-status">En ligne</div>
                    <div class="profile-edit" id="edit-profile-btn">
                        <i class="fas fa-edit"></i> Modifier le profil
                    </div>
                </div>
            </div>
            
            <div class="section-title">Paramètres</div>
            
            <div class="settings-container">
                <div class="section-title">Nous rejoindre</div>
                
                <div class="social-buttons">
                    <div class="social-button whatsapp" id="whatsapp-btn">
                        WhatsApp
                    </div>
                    <div class="social-button telegram" id="telegram-btn">
                        Telegram
                    </div>
                    <div class="social-button youtube" id="youtube-btn">
                        YouTube
                    </div>
                </div>
                
                <button id="logout-btn" class="button">Se déconnecter</button>
                <button id="delete-account-btn" class="button danger" style="margin-top: 15px;">Supprimer mon compte</button>
            </div>
        </div>
        
        <div id="forecasts-section" class="section">
            <div class="forecasts-tabs">
                <div class="forecast-tab active" data-tab="safes">Safes du jour</div>
                <div class="forecast-tab" data-tab="exact">Scores exacts</div>
                <div class="forecast-tab" data-tab="ai">Prédictions IA</div>
            </div>
            
            <div class="forecasts-content active" id="safes-content">
                <div class="forecasts-list" id="safes-list">
                </div>
            </div>
            
            <div class="forecasts-content" id="exact-content">
                <div class="forecasts-list" id="exact-list">
                </div>
            </div>
            
            <div class="forecasts-content" id="ai-content">
                <div class="forecasts-list" id="ai-list">
                </div>
            </div>
        </div>
    </div>

    <div id="chat-interface" class="chat-section">
        <div class="chat-messages-container">
            <div class="chat-messages" id="chat-messages">
            </div>
        </div>
        <div class="chat-input-container" id="chat-input-container">
            <div class="image-button" id="image-button">
                <i class="fas fa-image"></i>
            </div>
            <div class="chat-input-wrapper" id="chat-input-wrapper">
                <!-- Reply preview dynamically added here -->
                <div class="reply-preview" id="reply-preview">
                    <div class="reply-preview-close" id="reply-close">
                        <i class="fas fa-times"></i>
                    </div>
                    <div class="reply-preview-header">Réponse à <span id="reply-name">Utilisateur</span></div>
                    <div class="reply-preview-content" id="reply-content">Message original</div>
                </div>
                <textarea id="chat-input" class="chat-input" placeholder="Écrire un message..." autocomplete="off" rows="1"></textarea>
            </div>
            <div class="send-button" id="send-button">
                <i class="fas fa-paper-plane"></i>
            </div>
        </div>
        <input type="file" id="chat-image-input" accept="image/*">
    </div>
    
    <div id="create-group-dialog" class="create-group-dialog">
        <div class="create-group-header">
            <div class="create-group-back" id="create-group-back">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="create-group-title">Nouveau groupe</div>
        </div>
        <div class="create-group-content">
            <div class="group-form">
                <div class="group-image-preview" id="new-group-image-preview">
                    <i class="fas fa-users" style="color: white; font-size: 40px;"></i>
                    <div class="group-image-overlay" id="new-group-image-upload">
                        <i class="fas fa-camera"></i>
                    </div>
                </div>
                <input type="file" id="new-group-image-input" accept="image/*">
                
                <div class="form-group">
                    <label class="form-label">Nom du groupe</label>
                    <input type="text" class="form-input" id="group-name" placeholder="Entrez le nom du groupe">
                    <div id="group-name-error" class="form-error">Le nom du groupe est requis</div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description (optionnelle)</label>
                    <input type="text" class="form-input" id="group-description" placeholder="Décrivez le groupe">
                </div>
                <div class="form-group">
                    <label class="form-label">Permissions de message</label>
                    <div style="display: flex; align-items: center; margin-top: 8px;">
                        <label class="switch">
                            <input type="checkbox" id="group-public-messages" checked>
                            <span class="slider"></span>
                        </label>
                        <span style="margin-left: 10px; font-size: 14px;">Permettre à tous les membres d'écrire</span>
                    </div>
                    <div style="font-size: 12px; color: var(--inactive-text); margin-top: 5px; margin-left: 60px;">
                        Si désactivé, seuls les administrateurs pourront écrire des messages
                    </div>
                </div>
                <button class="button" id="create-group-submit">
                    <span class="btn-loader" style="display:none;"></span>
                    <span class="btn-text">Créer le groupe</span>
                </button>
            </div>
        </div>
    </div>
    
    <div id="edit-group-dialog" class="edit-dialog">
        <div class="edit-header">
            <div class="edit-back" id="edit-group-back">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="edit-title">Modifier le groupe</div>
        </div>
        <div class="edit-content">
            <div class="group-image-preview" id="edit-group-image-preview">
                <i class="fas fa-users" style="color: white; font-size: 40px;"></i>
                <div class="group-image-overlay" id="edit-group-image-upload">
                    <i class="fas fa-camera"></i>
                </div>
            </div>
            <input type="file" id="edit-group-image-input" accept="image/*">
            
            <div class="form-group">
                <label class="form-label">Nom du groupe</label>
                <div class="editable-field">
                    <input type="text" class="form-input editable-field-input" id="edit-group-name" placeholder="Entrez le nom du groupe">
                    <button class="save-field-btn" id="save-group-name-btn">Enregistrer</button>
                </div>
                <div id="edit-group-name-error" class="field-error">Le nom du groupe est requis</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Description</label>
                <div class="editable-field">
                    <input type="text" class="form-input editable-field-input" id="edit-group-description" placeholder="Décrivez le groupe">
                    <button class="save-field-btn" id="save-group-description-btn">Enregistrer</button>
                </div>
                <div id="edit-group-description-error" class="field-error"></div>
            </div>
            
            <div class="form-group" id="edit-group-permissions-container">
                <label class="form-label">Permissions de message</label>
                <div style="display: flex; align-items: center; margin-top: 8px;">
                    <label class="switch">
                        <input type="checkbox" id="edit-group-public-messages">
                        <span class="slider"></span>
                    </label>
                    <span style="margin-left: 10px; font-size: 14px;">Permettre à tous les membres d'écrire</span>
                    <button class="save-field-btn" id="save-group-permissions-btn" style="margin-left: auto;">Enregistrer</button>
                </div>
                <div style="font-size: 12px; color: var(--inactive-text); margin-top: 5px; margin-left: 60px;">
                    Si désactivé, seuls les administrateurs pourront écrire des messages
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Image du groupe</label>
                <button class="button" id="save-group-image-btn" style="margin-top: 10px;">
                    <span class="btn-loader" style="display:none;"></span>
                    <span class="btn-text">Enregistrer l'image</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Group Info Dialog -->
    <div id="group-info-dialog" class="group-info-dialog">
        <div class="group-info-header">
            <div class="group-info-back" id="group-info-back">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="group-info-title">Informations du groupe</div>
        </div>
        <div class="group-info-content">
            <div class="group-info-section">
                <div class="group-image-preview" id="info-group-image-preview" style="width: 120px; height: 120px; margin-bottom: 20px;">
                    <i class="fas fa-users" style="color: white; font-size: 40px;"></i>
                </div>
                
                <div class="group-info-detail">
                    <div class="group-info-label">Nom</div>
                    <div class="group-info-value" id="info-group-name">Nom du groupe</div>
                </div>
                
                <div class="group-info-detail">
                    <div class="group-info-label">Description</div>
                    <div class="group-info-value" id="info-group-description">Description du groupe</div>
                </div>
                
                <div class="group-info-detail">
                    <div class="group-info-label">Type</div>
                    <div class="group-info-value" id="info-group-type">Public</div>
                </div>
            </div>
            
            <div class="group-info-section">
                <div class="group-info-section-title">Images partagées</div>
                <div class="group-info-images" id="info-group-images">
                    <div class="group-info-image-empty">Aucune image partagée</div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="admin-notif-dialog" class="admin-notif-dialog">
        <div class="edit-header">
            <div class="edit-back" id="admin-notif-back">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="edit-title">Nouvelle notification</div>
        </div>
        <div class="edit-content">
            <div class="form-group">
                <label class="form-label">Titre de la notification</label>
                <input type="text" class="form-input" id="notif-title" placeholder="Titre de votre notification">
                <div id="notif-title-error" class="field-error">Le titre est requis</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Contenu</label>
                <textarea class="form-input" id="notif-content" placeholder="Contenu de votre notification" rows="5" style="resize: none;"></textarea>
                <div id="notif-content-error" class="field-error">Le contenu est requis</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Type de notification</label>
                <select class="form-input" id="notif-type">
                    <option value="info">Information</option>
                    <option value="alert">Alerte</option>
                    <option value="update">Mise à jour</option>
                </select>
            </div>
            
            <button class="button" id="send-notification-btn">
                <span class="btn-loader" style="display:none;"></span>
                <span class="btn-text">Envoyer la notification</span>
            </button>
        </div>
    </div>
    
    <div id="profile-edit-dialog" class="profile-edit-dialog">
        <div class="edit-header">
            <div class="edit-back" id="profile-edit-back">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="edit-title">Modifier le profil</div>
        </div>
        <div class="edit-content">
            <div class="profile-image-upload">
                <div class="profile-image-preview" id="profile-image-preview">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-upload-btn" id="profile-upload-btn">
                    <i class="fas fa-camera"></i>
                </div>
                <input type="file" id="profile-image-input" accept="image/*">
            </div>
            
            <div class="form-group">
                <label class="form-label">Nom d'utilisateur</label>
                <div class="editable-field">
                    <input type="text" class="form-input editable-field-input" id="edit-display-name" placeholder="Entrez votre nom d'utilisateur">
                    <button class="save-field-btn" id="save-display-name-btn">Enregistrer</button>
                </div>
                <div id="edit-display-name-error" class="field-error">Le nom d'utilisateur est requis</div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Photo de profil</label>
                <button class="button" id="save-profile-image-btn" style="margin-top: 10px;">
                    <span class="btn-loader" style="display:none;"></span>
                    <span class="btn-text">Enregistrer la photo</span>
                </button>
            </div>
        </div>
    </div>
    
    <div id="about-dialog" class="about-dialog">
        <div class="edit-header">
            <div class="edit-back" id="about-back">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="edit-title">À propos</div>
        </div>
        <div class="about-content">
            <div class="about-logo">
                <i class="fas fa-futbol"></i>
                <div class="about-title">Pari Alliance</div>
                <div class="about-version">Version 1.3.0</div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Description</div>
                <div class="about-section-content">
                    Pari Alliance est une application de messagerie sécurisée qui permet aux utilisateurs de créer et de participer à des discussions de groupe.
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Fonctionnalités</div>
                <div class="about-section-content">
                    • Messagerie de groupe en temps réel<br>
                    • Partage de pronostics sportifs<br>
                    • Mode sombre personnalisable<br>
                    • Thèmes de couleurs multiples<br>
                    • Gestion simple des groupes<br>
                    • Messages directs entre utilisateurs<br>
                    • Envoi de notifications pour les administrateurs
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">À propos de l'application</div>
                <div class="about-section-content">
                    Le logo de l'application est constitué deux mains qui se soutiennent et en arrière-plan ballon de football. L'application a été créée par Pronosoft AI.
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Confidentialité</div>
                <div class="about-section-content">
                    Pari Alliance respecte votre vie privée. Vos données personnelles ne sont utilisées que pour le fonctionnement de l'application et ne sont jamais partagées avec des tiers.
                </div>
            </div>
            
            <div class="about-footer">
                © 2025-2026 Pari Alliance. Tous droits réservés.
            </div>
        </div>
    </div>
    
    <div id="terms-dialog" class="terms-dialog">
        <div class="terms-header">
            <div class="terms-back" id="terms-back">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="terms-title">Conditions d'utilisation</div>
        </div>
        <div class="terms-content">
            <div class="about-section">
                <div class="about-section-title">Conditions générales</div>
                <div class="about-section-content">
                    En utilisant l'application Pari Alliance, vous acceptez de respecter les présentes conditions d'utilisation. L'accès et l'utilisation de cette application sont soumis à votre acceptation et au respect des présentes conditions.
                </div>
            </div>
            
            <div class="warning-box">
                <i class="fas fa-exclamation-triangle"></i> <strong>AVERTISSEMENT :</strong> Les pronostics sont fournis à titre informatif uniquement. La vente ou revente de ces pronostics est strictement interdite et passible de bannissement à vie et de poursuites judiciaires.
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Utilisation des pronostics</div>
                <div class="about-section-content">
                    Les pronostics sportifs fournis dans cette application sont destinés uniquement à des fins d'information et de divertissement. Ils peuvent être utilisés pour effectuer des paris réels, mais il est recommandé de le faire avec responsabilité.<br><br>
                    
                    Nous ne sommes pas responsables de leurs pertes éventuelles. Les pronostics ne constituent en aucun cas une incitation au jeu ou un conseil d'investissement.<br><br>
                    
                    Il est strictement interdit de:<br>
                    • Revendre ou commercialiser ces pronostics<br>
                    • Partager ces informations en dehors de la plateforme<br>
                    • Utiliser ces informations à des fins commerciales<br><br>
                    
                    Tout utilisateur enfreignant ces règles s'expose à une suspension immédiate de son compte et à d'éventuelles poursuites judiciaires.
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Utilisation de l'application</div>
                <div class="about-section-content">
                    Vous vous engagez à utiliser l'application de manière légale et responsable. Il est interdit de:<br>
                    • Publier du contenu illégal, diffamatoire, harcelant ou menaçant<br>
                    • Usurper l'identité d'une autre personne<br>
                    • Tenter d'accéder sans autorisation à des parties de l'application qui vous sont interdites<br>
                    • Perturber le fonctionnement normal de l'application<br>
                    • Publier des messages à caractère commercial non sollicités
                </div>
            </div>
            
            <div class="about-section">
                <div class="about-section-title">Responsabilité</div>
                <div class="about-section-content">
                    Pari Alliance n'est pas responsable des pertes financières ou autres dommages qui pourraient résulter de l'utilisation des pronostics(des événements imprévus tels que les cartons rouges,les fautes pouvant causer un penalty etc...)ou des informations disponibles sur l'application. Les utilisateurs sont seuls responsables de leurs décisions et de leurs actions.
                </div>
            </div>
        </div>
    </div>
    
    <div id="delete-confirmation" class="confirmation-dialog">
        <div class="confirmation-title">Supprimer les messages sélectionnés ?</div>
        <div class="confirmation-text">Cette action est irréversible et les messages seront définitivement supprimés.</div>
        <div class="confirmation-buttons">
            <div class="confirmation-button confirmation-cancel" id="delete-cancel">Annuler</div>
            <div class="confirmation-button confirmation-delete" id="delete-confirm">Supprimer</div>
        </div>
    </div>
    
    <div id="delete-event-confirmation" class="confirmation-dialog">
        <div class="confirmation-title">Supprimer cet événement ?</div>
        <div class="confirmation-text">Cette action est irréversible et l'événement sera supprimé.</div>
        <div class="confirmation-buttons">
            <div class="confirmation-button confirmation-cancel" id="delete-event-cancel">Annuler</div>
            <div class="confirmation-button confirmation-delete" id="delete-event-confirm">Supprimer</div>
        </div>
    </div>
    
    <div id="delete-account-confirmation" class="confirmation-dialog">
        <div class="confirmation-title">Supprimer votre compte ?</div>
        <div class="confirmation-text">ATTENTION : Cette action est définitive et irréversible. Toutes vos données seront supprimées.</div>
        <div class="confirmation-buttons">
            <div class="confirmation-button confirmation-cancel" id="delete-account-cancel">Annuler</div>
            <div class="confirmation-button confirmation-delete" id="delete-account-confirm">Supprimer</div>
        </div>
    </div>

    <div id="logout-confirmation" class="confirmation-dialog">
        <div class="confirmation-title">Se déconnecter ?</div>
        <div class="confirmation-text">Voulez-vous vraiment vous déconnecter de Pari Alliance ?</div>
        <div class="confirmation-buttons">
            <div class="confirmation-button confirmation-cancel" id="logout-cancel">Annuler</div>
            <div class="confirmation-button confirmation-confirm" id="logout-confirm">Déconnecter</div>
        </div>
    </div>

    <div id="plan-confirmation" class="confirmation-dialog">
        <div class="confirmation-title">Confirmer l'abonnement</div>
        <div class="confirmation-text" id="plan-confirmation-text">Voulez-vous vraiment souscrire à ce plan ?</div>
        <div class="confirmation-buttons">
            <div class="confirmation-button confirmation-cancel" id="plan-cancel">Annuler</div>
            <div class="confirmation-button confirmation-confirm" id="plan-confirm">Confirmer</div>
        </div>
    </div>

    <div id="overlay" class="overlay"></div>

    <div class="notification" id="notification"></div>
    
    <div id="image-viewer" class="image-viewer">
        <div class="viewer-image-container">
            <img src="" alt="Image" class="viewer-image" id="viewer-image" oncontextmenu="return false">
        </div>
        <div class="viewer-close" id="viewer-close">
            <i class="fas fa-times"></i>
        </div>
        <div class="download-button" id="download-image-btn">
            <i class="fas fa-download"></i>
        </div>
    </div>

    <div id="video-modal" class="video-modal">
        <div class="video-container">
            <div class="video-close" id="video-close">
                <i class="fas fa-times"></i>
            </div>
            <video class="video-player" id="video-player" controls>
                <source src="" type="video/mp4">
                Votre navigateur ne supporte pas la lecture vidéo.
            </video>
        </div>
    </div>

    <div class="bottom-nav" id="bottom-nav">
        <div class="nav-item active" data-section="discussions" style="flex: 1;">
            <i class="nav-icon fas fa-comments"></i>
            <span>Discussions</span>
        </div>
        <div class="nav-item" data-section="users" style="flex: 1;">
            <i class="nav-icon fas fa-address-book"></i>
            <span>Utilisateurs</span>
            <div class="notification-dot" id="users-notification-dot" style="display: none;"></div>
        </div>
        <div class="nav-item" data-section="forecasts" style="flex: 1;">
            <i class="nav-icon fas fa-futbol"></i>
            <span>Pronostics</span>
            <div class="notification-dot" id="forecasts-notification-dot" style="display: none;"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, deleteUser } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, getDoc, getDocs, query, orderBy, addDoc, onSnapshot, where, deleteDoc, serverTimestamp, updateDoc, arrayUnion, arrayRemove, limit, Timestamp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDTPLxUiA8lj82kqc6CyCPLQDITc0CtLUE",
            authDomain: "ichat-betai.firebaseapp.com",
            databaseURL: "https://ichat-betai-default-rtdb.firebaseio.com",
            projectId: "ichat-betai",
            storageBucket: "ichat-betai.appspot.com",
            messagingSenderId: "168337722600",
            appId: "1:168337722600:web:beb331f83cc4778c5b4d5d",
            measurementId: "G-STXPSZN7X8"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Debug system
        let debugLogs = [];
        let debugPanelVisible = false;

        function addDebugLog(message, type = 'info', linkUrl = null) {
            const timestamp = new Date().toLocaleTimeString('fr-FR');
            const log = {
                timestamp,
                message,
                type,
                linkUrl
            };
            
            debugLogs.push(log);
            
            // Keep only last 50 logs
            if (debugLogs.length > 50) {
                debugLogs.shift();
            }
            
            updateDebugPanel();
            
            // Show debug button if there are errors
            if (type === 'error') {
                document.getElementById('debug-toggle-btn').classList.add('active');
            }
        }

        function updateDebugPanel() {
            const content = document.getElementById('debug-log-content');
            content.innerHTML = '';
            
            debugLogs.forEach(log => {
                const item = document.createElement('div');
                item.className = `debug-log-item ${log.type}`;
                
                let messageContent = log.message;
                
                // Handle Firestore index links
                if (log.linkUrl) {
                    const linkPattern = /https:\/\/console\.firebase\.google\.com[^\s)]+/g;
                    messageContent = messageContent.replace(linkPattern, (url) => {
                        return `<a href="${url}" target="_blank" rel="noopener noreferrer" class="debug-log-link">${url}</a>`;
                    });
                }
                
                item.innerHTML = `
                    <span class="debug-log-timestamp">${log.timestamp}</span>
                    ${messageContent}
                `;
                content.appendChild(item);
            });
            
            // Auto scroll to bottom
            content.scrollTop = content.scrollHeight;
        }

        function handleFirestoreError(error, operation) {
            let errorMessage = `Erreur ${operation}: ${error.code || 'inconnu'}`;
            let linkUrl = null;
            
            if (error.code === 'failed-precondition' || error.message.includes('index')) {
                // Extract index URL from error message if available
                const urlMatch = error.message.match(/https:\/\/console\.firebase\.google\.com[^\s)]+/);
                if (urlMatch) {
                    linkUrl = urlMatch[0];
                    errorMessage += `\n\nLien pour créer l'index: ${linkUrl}`;
                } else {
                    errorMessage += '\n\nUn index Firestore est requis. Consultez la console Firebase.';
                }
            }
            
            console.error(`${operation} error:`, error);
            addDebugLog(errorMessage, 'error', linkUrl);
            
            return errorMessage;
        }

        let isLoggedIn = false;
        let currentUser = null;
        let currentUserData = null;
        let isAdmin = false;
        let currentGroup = '';
        let currentGroupId = null;
        let currentGroupData = null;
        let currentSection = 'discussions';
        let isOnline = navigator.onLine;
        let messageQueue = [];
        let chatUnsubscribers = {};
        let eventsUnsubscribe = null;
        let forecastsUnsubscribe = null;
        let usersUnsubscribe = null;
        let groupImageFile = null;
        let profileImageFile = null;
        let editingGroupId = null;
        let profileUpdating = false;
        let isLoadingGroups = false;
        let isLoadingEvents = false;
        let isLoadingUsers = false;
        let profileNameChanged = false;
        let groupNameChanged = false;
        let groupDescriptionChanged = false;
        let groupPermissionsChanged = false;
        let currentEventForDeletion = null;
        let currentForecastTab = 'safes';
        let lastViewedEventTimestamp = null;
        let hasNewEvents = false;
        let chatImageFile = null;
        let isSearchActive = false;
        let currentSearchContext = '';
        let replyingToMessage = null;
        let autoResizeTextarea = null;
        let groupImageCache = {};
        let currentDownloadImage = '';
        let forecastsCache = {};
        let usersCache = {};
        let currentChatPartner = null;
        let processingMessage = false;
        let selectedTheme = localStorage.getItem('parisAllianceTheme') || 'default';
        let directChatsCache = {};
        let allDiscussions = [];
        let unreadCounts = {};
        let userSatsBalance = 0;
        let currentPlanType = '';
        let discussionsLoaded = false;

        // New selection system variables
        let isSelectionMode = false;
        let selectedMessages = new Set();

        // Function to get current date in YYYY-MM-DD format
        function getCurrentDateString() {
            return new Date().toISOString().slice(0, 10);
        }

        // Function to get forecast file URL for today with new dynamic approach
        function getForecastFileUrl() {
            const today = getCurrentDateString();
            return `https://raw.githubusercontent.com/Jonnhy2255/Pronosoftbot/main/prédiction-${today}-analyse-ia.json`;
        }

        // Function to fetch forecasts from GitHub with new structure
        async function fetchForecastsFromGitHub() {
            const fileUrl = getForecastFileUrl();
            
            try {
                addDebugLog(`Récupération des pronostics depuis: ${fileUrl}`, 'info');
                
                const response = await fetch(fileUrl);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        addDebugLog(`Fichier de pronostics non trouvé pour aujourd'hui (${getCurrentDateString()})`, 'warning');
                        return null;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                addDebugLog(`Pronostics récupérés avec succès: ${data.length} pronostics`, 'success');
                
                return data;
            } catch (error) {
                addDebugLog(`Erreur lors de la récupération des pronostics: ${error.message}`, 'error');
                throw error;
            }
        }

        // Function to process and categorize forecasts with new structure
        function processForecastData(data) {
            const processed = {
                safes: [],
                exact: [],
                ai: []
            };

            if (!data || !Array.isArray(data)) {
                return processed;
            }

            // Process each forecast item from the array
            data.forEach((forecast, index) => {
                const processedForecast = {
                    id: `${forecast.type}_${index}`,
                    HomeTeam: forecast.HomeTeam,
                    AwayTeam: forecast.AwayTeam,
                    confidence: forecast.confidence || 75,
                    date: forecast.date,
                    league: forecast.league,
                    prediction: forecast.prediction,
                    type: forecast.type,
                    status: 'pending'
                };

                // Add to appropriate category based on type
                if (forecast.type === 'safes') {
                    processed.safes.push(processedForecast);
                } else if (forecast.type === 'exact') {
                    processed.exact.push(processedForecast);
                } else if (forecast.type === 'ai') {
                    processed.ai.push(processedForecast);
                }
            });

            return processed;
        }

        function setupTheme() {
            document.documentElement.classList.remove('theme-green', 'theme-red', 'theme-orange', 'theme-red-pink', 'theme-green-yellow', 'theme-blue-purple', 'theme-orange-gold');
            
            if (selectedTheme !== 'default') {
                document.documentElement.classList.add(`theme-${selectedTheme}`);
            }
            
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
            });
            
            const activeThemeOption = document.querySelector(`.theme-option[data-theme="${selectedTheme}"]`);
            if (activeThemeOption) {
                activeThemeOption.classList.add('active');
            }
        }
        
        function setupDarkMode() {
            const savedPreference = localStorage.getItem('parisAllianceDarkMode');
            
            if (savedPreference === 'true') {
                document.documentElement.classList.add('dark');
                document.getElementById('dark-toggle').checked = true;
            } else if (savedPreference === 'false') {
                document.documentElement.classList.remove('dark');
                document.getElementById('dark-toggle').checked = false;
            } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
                document.getElementById('dark-toggle').checked = true;
            } else {
                document.documentElement.classList.remove('dark');
                document.getElementById('dark-toggle').checked = false;
            }
            
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (localStorage.getItem('parisAllianceDarkMode') === null) {
                    if (event.matches) {
                        document.documentElement.classList.add('dark');
                        document.getElementById('dark-toggle').checked = true;
                    } else {
                        document.documentElement.classList.remove('dark');
                        document.getElementById('dark-toggle').checked = false;
                    }
                }
            });
        }
        
        function setupConnectionMonitoring() {
            function updateConnectionStatus() {
                if (navigator.onLine) {
                    isOnline = true;
                    processQueuedMessages();
                } else {
                    isOnline = false;
                    showNotification("Pas de connexion internet. Les messages seront envoyés lorsque vous serez connecté.", "error");
                }
            }
            
            window.addEventListener('online', () => {
                showNotification("Connexion rétablie", "success");
                isOnline = true;
                
                setTimeout(() => {
                    if (isLoggedIn && currentSection === 'discussions') {
                        loadDiscussions();
                    }
                    processQueuedMessages();
                }, 1000);
            });
            
            window.addEventListener('offline', () => {
                updateConnectionStatus();
            });
            
            updateConnectionStatus();
        }
        
        async function processQueuedMessages() {
            if (messageQueue.length === 0) return;
            
            const processedMessages = [...messageQueue];
            messageQueue = [];
            
            for (const message of processedMessages) {
                try {
                    if (message.direct) {
                        await sendDirectMessage(message.chatId, message.text, message.imageData, message.replyTo);
                    } else {
                        await sendMessageToFirestore(
                            message.groupId, 
                            message.text,
                            message.imageData,
                            message.replyTo
                        );
                    }
                } catch (error) {
                    messageQueue.push(message);
                }
            }
            
            if (messageQueue.length > 0) {
                showNotification(`${messageQueue.length} message(s) n'ont pas pu être envoyés`, 'error');
            } else if (processedMessages.length > 0) {
                showNotification('Tous les messages ont été envoyés', 'success');
            }
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            if (!notification) return;
            
            notification.classList.remove('show');
            
            setTimeout(() => {
                notification.textContent = message;
                notification.className = 'notification ' + type;
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    
                    setTimeout(() => {
                        notification.className = 'notification';
                        notification.textContent = '';
                    }, 300);
                }, 3000);
            }, 100);
        }

        async function loadUserSubscriptionData() {
            if (!currentUser) return;
            
            try {
                const userRef = doc(db, "Users", currentUser.uid);
                const userDoc = await getDoc(userRef);
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    userSatsBalance = userData.satsBalance || 0;
                    currentPlanType = userData.currentPlan || 'free';
                    
                    updateSubscriptionDisplay();
                }
            } catch (error) {
                console.error('Erreur lors du chargement des données d\'abonnement:', error);
            }
        }

        function updateSubscriptionDisplay() {
            const satsBalanceElement = document.getElementById('user-sats-balance');
            if (satsBalanceElement) {
                satsBalanceElement.textContent = userSatsBalance;
            }
            
            // Les boutons affichent toujours "S'abonner" au lieu de "Sats insuffisants"
            const planButtons = document.querySelectorAll('.plan-button');
            planButtons.forEach(button => {
                const isDaily = button.id === 'daily-plan-btn';
                
                button.disabled = false;
                if (isDaily) {
                    button.textContent = 'S\'abonner au plan quotidien';
                } else {
                    button.textContent = 'S\'abonner au plan hebdomadaire';
                }
            });
        }

        async function subscribeToPlan(planType) {
            const requiredSats = planType === 'daily' ? 10 : 60;
            
            if (userSatsBalance < requiredSats) {
                showNotification('Sats insuffisants pour ce plan', 'error');
                return;
            }
            
            try {
                const userRef = doc(db, "Users", currentUser.uid);
                await updateDoc(userRef, {
                    satsBalance: userSatsBalance - requiredSats,
                    currentPlan: planType,
                    planExpiryDate: new Date(Date.now() + (planType === 'daily' ? 24 * 60 * 60 * 1000 : 7 * 24 * 60 * 60 * 1000))
                });
                
                userSatsBalance -= requiredSats;
                currentPlanType = planType;
                
                updateSubscriptionDisplay();
                
                showNotification(`Abonnement ${planType === 'daily' ? 'quotidien' : 'hebdomadaire'} activé !`, 'success');
                
            } catch (error) {
                console.error('Erreur lors de l\'abonnement:', error);
                showNotification('Erreur lors de l\'abonnement', 'error');
            }
        }

        function showPlanConfirmation(planType) {
            const requiredSats = planType === 'daily' ? 10 : 60;
            const planName = planType === 'daily' ? 'quotidien' : 'hebdomadaire';
            
            document.getElementById('plan-confirmation-text').textContent = 
                `Voulez-vous vraiment souscrire au plan ${planName} pour ${requiredSats} sats ?`;
            
            document.getElementById('plan-confirmation').classList.add('active');
            document.getElementById('overlay').classList.add('active');
            
            // Store plan type for confirmation
            document.getElementById('plan-confirm').setAttribute('data-plan', planType);
            
            history.pushState({ page: 'plan-confirmation' }, '');
        }

        function hidePlanConfirmation() {
            document.getElementById('plan-confirmation').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }

        function playTutorialVideo(videoType) {
            const videoModal = document.getElementById('video-modal');
            const videoPlayer = document.getElementById('video-player');
            
            // Simulate video URLs (replace with actual video URLs)
            const videoUrls = {
                'free-sats': 'https://example.com/free-sats-tutorial.mp4',
                'buy-plan': 'https://example.com/buy-plan-tutorial.mp4'
            };
            
            if (videoUrls[videoType]) {
                videoPlayer.src = videoUrls[videoType];
                videoModal.classList.add('active');
                history.pushState({ page: 'video-tutorial' }, '');
            } else {
                // Fallback: show notification for demo
                const videoTitles = {
                    'free-sats': 'Comment obtenir des sats gratuitement',
                    'buy-plan': 'Comment acheter un plan d\'abonnement'
                };
                
                showNotification(`Vidéo "${videoTitles[videoType]}" bientôt disponible`, 'info');
            }
        }

        function closeVideoModal() {
            const videoModal = document.getElementById('video-modal');
            const videoPlayer = document.getElementById('video-player');
            
            videoModal.classList.remove('active');
            videoPlayer.pause();
            videoPlayer.src = '';
        }
        
        function setupTextareaAutoResize() {
            const textarea = document.getElementById('chat-input');
            if (!textarea) return;
            
            const adjustHeight = () => {
                textarea.style.height = 'auto';
                
                const newHeight = Math.min(textarea.scrollHeight, 100);
                textarea.style.height = `${newHeight}px`;
                
                const container = document.getElementById('chat-input-container');
                if (container) {
                    if (replyingToMessage) {
                        container.style.minHeight = `${60 + newHeight}px`;
                    } else {
                        container.style.minHeight = `${newHeight + 20}px`;
                    }
                }
            };
            
            adjustHeight();
            
            textarea.addEventListener('input', adjustHeight);
            
            autoResizeTextarea = adjustHeight;
        }

        // New Selection System Functions
        function enterSelectionMode() {
            if (isSelectionMode) return;
            
            isSelectionMode = true;
            selectedMessages.clear();
            
            const toolbar = document.getElementById('selection-toolbar');
            const content = document.querySelector('.content');
            const chatInterface = document.getElementById('chat-interface');
            
            toolbar.classList.add('active');
            content.classList.add('selection-mode');
            if (chatInterface.style.display === 'block') {
                chatInterface.classList.add('selection-mode');
            }
            
            // Make all messages selectable
            const messageContainers = document.querySelectorAll('.message-container');
            messageContainers.forEach(container => {
                container.classList.add('selectable');
                
                // Add click event for selection
                container.addEventListener('click', handleMessageSelection);
                
                // Add selection checkbox
                const checkbox = document.createElement('div');
                checkbox.className = 'message-checkbox';
                checkbox.innerHTML = '<i class="fas fa-check"></i>';
                container.appendChild(checkbox);
            });
            
            updateSelectionInfo();
            
            // Add select button to header in chat mode
            if (currentSection === 'chat') {
                const headerAction = document.getElementById('header-action');
                if (headerAction) {
                    const selectBtn = document.createElement('div');
                    selectBtn.className = 'select-button';
                    selectBtn.id = 'selection-exit-btn';
                    selectBtn.innerHTML = '<i class="fas fa-times"></i>';
                    selectBtn.addEventListener('click', exitSelectionMode);
                    headerAction.appendChild(selectBtn);
                }
            }
            
            history.pushState({ page: 'selection-mode' }, '');
        }
        
        function exitSelectionMode() {
            if (!isSelectionMode) return;
            
            isSelectionMode = false;
            selectedMessages.clear();
            
            const toolbar = document.getElementById('selection-toolbar');
            const content = document.querySelector('.content');
            const chatInterface = document.getElementById('chat-interface');
            
            toolbar.classList.remove('active');
            content.classList.remove('selection-mode');
            if (chatInterface) {
                chatInterface.classList.remove('selection-mode');
            }
            
            // Remove selection from all messages
            const messageContainers = document.querySelectorAll('.message-container');
            messageContainers.forEach(container => {
                container.classList.remove('selectable', 'selected');
                container.removeEventListener('click', handleMessageSelection);
                
                // Remove selection checkbox
                const checkbox = container.querySelector('.message-checkbox');
                if (checkbox) {
                    checkbox.remove();
                }
            });
            
            // Remove select button from header
            const selectBtn = document.getElementById('selection-exit-btn');
            if (selectBtn) {
                selectBtn.remove();
            }
        }
        
        function handleMessageSelection(event) {
            if (!isSelectionMode) return;
            
            event.preventDefault();
            event.stopPropagation();
            
            const messageContainer = event.currentTarget;
            const messageId = messageContainer.getAttribute('data-id');
            
            if (!messageId) return;
            
            if (selectedMessages.has(messageId)) {
                selectedMessages.delete(messageId);
                messageContainer.classList.remove('selected');
            } else {
                selectedMessages.add(messageId);
                messageContainer.classList.add('selected');
            }
            
            updateSelectionInfo();
            
            // Auto-exit if no messages selected
            if (selectedMessages.size === 0) {
                exitSelectionMode();
            }
        }
        
        function updateSelectionInfo() {
            const selectionInfo = document.getElementById('selection-info');
            if (selectionInfo) {
                const count = selectedMessages.size;
                selectionInfo.textContent = count === 1 ? 
                    '1 message sélectionné' : 
                    `${count} messages sélectionnés`;
            }
            
            // Update action buttons state
            const hasSelection = selectedMessages.size > 0;
            const copyBtn = document.getElementById('selection-copy-btn');
            const replyBtn = document.getElementById('selection-reply-btn');
            const deleteBtn = document.getElementById('selection-delete-btn');
            
            if (copyBtn) copyBtn.style.opacity = hasSelection ? '1' : '0.5';
            if (replyBtn) replyBtn.style.opacity = (hasSelection && selectedMessages.size === 1) ? '1' : '0.5';
            if (deleteBtn) deleteBtn.style.opacity = hasSelection ? '1' : '0.5';
        }
        
        function copySelectedMessages() {
            if (selectedMessages.size === 0) return;
            
            const messageContainers = document.querySelectorAll('.message-container');
            const messagesToCopy = [];
            
            messageContainers.forEach(container => {
                const messageId = container.getAttribute('data-id');
                if (selectedMessages.has(messageId)) {
                    const messageElement = container.querySelector('.message');
                    if (messageElement) {
                        let messageText = messageElement.textContent.trim();
                        
                        // Get sender name if it's a received message
                        const senderElement = container.querySelector('.message-sender');
                        if (senderElement) {
                            messageText = `${senderElement.textContent}: ${messageText}`;
                        }
                        
                        messagesToCopy.push(messageText);
                    }
                }
            });
            
            if (messagesToCopy.length > 0) {
                const textToCopy = messagesToCopy.join('\n\n');
                
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        showNotification(`${messagesToCopy.length} message(s) copié(s)`, 'success');
                        exitSelectionMode();
                    }).catch(() => {
                        showNotification('Impossible de copier les messages', 'error');
                    });
                } else {
                    // Fallback
                    const textArea = document.createElement('textarea');
                    textArea.value = textToCopy;
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    
                    try {
                        document.execCommand('copy');
                        showNotification(`${messagesToCopy.length} message(s) copié(s)`, 'success');
                        exitSelectionMode();
                    } catch (err) {
                        showNotification('Impossible de copier les messages', 'error');
                    }
                    
                    document.body.removeChild(textArea);
                }
            }
        }
        
        function replyToSelectedMessage() {
            if (selectedMessages.size !== 1) return;
            
            const messageId = Array.from(selectedMessages)[0];
            const messageContainer = document.querySelector(`[data-id="${messageId}"]`);
            
            if (!messageContainer) return;
            
            const messageElement = messageContainer.querySelector('.message');
            const senderElement = messageContainer.querySelector('.message-sender');
            const messageFrom = messageContainer.getAttribute('data-from');
            
            if (!messageElement) return;
            
            replyingToMessage = {
                id: messageId,
                from: messageFrom,
                text: messageElement.textContent.trim()
            };
            
            // Get sender name for reply preview
            let senderName = 'Utilisateur';
            if (messageFrom === currentUser.uid) {
                senderName = 'Vous';
            } else if (currentChatPartner) {
                senderName = currentChatPartner.displayName || 'Utilisateur';
            } else if (senderElement) {
                senderName = senderElement.textContent;
            }
            
            // Show reply preview
            const replyPreview = document.getElementById('reply-preview');
            const replyName = document.getElementById('reply-name');
            const replyContent = document.getElementById('reply-content');
            
            replyName.textContent = senderName;
            replyContent.textContent = replyingToMessage.text || 'Message';
            
            replyPreview.classList.add('active');
            
            const chatInputContainer = document.getElementById('chat-input-container');
            chatInputContainer.classList.add('with-reply');
            
            if (autoResizeTextarea) {
                autoResizeTextarea();
            }
            
            // Focus on input
            const chatInput = document.getElementById('chat-input');
            if (chatInput) {
                chatInput.focus();
            }
            
            exitSelectionMode();
        }
        
        function deleteSelectedMessages() {
            if (selectedMessages.size === 0) return;
            
            // Check permissions
            const messageContainers = document.querySelectorAll('.message-container');
            let canDeleteAll = true;
            
            messageContainers.forEach(container => {
                const messageId = container.getAttribute('data-id');
                if (selectedMessages.has(messageId)) {
                    const messageFrom = container.getAttribute('data-from');
                    if (messageFrom !== currentUser.uid && !isAdmin) {
                        canDeleteAll = false;
                    }
                }
            });
            
            if (!canDeleteAll) {
                showNotification('Vous ne pouvez supprimer que vos propres messages', 'error');
                return;
            }
            
            showDeleteConfirmation();
        }
        
        function showDeleteConfirmation() {
            document.getElementById('delete-confirmation').classList.add('active');
            document.getElementById('overlay').classList.add('active');
            history.pushState({ page: 'delete-confirmation' }, '');
        }
        
        function hideDeleteConfirmation() {
            document.getElementById('delete-confirmation').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }
        
        async function confirmDeleteSelectedMessages() {
            hideDeleteConfirmation();
            
            if (selectedMessages.size === 0) return;
            
            const messageContainers = document.querySelectorAll('.message-container');
            const deletePromises = [];
            
            messageContainers.forEach(container => {
                const messageId = container.getAttribute('data-id');
                if (selectedMessages.has(messageId)) {
                    container.classList.add('deleting');
                    
                    let messageRef;
                    if (currentChatPartner) {
                        const user1 = currentUser.uid;
                        const user2 = currentChatPartner.id;
                        const chatId = [user1, user2].sort().join('_');
                        messageRef = doc(db, "conversations", chatId, "messages", messageId);
                    } else {
                        messageRef = doc(db, "conversations", currentGroupId, "messages", messageId);
                    }
                    
                    deletePromises.push(deleteDoc(messageRef));
                }
            });
            
            try {
                await Promise.all(deletePromises);
                showNotification(`${selectedMessages.size} message(s) supprimé(s)`, 'success');
                exitSelectionMode();
            } catch (error) {
                console.error('Erreur lors de la suppression des messages:', error);
                
                // Remove deleting animation on error
                messageContainers.forEach(container => {
                    const messageId = container.getAttribute('data-id');
                    if (selectedMessages.has(messageId)) {
                        container.classList.remove('deleting');
                    }
                });
                
                let errorMessage = 'Erreur lors de la suppression des messages';
                
                if (error.code === 'permission-denied') {
                    errorMessage = 'Vous n\'avez pas les permissions pour supprimer ces messages';
                } else if (error.code === 'unavailable') {
                    errorMessage = 'Service temporairement indisponible';
                }
                
                showNotification(errorMessage, 'error');
                addDebugLog(`Erreur suppression messages: ${error.code} - ${error.message}`, 'error');
            }
        }
        
        function setupUIEvents() {
            // Debug panel setup
            document.getElementById('debug-toggle-btn').addEventListener('click', function() {
                debugPanelVisible = !debugPanelVisible;
                const panel = document.getElementById('debug-log-panel');
                if (debugPanelVisible) {
                    panel.classList.add('active');
                    updateDebugPanel();
                } else {
                    panel.classList.remove('active');
                }
            });

            document.getElementById('debug-log-close').addEventListener('click', function() {
                debugPanelVisible = false;
                document.getElementById('debug-log-panel').classList.remove('active');
            });

            // Selection system events
            document.getElementById('selection-copy-btn').addEventListener('click', copySelectedMessages);
            document.getElementById('selection-reply-btn').addEventListener('click', replyToSelectedMessage);
            document.getElementById('selection-delete-btn').addEventListener('click', deleteSelectedMessages);
            document.getElementById('selection-cancel-btn').addEventListener('click', exitSelectionMode);

            document.getElementById('header-menu-button').addEventListener('click', function() {
                document.getElementById('side-menu').classList.add('active');
                document.getElementById('side-menu-overlay').classList.add('active');
            });
            
            document.getElementById('side-menu-close').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
            });
            
            document.getElementById('side-menu-overlay').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
            });
            
            document.getElementById('menu-profile').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showProfileSection();
            });

            document.getElementById('menu-subscription').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showSubscriptionSection();
            });

            document.getElementById('menu-tutorials').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showTutorialsSection();
            });
            
            document.getElementById('menu-interface').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showInterfaceSection();
            });
            
            document.getElementById('menu-terms').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showTermsDialog();
            });
            
            document.getElementById('terms-back').addEventListener('click', hideTermsDialog);
            
            document.getElementById('menu-about').addEventListener('click', function() {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                showAboutDialog();
            });
            
            document.getElementById('about-back').addEventListener('click', hideAboutDialog);
            
            document.getElementById('search-button').addEventListener('click', function() {
                toggleSearchBar();
            });
            
            document.getElementById('search-close').addEventListener('click', function() {
                hideSearchBar();
            });
            
            document.getElementById('search-input').addEventListener('input', function() {
                handleSearch(this.value);
            });
            
            document.getElementById('events-button').addEventListener('click', function() {
                showEventsSection();
                updateLastViewedEventTimestamp();
                hideEventNotificationDot();
            });
            
            document.getElementById('close-events-btn').addEventListener('click', function() {
                if (currentSection === 'events') {
                    showDiscussionsSection();
                }
            });

            document.getElementById('close-subscription-btn').addEventListener('click', function() {
                if (currentSection === 'subscription') {
                    showDiscussionsSection();
                }
            });

            document.getElementById('close-tutorials-btn').addEventListener('click', function() {
                if (currentSection === 'tutorials') {
                    showDiscussionsSection();
                }
            });
            
            document.getElementById('close-interface-btn').addEventListener('click', function() {
                if (currentSection === 'interface') {
                    showDiscussionsSection();
                }
            });
            
            document.getElementById('group-info-back').addEventListener('click', hideGroupInfoDialog);
            
            document.getElementById('bottom-nav').addEventListener('click', function(e) {
                const navItems = this.querySelectorAll('.nav-item');
                
                for (let i = 0; i < navItems.length; i++) {
                    const item = navItems[i];
                    const rect = item.getBoundingClientRect();
                    
                    if (e.clientX >= rect.left && e.clientX <= rect.right &&
                        e.clientY >= rect.top && e.clientY <= rect.bottom) {
                        
                        const section = item.getAttribute('data-section');
                        if (section === 'discussions') {
                            showDiscussionsSection();
                        } else if (section === 'forecasts') {
                            showForecastsSection();
                        } else if (section === 'users') {
                            showUsersSection();
                        }
                        
                        break;
                    }
                }
            });

            // Tutorial video events
            document.querySelectorAll('.tutorial-thumbnail').forEach(thumbnail => {
                thumbnail.addEventListener('click', function() {
                    const videoType = this.getAttribute('data-video');
                    playTutorialVideo(videoType);
                });
            });

            document.getElementById('video-close').addEventListener('click', closeVideoModal);

            // Subscription plan events
            document.getElementById('daily-plan-btn').addEventListener('click', function() {
                showPlanConfirmation('daily');
            });

            document.getElementById('weekly-plan-btn').addEventListener('click', function() {
                showPlanConfirmation('weekly');
            });

            document.getElementById('plan-cancel').addEventListener('click', hidePlanConfirmation);
            document.getElementById('plan-confirm').addEventListener('click', function() {
                const planType = this.getAttribute('data-plan');
                hidePlanConfirmation();
                subscribeToPlan(planType);
            });
            
            document.querySelectorAll('.forecast-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchForecastTab(tabId);
                });
            });
            
            document.getElementById('dark-toggle').addEventListener('change', function() {
                if (this.checked) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                
                localStorage.setItem('parisAllianceDarkMode', this.checked ? 'true' : 'false');
            });
            
            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', function() {
                    const theme = this.getAttribute('data-theme');
                    selectedTheme = theme;
                    
                    document.documentElement.classList.remove('theme-green', 'theme-red', 'theme-orange', 'theme-red-pink', 'theme-green-yellow', 'theme-blue-purple', 'theme-orange-gold');
                    
                    if (theme !== 'default') {
                        document.documentElement.classList.add(`theme-${theme}`);
                    }
                    
                    document.querySelectorAll('.theme-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    localStorage.setItem('parisAllianceTheme', theme);
                    
                    const themeNames = {
                        'default': 'Bleu',
                        'green': 'Vert',
                        'red': 'Rouge',
                        'orange': 'Orange',
                        'red-pink': 'Rouge-Rose',
                        'green-yellow': 'Vert-Jaune',
                        'blue-purple': 'Bleu-Violet',
                        'orange-gold': 'Orange-Doré'
                    };
                    
                    showNotification(`Thème ${themeNames[theme]} appliqué`, 'success');
                });
            });
            
            document.getElementById('logout-btn').addEventListener('click', showLogoutConfirmation);
            document.getElementById('logout-cancel').addEventListener('click', hideLogoutConfirmation);
            document.getElementById('logout-confirm').addEventListener('click', logoutUser);
            
            document.getElementById('delete-account-btn').addEventListener('click', showDeleteAccountConfirmation);
            
            document.getElementById('delete-account-cancel').addEventListener('click', hideDeleteAccountConfirmation);
            document.getElementById('delete-account-confirm').addEventListener('click', deleteAccount);
            
            document.getElementById('edit-profile-btn').addEventListener('click', showProfileEditDialog);
            document.getElementById('edit-profile-pic').addEventListener('click', showProfileEditDialog);
            
            document.getElementById('profile-edit-back').addEventListener('click', hideProfileEditDialog);
            document.getElementById('profile-upload-btn').addEventListener('click', function() {
                document.getElementById('profile-image-input').click();
            });
            
            document.getElementById('profile-image-input').addEventListener('change', handleProfileImageSelect);
            
            document.getElementById('save-display-name-btn').addEventListener('click', updateDisplayName);
            document.getElementById('save-profile-image-btn').addEventListener('click', updateProfileImage);
            
            document.getElementById('edit-display-name').addEventListener('input', function() {
                profileNameChanged = true;
                document.getElementById('save-display-name-btn').disabled = this.value.trim() === '';
            });
            
            const chatInput = document.getElementById('chat-input');
            chatInput.addEventListener('keyup', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            document.getElementById('reply-close').addEventListener('click', function() {
                cancelReply();
            });
            
            document.getElementById('send-button').addEventListener('click', sendMessage);
            
            document.getElementById('image-button').addEventListener('click', function() {
                document.getElementById('chat-image-input').click();
            });
            
            document.getElementById('chat-image-input').addEventListener('change', handleChatImageSelect);
            
            document.getElementById('viewer-close').addEventListener('click', closeImageViewer);
            document.getElementById('download-image-btn').addEventListener('click', downloadCurrentImage);
            
            document.getElementById('header-back-button').addEventListener('click', closeChat);
            
            document.getElementById('create-group-btn').addEventListener('click', function() {
                showCreateGroupDialog();
            });
            
            document.getElementById('create-group-back').addEventListener('click', hideCreateGroupDialog);
            document.getElementById('create-group-submit').addEventListener('click', createNewGroup);
            
            document.getElementById('create-notification-btn').addEventListener('click', function() {
                if (isAdmin) {
                    showAdminNotificationDialog();
                } else {
                    showNotification("Seuls les administrateurs peuvent envoyer des notifications", "error");
                }
            });
            
            document.getElementById('admin-notif-back').addEventListener('click', hideAdminNotificationDialog);
            document.getElementById('send-notification-btn').addEventListener('click', sendAdminNotification);
            
            document.getElementById('new-group-image-upload').addEventListener('click', function() {
                document.getElementById('new-group-image-input').click();
            });
            
            document.getElementById('new-group-image-input').addEventListener('change', handleNewGroupImageSelect);
            
            document.getElementById('edit-group-back').addEventListener('click', hideEditGroupDialog);
            
            document.getElementById('edit-group-image-upload').addEventListener('click', function() {
                document.getElementById('edit-group-image-input').click();
            });
            
            document.getElementById('edit-group-image-input').addEventListener('change', handleEditGroupImageSelect);
            
            document.getElementById('save-group-name-btn').addEventListener('click', updateGroupName);
            document.getElementById('save-group-description-btn').addEventListener('click', updateGroupDescription);
            document.getElementById('save-group-permissions-btn').addEventListener('click', updateGroupPermissions);
            document.getElementById('save-group-image-btn').addEventListener('click', updateGroupImage);
            
            document.getElementById('edit-group-name').addEventListener('input', function() {
                groupNameChanged = true;
                document.getElementById('save-group-name-btn').disabled = this.value.trim() === '';
            });
            
            document.getElementById('edit-group-description').addEventListener('input', function() {
                groupDescriptionChanged = true;
                document.getElementById('save-group-description-btn').disabled = false;
            });
            
            document.getElementById('edit-group-public-messages').addEventListener('change', function() {
                groupPermissionsChanged = true;
                document.getElementById('save-group-permissions-btn').disabled = false;
            });
            
            document.getElementById('delete-cancel').addEventListener('click', hideDeleteConfirmation);
            document.getElementById('delete-confirm').addEventListener('click', confirmDeleteSelectedMessages);
            
            document.getElementById('delete-event-cancel').addEventListener('click', hideDeleteEventConfirmation);
            document.getElementById('delete-event-confirm').addEventListener('click', confirmDeleteEvent);
            
            document.addEventListener('contextmenu', function(e) {
                if (e.target.tagName === 'IMG') {
                    e.preventDefault();
                    return false;
                }
            });
            
            document.addEventListener('touchstart', handleGlobalTouchStart, { passive: true });
            document.addEventListener('touchend', handleGlobalTouchEnd, { passive: true });
            
            document.getElementById('whatsapp-btn').addEventListener('click', function() {
                openSocialLink('whatsapp');
            });
            
            document.getElementById('telegram-btn').addEventListener('click', function() {
                openSocialLink('telegram');
            });
            
            document.getElementById('youtube-btn').addEventListener('click', function() {
                openSocialLink('youtube');
            });
            
            const touchableElements = document.querySelectorAll('.menu-button, .back-button, .search-button, .events-button, .info-button, .search-close');
            touchableElements.forEach(element => {
                element.addEventListener('touchstart', createRippleEffect);
            });
            
            window.addEventListener('popstate', handleBackButton);
            
            history.pushState({ page: 'main' }, '');
        }
        
        function handleBackButton(event) {
            event.preventDefault();
            
            if (isSelectionMode) {
                exitSelectionMode();
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            if (document.querySelector('.confirmation-dialog.active')) {
                document.querySelectorAll('.confirmation-dialog.active').forEach(dialog => {
                    const cancelBtn = dialog.querySelector('.confirmation-cancel');
                    if (cancelBtn) cancelBtn.click();
                });
                history.pushState({ page: 'main' }, '');
                return;
            }

            if (document.getElementById('video-modal').classList.contains('active')) {
                closeVideoModal();
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            if (isSearchActive) {
                hideSearchBar();
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            if (document.getElementById('side-menu').classList.contains('active')) {
                document.getElementById('side-menu').classList.remove('active');
                document.getElementById('side-menu-overlay').classList.remove('active');
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            if (document.getElementById('chat-interface').style.display === 'block') {
                closeChat();
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            if (currentSection !== 'discussions') {
                showDiscussionsSection();
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            const dialogs = [
                { id: 'about-dialog', backBtn: 'about-back' },
                { id: 'terms-dialog', backBtn: 'terms-back' },
                { id: 'profile-edit-dialog', backBtn: 'profile-edit-back' },
                { id: 'edit-group-dialog', backBtn: 'edit-group-back' },
                { id: 'create-group-dialog', backBtn: 'create-group-back' },
                { id: 'admin-notif-dialog', backBtn: 'admin-notif-back' },
                { id: 'group-info-dialog', backBtn: 'group-info-back' }
            ];
            
            for (const dialog of dialogs) {
                if (document.getElementById(dialog.id).classList.contains('active')) {
                    document.getElementById(dialog.backBtn).click();
                    history.pushState({ page: 'main' }, '');
                    return;
                }
            }
            
            if (document.getElementById('image-viewer').classList.contains('active')) {
                closeImageViewer();
                history.pushState({ page: 'main' }, '');
                return;
            }
            
            if (currentSection === 'discussions') {
                history.pushState({ page: 'main' }, '');
            }
        }
        
        function handleGlobalTouchStart(e) {
            if (!isSelectionMode && currentSection === 'chat') {
                const messageContainer = e.target.closest('.message-container');
                if (messageContainer) {
                    // Long press to enter selection mode
                    const longPressTimer = setTimeout(() => {
                        enterSelectionMode();
                        handleMessageSelection({ 
                            currentTarget: messageContainer, 
                            preventDefault: () => {}, 
                            stopPropagation: () => {} 
                        });
                    }, 800);
                    
                    // Store timer on element
                    messageContainer._longPressTimer = longPressTimer;
                }
            }
        }
        
        function handleGlobalTouchEnd(e) {
            const messageContainer = e.target.closest('.message-container');
            if (messageContainer && messageContainer._longPressTimer) {
                clearTimeout(messageContainer._longPressTimer);
                delete messageContainer._longPressTimer;
            }
        }
        
        function cancelReply() {
            replyingToMessage = null;
            const replyPreview = document.getElementById('reply-preview');
            replyPreview.classList.remove('active');
            
            const chatInputContainer = document.getElementById('chat-input-container');
            chatInputContainer.classList.remove('with-reply');
            
            if (autoResizeTextarea) {
                autoResizeTextarea();
            }
        }
        
        function createRippleEffect(e) {
            const button = e.currentTarget;
            const circle = document.createElement('span');
            const diameter = Math.max(button.clientWidth, button.clientHeight);
            
            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${e.touches[0].pageX - button.offsetLeft - diameter / 2}px`;
            circle.style.top = `${e.touches[0].pageY - button.offsetTop - diameter / 2}px`;
            circle.classList.add('ripple');
            
            const ripple = button.querySelector('.ripple');
            if (ripple) {
                ripple.remove();
            }
            
            button.appendChild(circle);
            
            setTimeout(() => {
                circle.remove();
            }, 600);
        }
        
        function toggleSearchBar() {
            const searchContainer = document.getElementById('search-container');
            const searchInput = document.getElementById('search-input');
            const header = document.querySelector('.header');
            
            if (isSearchActive) {
                hideSearchBar();
            } else {
                header.classList.add('search-active');
                searchContainer.classList.add('active');
                searchInput.focus();
                isSearchActive = true;
                
                history.pushState({ page: 'search' }, '');
                
                currentSearchContext = currentSection;
                
                if (currentSearchContext === 'discussions') {
                    searchInput.placeholder = 'Rechercher une discussion...';
                } else if (currentSearchContext === 'events') {
                    searchInput.placeholder = 'Rechercher un événement...';
                } else if (currentSearchContext === 'users') {
                    searchInput.placeholder = 'Rechercher un utilisateur...';
                } else if (currentSearchContext === 'forecasts') {
                    searchInput.placeholder = 'Rechercher un pronostic...';
                }
            }
        }
        
        function hideSearchBar() {
            const searchContainer = document.getElementById('search-container');
            const searchInput = document.getElementById('search-input');
            const header = document.querySelector('.header');
            
            searchContainer.classList.remove('active');
            searchContainer.classList.add('hiding');
            
            setTimeout(() => {
                header.classList.remove('search-active');
                searchInput.value = '';
                searchContainer.classList.remove('hiding');
                isSearchActive = false;
                
                handleSearch('');
            }, 300);
        }
        
        function handleSearch(query) {
            if (currentSearchContext === 'discussions') {
                filterDiscussions(query);
            } else if (currentSearchContext === 'events') {
                filterEvents(query);
            } else if (currentSearchContext === 'users') {
                filterUsers(query);
            }
        }
        
        function openSocialLink(platform) {
            let url = '';
            
            switch(platform) {
                case 'whatsapp':
                    url = 'https://wa.me/';
                    showNotification('Ouverture de WhatsApp', 'info');
                    break;
                case 'telegram':
                    url = 'https://t.me/';
                    showNotification('Ouverture de Telegram', 'info');
                    break;
                case 'youtube':
                    url = 'https://www.youtube.com/';
                    showNotification('Ouverture de YouTube', 'info');
                    break;
                default:
                    return;
            }
            
            window.open(url, '_blank', 'noopener,noreferrer');
        }
        
        function showTermsDialog() {
            document.getElementById('terms-dialog').classList.add('active');
            history.pushState({ page: 'terms' }, '');
        }
        
        function hideTermsDialog() {
            document.getElementById('terms-dialog').classList.remove('active');
        }
        
        function showAboutDialog() {
            document.getElementById('about-dialog').classList.add('active');
            history.pushState({ page: 'about' }, '');
        }
        
        function hideAboutDialog() {
            document.getElementById('about-dialog').classList.remove('active');
        }

        function showSubscriptionSection() {
            hideSearchBar();
            exitSelectionMode();
            
            currentSection = 'subscription';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('subscription-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Abonnement';
            
            document.getElementById('header-menu-button').style.display = 'none';
            document.getElementById('header-back-button').style.display = 'block';
            
            document.getElementById('header-action').innerHTML = '';
            
            document.getElementById('header-back-button').addEventListener('click', function() {
                showDiscussionsSection();
            });

            document.getElementById('bottom-nav').style.display = 'none';
            document.querySelector('.content').classList.add('no-bottom-nav');
            
            loadUserSubscriptionData();
            
            history.pushState({ page: 'subscription' }, '');
        }

        function showTutorialsSection() {
            hideSearchBar();
            exitSelectionMode();
            
            currentSection = 'tutorials';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('tutorials-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Tutoriels';
            
            document.getElementById('header-menu-button').style.display = 'none';
            document.getElementById('header-back-button').style.display = 'block';
            
            document.getElementById('header-action').innerHTML = '';
            
            document.getElementById('header-back-button').addEventListener('click', function() {
                showDiscussionsSection();
            });

            document.getElementById('bottom-nav').style.display = 'none';
            document.querySelector('.content').classList.add('no-bottom-nav');
            
            history.pushState({ page: 'tutorials' }, '');
        }
        
        function showGroupInfoDialog() {
            if (!currentGroupData) return;
            
            const dialog = document.getElementById('group-info-dialog');
            const imagePreview = document.getElementById('info-group-image-preview');
            const nameElement = document.getElementById('info-group-name');
            const descriptionElement = document.getElementById('info-group-description');
            const typeElement = document.getElementById('info-group-type');
            const imagesContainer = document.getElementById('info-group-images');
            
            nameElement.textContent = currentGroupData.name || 'Sans nom';
            descriptionElement.textContent = currentGroupData.description || 'Sans description';
            typeElement.textContent = currentGroupData.allowPublicMessages !== false ? 
                'Public (Tous peuvent écrire)' : 'Restreint (Écriture limitée aux administrateurs)';
            
            if (currentGroupData.imageURL) {
                imagePreview.innerHTML = `<img src="${currentGroupData.imageURL}" alt="${currentGroupData.name}">`;
            } else {
                imagePreview.innerHTML = `<i class="fas fa-users" style="color: white; font-size: 40px;"></i>`;
            }
            
            imagesContainer.innerHTML = '<div class="group-info-image-empty">Chargement des images...</div>';
            
            loadGroupImages();
            
            dialog.classList.add('active');
            history.pushState({ page: 'group-info' }, '');
        }
        
        function hideGroupInfoDialog() {
            document.getElementById('group-info-dialog').classList.remove('active');
        }
        
        async function loadGroupImages() {
            if (!currentGroupId) return;
            
            const imagesContainer = document.getElementById('info-group-images');
            
            try {
                if (groupImageCache[currentGroupId] && groupImageCache[currentGroupId].length > 0) {
                    displayGroupImages(groupImageCache[currentGroupId]);
                    return;
                }
                
                const messagesRef = collection(db, "conversations", currentGroupId, "messages");
                const q = query(messagesRef, where("imageData", "!=", null));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    imagesContainer.innerHTML = '<div class="group-info-image-empty">Aucune image partagée</div>';
                    return;
                }
                
                const images = [];
                querySnapshot.forEach(doc => {
                    const messageData = doc.data();
                    if (messageData.imageData) {
                        images.push({
                            url: messageData.imageData,
                            id: doc.id,
                            timestamp: messageData.createdAt
                        });
                    }
                });
                
                images.sort((a, b) => {
                    if (a.timestamp && b.timestamp) {
                        return b.timestamp.seconds - a.timestamp.seconds;
                    }
                    return 0;
                });
                
                groupImageCache[currentGroupId] = images;
                
                displayGroupImages(images);
                
            } catch (error) {
                const errorMsg = handleFirestoreError(error, 'chargement des images du groupe');
                imagesContainer.innerHTML = '<div class="group-info-image-empty">Erreur lors du chargement des images</div>';
            }
        }
        
        function displayGroupImages(images) {
            const imagesContainer = document.getElementById('info-group-images');
            
            if (!images || images.length === 0) {
                imagesContainer.innerHTML = '<div class="group-info-image-empty">Aucune image partagée</div>';
                return;
            }
            
            imagesContainer.innerHTML = '';
            
            const imagesToShow = images.slice(0, 9);
            
            imagesToShow.forEach(image => {
                const imageElement = document.createElement('div');
                imageElement.className = 'group-info-image';
                imageElement.innerHTML = `<img src="${image.url}" alt="Image partagée">`;
                
                imageElement.addEventListener('click', () => {
                    showImageViewer(image.url);
                });
                
                imagesContainer.appendChild(imageElement);
            });
        }
        
        function showImageViewer(imageUrl) {
            const viewer = document.getElementById('image-viewer');
            const viewerImage = document.getElementById('viewer-image');
            viewerImage.src = imageUrl;
            viewer.classList.add('active');
            
            currentDownloadImage = imageUrl;
            
            history.pushState({ page: 'image-viewer' }, '');
        }
        
        function closeImageViewer() {
            const viewer = document.getElementById('image-viewer');
            viewer.classList.remove('active');
            setTimeout(() => {
                document.getElementById('viewer-image').src = '';
                currentDownloadImage = '';
            }, 300);
        }
        
        function downloadCurrentImage() {
            if (!currentDownloadImage) return;
            
            try {
                const a = document.createElement('a');
                a.href = currentDownloadImage;
                a.download = 'image_' + new Date().getTime() + '.jpg';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                showNotification('Téléchargement démarré', 'success');
            } catch (error) {
                showNotification('Erreur lors du téléchargement de l\'image', 'error');
            }
        }
        
        async function handleChatImageSelect(e) {
            const file = e.target.files[0];
            if (!file || !file.type.match('image.*')) {
                showNotification('Veuillez sélectionner une image valide', 'error');
                return;
            }
            
            try {
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('L\'image est trop volumineuse (max 5 Mo)', 'error');
                    return;
                }
                
                showNotification('Préparation de l\'image...', 'info');
                
                const optimizedImage = await optimizeImage(file, 800);
                const base64Image = await encodeImageToBase64(optimizedImage);
                chatImageFile = base64Image;
                
                const inputField = document.getElementById('chat-input');
                if (inputField) {
                    inputField.placeholder = 'Ajoutez un commentaire à l\'image (optionnel)';
                    inputField.focus();
                }
                
                const imageButton = document.getElementById('image-button');
                if (imageButton) {
                    imageButton.style.color = 'var(--success-color)';
                }
                
                showNotification('Image prête à être envoyée', 'success');
            } catch (error) {
                console.error('Erreur lors du traitement de l\'image:', error);
                showNotification('Erreur lors du traitement de l\'image', 'error');
                chatImageFile = null;
            }
            
            document.getElementById('chat-image-input').value = '';
        }
        
        function optimizeImage(file, maxDimension) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = function() {
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > maxDimension || height > maxDimension) {
                        if (width > height) {
                            height = Math.round(height * (maxDimension / width));
                            width = maxDimension;
                        } else {
                            width = Math.round(width * (maxDimension / height));
                            height = maxDimension;
                        }
                    }
                    
                    const canvas = document.createElement('canvas');
                    canvas.width = width;
                    canvas.height = height;
                    
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    canvas.toBlob(
                        blob => {
                            if (blob) {
                                resolve(blob);
                            } else {
                                reject(new Error('Échec de la conversion en Blob'));
                            }
                        }, 
                        file.type, 
                        0.8
                    );
                };
                
                img.onerror = function() {
                    reject(new Error('Échec du chargement de l\'image'));
                };
                
                img.src = URL.createObjectURL(file);
            });
        }
        
        function switchForecastTab(tabId) {
            currentForecastTab = tabId;
            
            document.querySelectorAll('.forecast-tab').forEach(tab => {
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            document.querySelectorAll('.forecasts-content').forEach(content => {
                if (content.id === `${tabId}-content`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
            
            loadForecastsData(tabId);
        }
        
        function showDiscussionsSection() {
            if (document.getElementById('chat-interface').style.display === 'block') {
                closeChat();
                return;
            }
            
            hideSearchBar();
            exitSelectionMode();
            
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.getAttribute('data-section') === 'discussions') {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            document.getElementById('header-menu-button').style.display = 'block';
            document.getElementById('header-back-button').style.display = 'none';
            
            currentSection = 'discussions';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('discussions-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Discussions';
            
            document.getElementById('header-action').innerHTML = `
                <div class="search-button" id="search-button">
                    <i class="fas fa-search"></i>
                </div>
                <div class="events-button" id="events-button">
                    <i class="fas fa-bell"></i>
                    <div class="notification-dot" id="events-notification-dot"></div>
                </div>
            `;
            
            if (hasNewEvents) {
                document.getElementById('events-notification-dot').classList.add('active');
            }
            
            document.getElementById('search-button').addEventListener('click', toggleSearchBar);
            document.getElementById('events-button').addEventListener('click', function() {
                showEventsSection();
                updateLastViewedEventTimestamp();
                hideEventNotificationDot();
            });

            document.getElementById('bottom-nav').style.display = 'flex';
            document.querySelector('.content').classList.remove('no-bottom-nav');
            
            // Charger les discussions seulement si elles n'ont pas déjà été chargées
            if (!discussionsLoaded) {
                loadDiscussions();
            }
        }
        
        function showUsersSection() {
            if (document.getElementById('chat-interface').style.display === 'block') {
                closeChat();
            }
            
            hideSearchBar();
            exitSelectionMode();
            
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.getAttribute('data-section') === 'users') {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            document.getElementById('header-menu-button').style.display = 'block';
            document.getElementById('header-back-button').style.display = 'none';
            
            currentSection = 'users';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('users-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Utilisateurs';
            
            document.getElementById('header-action').innerHTML = `
                <div class="search-button" id="search-button">
                    <i class="fas fa-search"></i>
                </div>
                <div class="events-button" id="events-button">
                    <i class="fas fa-bell"></i>
                    <div class="notification-dot" id="events-notification-dot"></div>
                </div>
            `;
            
            if (hasNewEvents) {
                document.getElementById('events-notification-dot').classList.add('active');
            }
            
            document.getElementById('search-button').addEventListener('click', toggleSearchBar);
            document.getElementById('events-button').addEventListener('click', function() {
                showEventsSection();
                updateLastViewedEventTimestamp();
                hideEventNotificationDot();
            });

            document.getElementById('bottom-nav').style.display = 'flex';
            document.querySelector('.content').classList.remove('no-bottom-nav');
            
            loadUsers();
            
            history.pushState({ page: 'users' }, '');
        }
        
        function showInterfaceSection() {
            hideSearchBar();
            exitSelectionMode();
            
            currentSection = 'interface';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('interface-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Interface';
            
            document.getElementById('header-menu-button').style.display = 'none';
            document.getElementById('header-back-button').style.display = 'block';
            
            document.getElementById('header-action').innerHTML = '';
            
            document.getElementById('header-back-button').addEventListener('click', function() {
                showDiscussionsSection();
            });

            document.getElementById('bottom-nav').style.display = 'none';
            document.querySelector('.content').classList.add('no-bottom-nav');
            
            setupTheme();
            
            history.pushState({ page: 'interface' }, '');
        }
        
        function isDateTodayOrTomorrow(date) {
            if (!date) return false;

            let forecastDate;
            if (date.toDate) {
                forecastDate = date.toDate();
            } else if (date instanceof Date) {
                forecastDate = date;
            } else {
                return false;
            }

            const today = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(today.getDate() + 1);

            return (
                (forecastDate.getFullYear() === today.getFullYear() && 
                 forecastDate.getMonth() === today.getMonth() && 
                 forecastDate.getDate() === today.getDate()) ||
                (forecastDate.getFullYear() === tomorrow.getFullYear() && 
                 forecastDate.getMonth() === tomorrow.getMonth() && 
                 forecastDate.getDate() === tomorrow.getDate())
            );
        }
        
        async function loadForecastsData(tabType) {
            if (forecastsCache[tabType]) {
                displayForecastsFromCache(tabType);
                return;
            }
            
            const listElement = document.getElementById(`${tabType}-list`);
            if (!listElement) return;
            
            listElement.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 30px; color: var(--primary-color);"></i>
                    <div style="margin-top: 10px; font-weight: bold;">Chargement des pronostics...</div>
                </div>
            `;
            
            try {
                // Fetch forecasts from GitHub
                const githubData = await fetchForecastsFromGitHub();
                
                if (!githubData) {
                    listElement.innerHTML = `
                        <div class="no-forecasts">
                            <i class="fas fa-calendar-day"></i>
                            <div class="empty-state-title">Pas de pronostics aujourd'hui</div>
                            <div class="empty-state-text">Aucun pronostic disponible pour aujourd'hui (${getCurrentDateString()})</div>
                        </div>
                    `;
                    return;
                }
                
                // Process and categorize the data
                const processedData = processForecastData(githubData);
                
                // Cache the processed data
                Object.keys(processedData).forEach(type => {
                    forecastsCache[type] = processedData[type];
                });
                
                displayForecastsFromCache(tabType);
                
            } catch (error) {
                addDebugLog(`Erreur chargement pronostics: ${error.message}`, 'error');
                listElement.innerHTML = `
                    <div class="no-forecasts">
                        <i class="fas fa-exclamation-circle"></i>
                        <div class="empty-state-title">Erreur</div>
                        <div class="empty-state-text">Impossible de charger les pronostics depuis GitHub</div>
                    </div>
                `;
            }
        }
        
        function displayForecastsFromCache(tabType) {
            const listElement = document.getElementById(`${tabType}-list`);
            if (!listElement || !forecastsCache[tabType]) return;
            
            listElement.innerHTML = '';
            
            const forecasts = forecastsCache[tabType];
            
            if (forecasts.length === 0) {
                listElement.innerHTML = `
                    <div class="no-forecasts">
                        <i class="fas fa-futbol"></i>
                        <div class="empty-state-title">Aucun pronostic</div>
                        <div class="empty-state-text">Aucun pronostic disponible pour cette catégorie</div>
                    </div>
                `;
                return;
            }
            
            const fragment = document.createDocumentFragment();
            
            forecasts.forEach((forecastData) => {
                const forecastElement = createForecastElement(forecastData, tabType);
                fragment.appendChild(forecastElement);
            });
            
            listElement.appendChild(fragment);
        }
        
        function createForecastElement(forecastData, type) {
            const forecastElement = document.createElement('div');
            forecastElement.className = 'forecast-item';
            
            let statusClass = 'pending';
            let statusText = 'À venir';
            
            if (forecastData.status === 'win') {
                statusClass = 'win';
                statusText = 'Gagné';
            } else if (forecastData.status === 'loss') {
                statusClass = 'loss';
                statusText = 'Perdu';
            }
            
            let formattedDate = 'Aujourd\'hui';
            if (forecastData.date) {
                // Parse the date string from GitHub format
                const dateStr = forecastData.date;
                if (dateStr.includes('UTC')) {
                    // Parse "10 juin 2025 à 12:00:00 UTC" format
                    const dateParts = dateStr.split(' à ');
                    if (dateParts.length === 2) {
                        const timePart = dateParts[1].replace(' UTC', '');
                        formattedDate = `${dateParts[0]} à ${timePart}`;
                    }
                } else {
                    formattedDate = dateStr;
                }
            }
            
            let mainContent = '';
            
            if (type === 'safes') {
                mainContent = `
                    <div class="forecast-header">
                        <div>${forecastData.league || 'Compétition'}</div>
                        <div class="forecast-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="forecast-match">
                        <div class="forecast-team">
                            <div class="forecast-team-logo">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="forecast-team-name">${forecastData.HomeTeam || 'Équipe 1'}</div>
                        </div>
                        <div class="forecast-score">VS</div>
                        <div class="forecast-team">
                            <div class="forecast-team-logo">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="forecast-team-name">${forecastData.AwayTeam || 'Équipe 2'}</div>
                        </div>
                    </div>
                    <div style="text-align: center; font-weight: bold; margin: 10px 0;">
                        Pronostic: ${forecastData.prediction || 'N/A'}
                    </div>
                `;
            } else if (type === 'exact') {
                mainContent = `
                    <div class="forecast-header">
                        <div>${forecastData.league || 'Compétition'}</div>
                        <div class="forecast-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="forecast-match">
                        <div class="forecast-team">
                            <div class="forecast-team-logo">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="forecast-team-name">${forecastData.HomeTeam || 'Équipe 1'}</div>
                        </div>
                        <div class="forecast-score">VS</div>
                        <div class="forecast-team">
                            <div class="forecast-team-logo">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="forecast-team-name">${forecastData.AwayTeam || 'Équipe 2'}</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin: 10px 0;">
                        <div style="font-weight: bold; margin-bottom: 5px;">Score exact recommandé:</div>
                        <div class="score-options">
                            <div class="score-option active">${forecastData.prediction || 'N/A'}</div>
                        </div>
                    </div>
                `;
            } else if (type === 'ai') {
                mainContent = `
                    <div class="forecast-header">
                        <div>${forecastData.league || 'Compétition'}</div>
                        <div class="forecast-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="forecast-match">
                        <div class="forecast-team">
                            <div class="forecast-team-logo">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="forecast-team-name">${forecastData.HomeTeam || 'Équipe 1'}</div>
                        </div>
                        <div class="forecast-score">VS</div>
                        <div class="forecast-team">
                            <div class="forecast-team-logo">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div class="forecast-team-name">${forecastData.AwayTeam || 'Équipe 2'}</div>
                        </div>
                    </div>
                    <div style="text-align: center; font-weight: bold; margin: 10px 0;">
                        Prédiction IA: ${forecastData.prediction || 'N/A'}
                    </div>
                    <div style="font-size: 13px; margin-top: 10px; font-style: italic;">
                        "Analyse basée sur les performances récentes et les statistiques avancées"
                    </div>
                `;
            }
            
            const confidence = forecastData.confidence || 75;
            const confidenceBar = `
                <div class="forecast-confidence">
                    <span>Confiance:</span>
                    <div class="confidence-bar-container">
                        <div class="confidence-bar" style="width: ${confidence}%"></div>
                    </div>
                    <span>${confidence}%</span>
                </div>
            `;
            
            const footer = `
                <div class="forecast-date">${formattedDate}</div>
            `;
            
            forecastElement.innerHTML = mainContent + confidenceBar + footer;
            return forecastElement;
        }
        
        function showForecastsSection() {
            if (document.getElementById('chat-interface').style.display === 'block') {
                closeChat();
            }
            
            hideSearchBar();
            exitSelectionMode();
            
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.getAttribute('data-section') === 'forecasts') {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            document.getElementById('header-menu-button').style.display = 'block';
            document.getElementById('header-back-button').style.display = 'none';
            
            currentSection = 'forecasts';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('forecasts-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Pronostics';
            
            document.getElementById('header-action').innerHTML = `
                <div class="search-button" id="search-button">
                    <i class="fas fa-search"></i>
                </div>
                <div class="events-button" id="events-button">
                    <i class="fas fa-bell"></i>
                    <div class="notification-dot" id="events-notification-dot"></div>
                </div>
            `;
            
            if (hasNewEvents) {
                document.getElementById('events-notification-dot').classList.add('active');
            }
            
            document.getElementById('search-button').addEventListener('click', toggleSearchBar);
            document.getElementById('events-button').addEventListener('click', function() {
                showEventsSection();
                updateLastViewedEventTimestamp();
                hideEventNotificationDot();
            });

            document.getElementById('bottom-nav').style.display = 'flex';
            document.querySelector('.content').classList.remove('no-bottom-nav');
            
            loadForecastsData(currentForecastTab);
        }
        
        function showEventsSection() {
            if (document.getElementById('chat-interface').style.display === 'block') {
                closeChat();
            }
            
            hideSearchBar();
            exitSelectionMode();
            
            currentSection = 'events';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('events-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Événements';
            
            document.getElementById('header-menu-button').style.display = 'block';
            document.getElementById('header-back-button').style.display = 'none';
            
            document.getElementById('header-action').innerHTML = `
                <div class="search-button" id="search-button">
                    <i class="fas fa-search"></i>
                </div>
            `;
            
            document.getElementById('search-button').addEventListener('click', toggleSearchBar);
            
            const createNotifBtn = document.getElementById('create-notification-btn');
            if (createNotifBtn) {
                if (isAdmin) {
                    createNotifBtn.style.display = 'flex';
                } else {
                    createNotifBtn.style.display = 'none';
                }
            }
            
            document.getElementById('bottom-nav').style.display = 'none';
            document.querySelector('.content').classList.add('no-bottom-nav');
            
            listenToEvents();
            
            history.pushState({ page: 'events' }, '');
        }
        
        function showProfileSection() {
            if (document.getElementById('chat-interface').style.display === 'block') {
                closeChat();
            }
            
            hideSearchBar();
            exitSelectionMode();
            
            currentSection = 'profile';
            
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById('profile-section').classList.add('active');
            
            document.getElementById('header-title').textContent = 'Profil';
            
            document.getElementById('header-menu-button').style.display = 'none';
            document.getElementById('header-back-button').style.display = 'block';
            
            document.getElementById('header-action').innerHTML = '';
            
            document.getElementById('header-back-button').addEventListener('click', function() {
                showDiscussionsSection();
            });

            document.getElementById('bottom-nav').style.display = 'none';
            document.querySelector('.content').classList.add('no-bottom-nav');
            
            history.pushState({ page: 'profile' }, '');
        }
        
        async function updateDisplayName() {
            if (!profileNameChanged) return;
            
            const displayName = document.getElementById('edit-display-name').value.trim();
            
            if (!displayName) {
                document.getElementById('edit-display-name-error').style.display = 'block';
                return;
            } else {
                document.getElementById('edit-display-name-error').style.display = 'none';
            }
            
            document.getElementById('save-display-name-btn').disabled = true;
            
            try {
                const userRef = doc(db, "Users", currentUser.uid);
                await updateDoc(userRef, {
                    displayName: displayName
                });
                
                currentUserData.displayName = displayName;
                
                updateProfileInfo();
                
                showNotification('Nom d\'utilisateur mis à jour', 'success');
                profileNameChanged = false;
            } catch (error) {
                handleFirestoreError(error, 'mise à jour du nom d\'utilisateur');
                showNotification('Erreur lors de la mise à jour du nom d\'utilisateur', 'error');
            } finally {
                document.getElementById('save-display-name-btn').disabled = false;
            }
        }
        
        async function updateProfileImage() {
            if (!profileImageFile) {
                showNotification('Aucune nouvelle image sélectionnée', 'info');
                return;
            }
            
            setButtonLoading('save-profile-image-btn', true);
            
            try {
                const userRef = doc(db, "Users", currentUser.uid);
                await updateDoc(userRef, {
                    photoURL: profileImageFile
                });
                
                currentUserData.photoURL = profileImageFile;
                
                updateProfileInfo();
                
                showNotification('Photo de profil mise à jour', 'success');
                profileImageFile = null;
                
                const imageButton = document.getElementById('save-profile-image-btn');
                imageButton.textContent = 'Image enregistrée';
                setTimeout(() => {
                    if (imageButton.querySelector('.btn-text')) {
                        imageButton.querySelector('.btn-text').textContent = 'Enregistrer la photo';
                    }
                }, 2000);
                
            } catch (error) {
                handleFirestoreError(error, 'mise à jour de la photo de profil');
                showNotification('Erreur lors de la mise à jour de la photo de profil', 'error');
            } finally {
                setButtonLoading('save-profile-image-btn', false);
            }
        }
        
        function handleProfileImageSelect(e) {
            const file = e.target.files[0];
            if (!file || !file.type.match('image.*')) {
                showNotification('Veuillez sélectionner une image valide', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showNotification('L\'image est trop volumineuse (max 5 Mo)', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const imagePreview = document.getElementById('profile-image-preview');
                imagePreview.innerHTML = `<img src="${e.target.result}" alt="Aperçu">`;
                profileImageFile = e.target.result;
                
                document.getElementById('save-profile-image-btn').disabled = false;
                showNotification('Image sélectionnée, cliquez sur "Enregistrer" pour confirmer', 'info');
            };
            reader.readAsDataURL(file);
        }
        
        function showProfileEditDialog() {
            const dialog = document.getElementById('profile-edit-dialog');
            const nameInput = document.getElementById('edit-display-name');
            const imagePreview = document.getElementById('profile-image-preview');
            
            nameInput.value = currentUserData?.displayName || '';
            
            if (currentUserData?.photoURL) {
                imagePreview.innerHTML = `<img src="${currentUserData.photoURL}" alt="Photo de profil">`;
            } else {
                imagePreview.innerHTML = `<i class="fas fa-user"></i>`;
            }
            
            profileImageFile = null;
            profileNameChanged = false;
            
            document.getElementById('save-display-name-btn').disabled = true;
            document.getElementById('save-profile-image-btn').disabled = true;
            
            dialog.classList.add('active');
            history.pushState({ page: 'profile-edit' }, '');
        }
        
        function hideProfileEditDialog() {
            document.getElementById('profile-edit-dialog').classList.remove('active');
        }
        
        function showLogoutConfirmation() {
            document.getElementById('logout-confirmation').classList.add('active');
            document.getElementById('overlay').classList.add('active');
            history.pushState({ page: 'logout-confirmation' }, '');
        }
        
        function hideLogoutConfirmation() {
            document.getElementById('logout-confirmation').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }
        
        function showDeleteAccountConfirmation() {
            document.getElementById('delete-account-confirmation').classList.add('active');
            document.getElementById('overlay').classList.add('active');
            history.pushState({ page: 'delete-account-confirmation' }, '');
        }
        
        function hideDeleteAccountConfirmation() {
            document.getElementById('delete-account-confirmation').classList.remove('active');
            document.getElementById('overlay').classList.remove('active');
        }
        
        async function deleteAccount() {
            hideDeleteAccountConfirmation();
            
            if (!currentUser) return;
            
            try {
                showNotification('Suppression du compte en cours...', 'info');
                
                const userRef = doc(db, "Users", currentUser.uid);
                await deleteDoc(userRef);
                
                await deleteUser(currentUser);
                
                showNotification('Compte supprimé avec succès', 'success');
                
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
                
            } catch (error) {
                console.error('Erreur lors de la suppression du compte:', error);
                
                let errorMessage = 'Erreur lors de la suppression du compte';
                
                if (error.code === 'auth/requires-recent-login') {
                    errorMessage = 'Veuillez vous reconnecter avant de supprimer votre compte';
                } else if (error.code === 'permission-denied') {
                    errorMessage = 'Permissions insuffisantes pour supprimer le compte';
                }
                
                showNotification(errorMessage, 'error');
            }
        }
        
        async function logoutUser() {
            hideLogoutConfirmation();
            
            try {
                Object.values(chatUnsubscribers).forEach(unsubscribe => {
                    if (typeof unsubscribe === 'function') {
                        unsubscribe();
                    }
                });
                chatUnsubscribers = {};
                
                if (eventsUnsubscribe) {
                    eventsUnsubscribe();
                    eventsUnsubscribe = null;
                }
                
                if (forecastsUnsubscribe) {
                    forecastsUnsubscribe();
                    forecastsUnsubscribe = null;
                }
                
                if (usersUnsubscribe) {
                    usersUnsubscribe();
                    usersUnsubscribe = null;
                }
                
                await signOut(auth);
                
                isLoggedIn = false;
                currentUser = null;
                currentUserData = null;
                isAdmin = false;
                discussionsLoaded = false;
                
                showNotification('Déconnexion réussie', 'success');
                
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
                
            } catch (error) {
                console.error('Erreur lors de la déconnexion:', error);
                showNotification('Erreur lors de la déconnexion', 'error');
            }
        }
        
        function updateProfileInfo() {
            if (!currentUserData) return;
            
            const profilePic = document.querySelector('.profile-header .profile-pic');
            const profileNameText = document.getElementById('profile-name-text');
            const profileEmail = document.getElementById('profile-email');
            const adminBadge = document.getElementById('admin-badge');
            
            if (profilePic) {
                if (currentUserData.photoURL) {
                    profilePic.innerHTML = `
                        <img src="${currentUserData.photoURL}" alt="Photo de profil">
                        <div class="profile-pic-edit" id="edit-profile-pic">
                            <i class="fas fa-pencil-alt"></i>
                        </div>
                    `;
                } else {
                    profilePic.innerHTML = `
                        <i class="fas fa-user"></i>
                        <div class="profile-pic-edit" id="edit-profile-pic">
                            <i class="fas fa-pencil-alt"></i>
                        </div>
                    `;
                }
                
                const editBtn = profilePic.querySelector('.profile-pic-edit');
                if (editBtn) {
                    editBtn.addEventListener('click', showProfileEditDialog);
                }
            }
            
            if (profileNameText) {
                profileNameText.textContent = currentUserData.displayName || 'Utilisateur';
            }
            
            if (profileEmail) {
                profileEmail.textContent = currentUser.email || 'Non défini';
            }
            
            if (adminBadge) {
                if (isAdmin) {
                    adminBadge.style.display = 'inline-block';
                } else {
                    adminBadge.style.display = 'none';
                }
            }
        }
        
        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            
            if (!text && !chatImageFile) return;
            
            if (processingMessage) return;
            processingMessage = true;
            
            const sendButton = document.getElementById('send-button');
            const imageButton = document.getElementById('image-button');
            
            sendButton.disabled = true;
            imageButton.disabled = true;
            
            try {
                if (currentChatPartner) {
                    await sendDirectMessage(
                        [currentUser.uid, currentChatPartner.id].sort().join('_'), 
                        text, 
                        chatImageFile,
                        replyingToMessage
                    );
                } else if (currentGroupId) {
                    await sendMessageToFirestore(currentGroupId, text, chatImageFile, replyingToMessage);
                }
                
                input.value = '';
                cancelReply();
                
                if (chatImageFile) {
                    chatImageFile = null;
                    imageButton.style.color = 'var(--primary-color)';
                    input.placeholder = 'Écrire un message...';
                }
                
                if (autoResizeTextarea) {
                    autoResizeTextarea();
                }
                
            } catch (error) {
                console.error('Erreur lors de l\'envoi du message:', error);
                showNotification('Erreur lors de l\'envoi du message', 'error');
            } finally {
                sendButton.disabled = false;
                imageButton.disabled = false;
                processingMessage = false;
            }
        }
        
        async function sendDirectMessage(chatId, text, imageData = null, replyTo = null) {
            if (!currentUser || !currentChatPartner) return;
            
            if (!isOnline) {
                messageQueue.push({
                    direct: true,
                    chatId: chatId,
                    text: text,
                    imageData: imageData,
                    replyTo: replyTo
                });
                showNotification('Message mis en file d\'attente (hors ligne)', 'info');
                return;
            }
            
            try {
                const messageData = {
                    text: text,
                    from: currentUser.uid,
                    createdAt: serverTimestamp(),
                    fromName: currentUserData?.displayName || 'Utilisateur'
                };
                
                if (imageData) {
                    messageData.imageData = imageData;
                }
                
                if (replyTo) {
                    messageData.replyTo = {
                        id: replyTo.id,
                        from: replyTo.from,
                        text: replyTo.text
                    };
                }
                
                const messagesRef = collection(db, "conversations", chatId, "messages");
                await addDoc(messagesRef, messageData);
                
                const conversationRef = doc(db, "conversations", chatId);
                const conversationData = {
                    lastMessage: text || 'Image',
                    lastMessageTime: serverTimestamp(),
                    lastMessageFrom: currentUser.uid,
                    participants: [currentUser.uid, currentChatPartner.id],
                    type: 'direct'
                };
                
                await setDoc(conversationRef, conversationData, { merge: true });
                
            } catch (error) {
                throw error;
            }
        }
        
        async function sendMessageToFirestore(groupId, text, imageData = null, replyTo = null) {
            if (!currentUser) return;
            
            if (!isOnline) {
                messageQueue.push({
                    groupId: groupId,
                    text: text,
                    imageData: imageData,
                    replyTo: replyTo
                });
                showNotification('Message mis en file d\'attente (hors ligne)', 'info');
                return;
            }
            
            try {
                const messageData = {
                    text: text,
                    from: currentUser.uid,
                    createdAt: serverTimestamp(),
                    fromName: currentUserData?.displayName || 'Utilisateur'
                };
                
                if (imageData) {
                    messageData.imageData = imageData;
                }
                
                if (replyTo) {
                    messageData.replyTo = {
                        id: replyTo.id,
                        from: replyTo.from,
                        text: replyTo.text
                    };
                }
                
                const messagesRef = collection(db, "conversations", groupId, "messages");
                await addDoc(messagesRef, messageData);
                
                const groupRef = doc(db, "Groups", groupId);
                await updateDoc(groupRef, {
                    lastMessage: text || 'Image',
                    lastMessageTime: serverTimestamp(),
                    lastMessageFrom: currentUser.uid
                });
                
            } catch (error) {
                throw error;
            }
        }
        
        function encodeImageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    resolve(e.target.result);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        function openChat(groupId, groupData, isDirectChat = false) {
            currentGroupId = groupId;
            currentGroupData = groupData;
            
            if (isDirectChat) {
                currentChatPartner = groupData;
                currentGroupData = null;
            } else {
                currentChatPartner = null;
            }
            
            exitSelectionMode();
            
            currentSection = 'chat';
            
            document.getElementById('chat-interface').style.display = 'block';
            
            let headerTitle = '';
            if (isDirectChat) {
                headerTitle = groupData.displayName || 'Discussion privée';
            } else {
                headerTitle = groupData.name || 'Groupe';
            }
            
            document.getElementById('header-title').textContent = headerTitle;
            
            document.getElementById('header-menu-button').style.display = 'none';
            document.getElementById('header-back-button').style.display = 'block';
            
            let headerActions = '';
            if (!isDirectChat) {
                headerActions = `<div class="info-button" id="chat-info-button">
                    <i class="fas fa-info-circle"></i>
                </div>`;
            }
            
            document.getElementById('header-action').innerHTML = headerActions;
            
            if (!isDirectChat) {
                const infoButton = document.getElementById('chat-info-button');
                if (infoButton) {
                    infoButton.addEventListener('click', showGroupInfoDialog);
                }
            }
            
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 30px; color: var(--primary-color);"></i>
                    <div style="margin-top: 10px;">Chargement des messages...</div>
                </div>
            `;
            
            setupTextareaAutoResize();
            
            listenToMessages(groupId);
            
            history.pushState({ page: 'chat', groupId: groupId }, '');
        }
        
        function closeChat() {
            currentGroupId = null;
            currentGroupData = null;
            currentChatPartner = null;
            
            exitSelectionMode();
            
            document.getElementById('chat-interface').style.display = 'none';
            
            const chatId = currentGroupId || (currentChatPartner ? [currentUser.uid, currentChatPartner.id].sort().join('_') : null);
            if (chatId && chatUnsubscribers[chatId]) {
                chatUnsubscribers[chatId]();
                delete chatUnsubscribers[chatId];
            }
            
            cancelReply();
            
            if (chatImageFile) {
                chatImageFile = null;
                const imageButton = document.getElementById('image-button');
                if (imageButton) {
                    imageButton.style.color = 'var(--primary-color)';
                }
                const chatInput = document.getElementById('chat-input');
                if (chatInput) {
                    chatInput.placeholder = 'Écrire un message...';
                }
            }
            
            showDiscussionsSection();
        }
        
        function listenToMessages(chatId) {
            if (chatUnsubscribers[chatId]) {
                chatUnsubscribers[chatId]();
            }
            
            try {
                const messagesRef = collection(db, "conversations", chatId, "messages");
                const q = query(messagesRef, orderBy("createdAt", "asc"));
                
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const messagesContainer = document.getElementById('chat-messages');
                    
                    if (snapshot.empty) {
                        messagesContainer.innerHTML = `
                            <div style="text-align: center; padding: 40px; color: var(--inactive-text);">
                                <i class="fas fa-comments" style="font-size: 50px; margin-bottom: 15px; color: var(--border-color);"></i>
                                <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">Aucun message</div>
                                <div style="font-size: 14px;">Commencez la conversation en envoyant le premier message</div>
                            </div>
                        `;
                        return;
                    }
                    
                    const messages = [];
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        messages.push({
                            id: doc.id,
                            ...data
                        });
                    });
                    
                    displayMessages(messages);
                }, (error) => {
                    const errorMsg = handleFirestoreError(error, 'écoute des messages');
                    document.getElementById('chat-messages').innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--danger-color);">
                            <i class="fas fa-exclamation-triangle" style="font-size: 30px; margin-bottom: 15px;"></i>
                            <div>Erreur lors du chargement des messages</div>
                        </div>
                    `;
                });
                
                chatUnsubscribers[chatId] = unsubscribe;
                
            } catch (error) {
                handleFirestoreError(error, 'configuration de l\'écoute des messages');
            }
        }
        
        function displayMessages(messages) {
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.innerHTML = '';
            
            const fragment = document.createDocumentFragment();
            let lastDate = null;
            let lastSender = null;
            
            messages.forEach((messageData, index) => {
                const messageDate = messageData.createdAt ? 
                    messageData.createdAt.toDate() : new Date();
                const currentDate = messageDate.toDateString();
                
                if (currentDate !== lastDate) {
                    const dateSeparator = createDateSeparator(messageDate);
                    fragment.appendChild(dateSeparator);
                    lastDate = currentDate;
                    lastSender = null;
                }
                
                const messageElement = createMessageElement(messageData, lastSender !== messageData.from);
                messageElement.setAttribute('data-id', messageData.id);
                messageElement.setAttribute('data-from', messageData.from);
                
                fragment.appendChild(messageElement);
                lastSender = messageData.from;
            });
            
            messagesContainer.appendChild(fragment);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function createDateSeparator(date) {
            const separator = document.createElement('div');
            separator.className = 'date-separator';
            
            const today = new Date();
            const yesterday = new Date();
            yesterday.setDate(today.getDate() - 1);
            
            let dateText = '';
            if (date.toDateString() === today.toDateString()) {
                dateText = 'Aujourd\'hui';
            } else if (date.toDateString() === yesterday.toDateString()) {
                dateText = 'Hier';
            } else {
                dateText = date.toLocaleDateString('fr-FR', {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long'
                });
            }
            
            separator.innerHTML = `<div class="date-separator-text">${dateText}</div>`;
            return separator;
        }
        
        function createMessageElement(messageData, showSender = true) {
            const messageContainer = document.createElement('div');
            const isSent = messageData.from === currentUser.uid;
            
            messageContainer.className = `message-container ${isSent ? 'sent' : 'received'}`;
            
            let senderInfo = '';
            if (!isSent && showSender && (currentGroupData || currentChatPartner)) {
                const senderName = messageData.fromName || 'Utilisateur';
                const adminInfo = isUserAdmin(messageData.from) ? '<span class="admin-badge">Admin</span>' : '';
                senderInfo = `<div class="message-sender">${senderName}${adminInfo}</div>`;
            }
            
            let replyInfo = '';
            if (messageData.replyTo) {
                const replyName = messageData.replyTo.from === currentUser.uid ? 'Vous' : 
                    (messageData.replyTo.fromName || 'Utilisateur');
                replyInfo = `
                    <div class="message-quote">
                        <div class="message-quote-sender">${replyName}</div>
                        <div class="message-quote-content">${messageData.replyTo.text || 'Message'}</div>
                    </div>
                `;
            }
            
            let messageContent = '';
            if (messageData.imageData) {
                if (messageData.text) {
                    messageContent = `
                        <div class="message-with-image ${isSent ? 'message-sent' : 'message-received'}">
                            <img src="${messageData.imageData}" alt="Image" class="message-image">
                            <div class="message-text">${messageData.text}</div>
                        </div>
                    `;
                } else {
                    messageContent = `
                        <div class="message-with-image ${isSent ? 'message-sent' : 'message-received'}">
                            <img src="${messageData.imageData}" alt="Image" class="message-image">
                        </div>
                    `;
                }
            } else {
                messageContent = `
                    <div class="message ${isSent ? 'message-sent' : 'message-received'}">
                        ${messageData.text || ''}
                    </div>
                `;
            }
            
            const messageTime = messageData.createdAt ? 
                messageData.createdAt.toDate().toLocaleTimeString('fr-FR', {
                    hour: '2-digit',
                    minute: '2-digit'
                }) : '';
            
            const timeInfo = messageTime ? 
                `<div class="message-time">${messageTime}</div>` : '';
            
            messageContainer.innerHTML = `
                ${senderInfo}
                ${replyInfo}
                ${messageContent}
                ${timeInfo}
            `;
            
            const messageImage = messageContainer.querySelector('.message-image');
            if (messageImage) {
                messageImage.addEventListener('click', () => {
                    showImageViewer(messageData.imageData);
                });
            }
            
            return messageContainer;
        }
        
        function isUserAdmin(userId) {
            // Pour l'instant, on vérifie si c'est le compte le plus ancien
            return userId === getOldestUserId();
        }
        
        function getOldestUserId() {
            // Cette fonction devrait retourner l'ID de l'utilisateur le plus ancien
            // Pour l'instant, on utilise une logique simple basée sur l'ordre d'inscription
            if (usersCache && Object.keys(usersCache).length > 0) {
                const sortedUsers = Object.entries(usersCache).sort((a, b) => {
                    const aTime = a[1].createdAt?.seconds || 0;
                    const bTime = b[1].createdAt?.seconds || 0;
                    return aTime - bTime;
                });
                return sortedUsers[0]?.[0];
            }
            return null;
        }
        
        async function loadDiscussions() {
            if (isLoadingGroups || discussionsLoaded) return;
            isLoadingGroups = true;
            
            const discussionsList = document.getElementById('discussions-list');
            discussionsList.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 30px; color: var(--primary-color);"></i>
                    <div style="margin-top: 10px; font-weight: bold;">Chargement des discussions...</div>
                </div>
            `;
            
            try {
                // Charger les groupes auxquels l'utilisateur appartient
                const groupsQuery = query(
                    collection(db, "Groups"),
                    where("members", "array-contains", currentUser.uid)
                );
                const groupsSnapshot = await getDocs(groupsQuery);
                
                const groupDiscussions = [];
                groupsSnapshot.forEach(doc => {
                    const groupData = doc.data();
                    groupDiscussions.push({
                        id: doc.id,
                        type: 'group',
                        data: groupData
                    });
                });
                
                // Charger les conversations directes
                const directConversationsQuery = query(
                    collection(db, "conversations"),
                    where("participants", "array-contains", currentUser.uid),
                    where("type", "==", "direct")
                );
                const directSnapshot = await getDocs(directConversationsQuery);
                
                const directDiscussions = [];
                directSnapshot.forEach(doc => {
                    const conversationData = doc.data();
                    const otherUserId = conversationData.participants.find(id => id !== currentUser.uid);
                    if (otherUserId && usersCache[otherUserId]) {
                        directDiscussions.push({
                            id: doc.id,
                            type: 'direct',
                            data: {
                                ...usersCache[otherUserId],
                                id: otherUserId,
                                lastMessage: conversationData.lastMessage,
                                lastMessageTime: conversationData.lastMessageTime,
                                lastMessageFrom: conversationData.lastMessageFrom
                            }
                        });
                    }
                });
                
                allDiscussions = [...groupDiscussions, ...directDiscussions];
                
                // Trier par dernier message
                allDiscussions.sort((a, b) => {
                    const aTime = a.data.lastMessageTime?.seconds || 0;
                    const bTime = b.data.lastMessageTime?.seconds || 0;
                    return bTime - aTime;
                });
                
                displayDiscussions(allDiscussions);
                discussionsLoaded = true;
                
            } catch (error) {
                const errorMsg = handleFirestoreError(error, 'chargement des discussions');
                discussionsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div class="empty-state-title">Erreur</div>
                        <div class="empty-state-text">Impossible de charger les discussions</div>
                    </div>
                `;
            } finally {
                isLoadingGroups = false;
            }
        }
        
        function displayDiscussions(discussions) {
            const discussionsList = document.getElementById('discussions-list');
            
            if (discussions.length === 0) {
                discussionsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-comments"></i>
                        <div class="empty-state-title">Aucune discussion</div>
                        <div class="empty-state-text">Créez un groupe ou commencez une discussion privée</div>
                    </div>
                `;
                return;
            }
            
            discussionsList.innerHTML = '';
            const fragment = document.createDocumentFragment();
            
            discussions.forEach(discussion => {
                const discussionElement = createDiscussionElement(discussion);
                fragment.appendChild(discussionElement);
            });
            
            discussionsList.appendChild(fragment);
        }
        
        function createDiscussionElement(discussion) {
            const { id, type, data } = discussion;
            
            const discussionElement = document.createElement('div');
            discussionElement.className = 'chat-item';
            
            let avatarHtml = '';
            let titleHtml = '';
            let subtitleHtml = '';
            let badgeHtml = '';
            let timeHtml = '';
            
            if (type === 'group') {
                avatarHtml = data.imageURL ? 
                    `<div class="group-pic"><img src="${data.imageURL}" alt="${data.name}"></div>` :
                    `<div class="group-pic"><i class="fas fa-users"></i></div>`;
                
                titleHtml = data.name || 'Groupe sans nom';
                subtitleHtml = data.lastMessage || 'Aucun message';
                badgeHtml = '<span class="discussion-type-badge group">Groupe</span>';
                
                if (data.allowPublicMessages === false) {
                    badgeHtml += '<span class="restricted-badge">Restreint</span>';
                }
            } else {
                avatarHtml = data.photoURL ? 
                    `<div class="profile-pic"><img src="${data.photoURL}" alt="${data.displayName}"></div>` :
                    `<div class="profile-pic"><i class="fas fa-user"></i></div>`;
                
                titleHtml = data.displayName || 'Utilisateur';
                subtitleHtml = data.lastMessage || 'Aucun message';
                badgeHtml = '<span class="discussion-type-badge direct">Direct</span>';
                
                if (isUserAdmin(data.id)) {
                    badgeHtml += '<span class="admin-badge">Admin</span>';
                }
            }
            
            if (data.lastMessageTime) {
                const messageDate = data.lastMessageTime.toDate();
                const now = new Date();
                const diffHours = (now - messageDate) / (1000 * 60 * 60);
                
                if (diffHours < 24) {
                    timeHtml = messageDate.toLocaleTimeString('fr-FR', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } else {
                    timeHtml = messageDate.toLocaleDateString('fr-FR', {
                        day: 'numeric',
                        month: 'short'
                    });
                }
            }
            
            // Calculer le nombre de messages non lus
            const unreadCount = unreadCounts[id] || 0;
            const unreadBadge = unreadCount > 0 ? 
                `<div class="unread-badge">${unreadCount > 99 ? '99+' : unreadCount}</div>` : '';
            
            discussionElement.innerHTML = `
                ${avatarHtml}
                <div class="item-content">
                    <div class="item-title">
                        ${titleHtml}
                        ${badgeHtml}
                    </div>
                    <div class="item-subtitle">${subtitleHtml}</div>
                </div>
                <div class="item-meta">
                    <div class="item-time">${timeHtml}</div>
                    ${unreadBadge}
                </div>
            `;
            
            discussionElement.addEventListener('click', () => {
                if (type === 'group') {
                    openChat(id, data, false);
                } else {
                    openChat(id, data, true);
                }
                
                // Réinitialiser le compteur de messages non lus
                if (unreadCounts[id]) {
                    delete unreadCounts[id];
                    updateUnreadBadges();
                }
            });
            
            return discussionElement;
        }
        
        function updateUnreadBadges() {
            // Cette fonction met à jour les badges de messages non lus
            // Pour l'instant, on fait une implémentation simple
            const totalUnread = Object.values(unreadCounts).reduce((sum, count) => sum + count, 0);
            
            // Mettre à jour le badge de notification sur l'onglet discussions si nécessaire
            // (pas implémenté dans cette version)
        }
        
        function filterDiscussions(query) {
            if (!query.trim()) {
                displayDiscussions(allDiscussions);
                return;
            }
            
            const filtered = allDiscussions.filter(discussion => {
                const searchTerm = query.toLowerCase();
                const name = discussion.type === 'group' ? 
                    (discussion.data.name || '') : 
                    (discussion.data.displayName || '');
                return name.toLowerCase().includes(searchTerm);
            });
            
            displayDiscussions(filtered);
        }
        
        async function loadUsers() {
            if (isLoadingUsers) return;
            isLoadingUsers = true;
            
            const usersList = document.getElementById('users-list');
            usersList.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 30px; color: var(--primary-color);"></i>
                    <div style="margin-top: 10px; font-weight: bold;">Chargement des utilisateurs...</div>
                </div>
            `;
            
            if (usersUnsubscribe) {
                usersUnsubscribe();
            }
            
            try {
                const usersRef = collection(db, "Users");
                const q = query(usersRef, orderBy("createdAt", "asc"));
                
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    usersCache = {};
                    const users = [];
                    
                    snapshot.forEach(doc => {
                        const userData = doc.data();
                        usersCache[doc.id] = userData;
                        users.push({
                            id: doc.id,
                            ...userData
                        });
                    });
                    
                    // Déterminer qui est admin (compte le plus ancien)
                    if (users.length > 0) {
                        const oldestUser = users[0];
                        if (oldestUser.id === currentUser.uid) {
                            isAdmin = true;
                            updateAdminStatus();
                        }
                    }
                    
                    displayUsers(users);
                }, (error) => {
                    const errorMsg = handleFirestoreError(error, 'chargement des utilisateurs');
                    usersList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div class="empty-state-title">Erreur</div>
                            <div class="empty-state-text">Impossible de charger les utilisateurs</div>
                        </div>
                    `;
                });
                
                usersUnsubscribe = unsubscribe;
                
            } catch (error) {
                handleFirestoreError(error, 'configuration de l\'écoute des utilisateurs');
            } finally {
                isLoadingUsers = false;
            }
        }
        
        function updateAdminStatus() {
            // Mettre à jour l'interface pour refléter le statut d'admin
            const createNotifBtn = document.getElementById('create-notification-btn');
            if (createNotifBtn) {
                if (isAdmin && currentSection === 'events') {
                    createNotifBtn.style.display = 'flex';
                } else {
                    createNotifBtn.style.display = 'none';
                }
            }
            
            // Mettre à jour le badge admin dans le profil
            updateProfileInfo();
        }
        
        function displayUsers(users) {
            const usersList = document.getElementById('users-list');
            
            if (users.length === 0) {
                usersList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-address-book"></i>
                        <div class="empty-state-title">Aucun utilisateur</div>
                        <div class="empty-state-text">Aucun utilisateur inscrit</div>
                    </div>
                `;
                return;
            }
            
            usersList.innerHTML = '';
            const fragment = document.createDocumentFragment();
            
            users.forEach(user => {
                const userElement = createUserElement(user);
                fragment.appendChild(userElement);
            });
            
            usersList.appendChild(fragment);
        }
        
        function createUserElement(user) {
            const userElement = document.createElement('div');
            userElement.className = 'user-item';
            
            const avatarHtml = user.photoURL ? 
                `<div class="user-pic"><img src="${user.photoURL}" alt="${user.displayName}"></div>` :
                `<div class="user-pic"><i class="fas fa-user"></i></div>`;
            
            const isCurrentUser = user.id === currentUser.uid;
            const userIsAdmin = isUserAdmin(user.id);
            
            let badgeHtml = '';
            if (isCurrentUser) {
                badgeHtml = '<span class="new-badge">Vous</span>';
            }
            if (userIsAdmin) {
                badgeHtml += '<span class="admin-badge">Admin</span>';
            }
            
            const joinDate = user.createdAt ? 
                user.createdAt.toDate().toLocaleDateString('fr-FR', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                }) : 'Date inconnue';
            
            userElement.innerHTML = `
                ${avatarHtml}
                <div class="item-content">
                    <div class="item-title">
                        ${user.displayName || 'Utilisateur'}
                        ${badgeHtml}
                    </div>
                    <div class="item-subtitle">Inscrit le ${joinDate}</div>
                </div>
                <div class="item-meta">
                    <div class="item-time"></div>
                </div>
            `;
            
            if (!isCurrentUser) {
                userElement.addEventListener('click', () => {
                    startDirectConversation(user);
                });
            }
            
            return userElement;
        }
        
        async function startDirectConversation(otherUser) {
            try {
                const chatId = [currentUser.uid, otherUser.id].sort().join('_');
                
                // Créer ou obtenir la conversation directe
                const conversationRef = doc(db, "conversations", chatId);
                const conversationData = {
                    participants: [currentUser.uid, otherUser.id],
                    type: 'direct',
                    createdAt: serverTimestamp()
                };
                
                await setDoc(conversationRef, conversationData, { merge: true });
                
                // Ouvrir le chat
                openChat(chatId, otherUser, true);
                
            } catch (error) {
                console.error('Erreur lors de la création de la conversation:', error);
                showNotification('Erreur lors de la création de la conversation', 'error');
            }
        }
        
        function filterUsers(query) {
            if (!query.trim()) {
                displayUsers(Object.entries(usersCache).map(([id, data]) => ({ id, ...data })));
                return;
            }
            
            const searchTerm = query.toLowerCase();
            const filtered = Object.entries(usersCache)
                .map(([id, data]) => ({ id, ...data }))
                .filter(user => {
                    const name = user.displayName || '';
                    return name.toLowerCase().includes(searchTerm);
                });
            
            displayUsers(filtered);
        }
        
        function setButtonLoading(buttonId, loading) {
            const button = document.getElementById(buttonId);
            if (!button) return;
            
            const loader = button.querySelector('.btn-loader');
            const text = button.querySelector('.btn-text');
            
            if (loading) {
                button.classList.add('loading');
                if (loader) loader.style.display = 'inline-block';
                button.disabled = true;
            } else {
                button.classList.remove('loading');
                if (loader) loader.style.display = 'none';
                button.disabled = false;
            }
        }
        
        // Initialize app
        function initApp() {
            addDebugLog('Initialisation de l\'application', 'info');
            
            setupDarkMode();
            setupTheme();
            setupConnectionMonitoring();
            setupUIEvents();
            
            onAuthStateChanged(auth, async (user) => {
                document.getElementById('verify-animation').style.display = 'none';
                
                if (user) {
                    addDebugLog(`Utilisateur connecté: ${user.email}`, 'success');
                    
                    currentUser = user;
                    isLoggedIn = true;
                    
                    try {
                        const userRef = doc(db, "Users", user.uid);
                        const userDoc = await getDoc(userRef);
                        
                        if (userDoc.exists()) {
                            currentUserData = userDoc.data();
                        } else {
                            currentUserData = {
                                email: user.email,
                                displayName: user.displayName || 'Utilisateur',
                                photoURL: user.photoURL || null,
                                createdAt: serverTimestamp(),
                                satsBalance: 0,
                                currentPlan: 'free'
                            };
                            
                            await setDoc(userRef, currentUserData);
                        }
                        
                        updateProfileInfo();
                        loadUsers(); // Charger les utilisateurs pour déterminer qui est admin
                        
                        document.getElementById('auth-screen').style.display = 'none';
                        document.getElementById('loading').style.display = 'none';
                        
                        showDiscussionsSection();
                        
                    } catch (error) {
                        addDebugLog(`Erreur lors de la récupération des données utilisateur: ${error.message}`, 'error');
                        showNotification('Erreur lors de la connexion', 'error');
                    }
                } else {
                    addDebugLog('Aucun utilisateur connecté', 'info');
                    
                    isLoggedIn = false;
                    currentUser = null;
                    currentUserData = null;
                    isAdmin = false;
                    
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('auth-screen').style.display = 'flex';
                }
            });
        }
        
        // Event listeners for auth
        document.getElementById('login-tab').addEventListener('click', function() {
            document.getElementById('register-tab').classList.remove('active');
            this.classList.add('active');
            document.getElementById('register-form').classList.remove('active');
            document.getElementById('login-form').classList.add('active');
        });
        
        document.getElementById('register-tab').addEventListener('click', function() {
            document.getElementById('login-tab').classList.remove('active');
            this.classList.add('active');
            document.getElementById('login-form').classList.remove('active');
            document.getElementById('register-form').classList.add('active');
        });
        
        document.getElementById('goto-register').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('register-tab').click();
        });
        
        document.getElementById('goto-login').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('login-tab').click();
        });
        
        document.getElementById('loginBtn').addEventListener('click', async function() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            let hasError = false;
            
            if (!email || !email.includes('@')) {
                document.getElementById('login-email-error').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('login-email-error').style.display = 'none';
            }
            
            if (!password) {
                document.getElementById('login-password-error').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('login-password-error').style.display = 'none';
            }
            
            if (hasError) return;
            
            setButtonLoading('loginBtn', true);
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                console.error('Erreur de connexion:', error);
                
                let errorMessage = 'Erreur de connexion';
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Aucun compte trouvé avec cet email';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Mot de passe incorrect';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email invalide';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Trop de tentatives. Réessayez plus tard';
                }
                
                const logElement = document.getElementById('login-log');
                logElement.textContent = errorMessage;
                logElement.className = 'log-message error';
                logElement.style.display = 'block';
            } finally {
                setButtonLoading('loginBtn', false);
            }
        });
        
        document.getElementById('registerBtn').addEventListener('click', async function() {
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            let hasError = false;
            
            if (!email || !email.includes('@')) {
                document.getElementById('register-email-error').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('register-email-error').style.display = 'none';
            }
            
            if (!password || password.length < 6) {
                document.getElementById('register-password-error').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('register-password-error').style.display = 'none';
            }
            
            if (password !== confirmPassword) {
                document.getElementById('register-confirm-password-error').style.display = 'block';
                hasError = true;
            } else {
                document.getElementById('register-confirm-password-error').style.display = 'none';
            }
            
            if (hasError) return;
            
            setButtonLoading('registerBtn', true);
            
            try {
                await createUserWithEmailAndPassword(auth, email, password);
            } catch (error) {
                console.error('Erreur d\'inscription:', error);
                
                let errorMessage = 'Erreur d\'inscription';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Cet email est déjà utilisé';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email invalide';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Mot de passe trop faible';
                }
                
                const logElement = document.getElementById('register-log');
                logElement.textContent = errorMessage;
                logElement.className = 'log-message error';
                logElement.style.display = 'block';
            } finally {
                setButtonLoading('registerBtn', false);
            }
        });
        
        // Initialize the app
        initApp();
    </script>
</body>
</html>
